import { getLocalStorageItem, setLocalStorageItem } from './localStorage';
import { checkIsDefined } from './nullable';
import { uuid } from './uuid';
const VISITOR_LOCAL_STORAGE_KEY = 'builderVisitorId';
export const getVisitorId = ({ canTrack }) => {
    if (!canTrack) {
        return undefined;
    }
    const visitorId = getLocalStorageItem({
        key: VISITOR_LOCAL_STORAGE_KEY,
        canTrack
    });
    if (checkIsDefined(visitorId)) {
        return visitorId;
    }
    else {
        const newVisitorId = createVisitorId();
        setVisitorId({
            id: newVisitorId,
            canTrack
        });
        return newVisitorId;
    }
};
export const createVisitorId = () => uuid();
export const setVisitorId = ({ id, canTrack }) => setLocalStorageItem({
    key: VISITOR_LOCAL_STORAGE_KEY,
    value: id,
    canTrack
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlzaXRvcklkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2hlbHBlcnMvdmlzaXRvcklkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDNUMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUM5QixNQUFNLHlCQUF5QixHQUFHLGtCQUFrQixDQUFDO0FBQ3JELE1BQU0sQ0FBQyxNQUFNLFlBQVksR0FBRyxDQUFDLEVBQzNCLFFBQVEsRUFDQyxFQUFzQixFQUFFO0lBQ2pDLElBQUksQ0FBQyxRQUFRLEVBQUU7UUFDYixPQUFPLFNBQVMsQ0FBQztLQUNsQjtJQUNELE1BQU0sU0FBUyxHQUFHLG1CQUFtQixDQUFDO1FBQ3BDLEdBQUcsRUFBRSx5QkFBeUI7UUFDOUIsUUFBUTtLQUNULENBQUMsQ0FBQztJQUNILElBQUksY0FBYyxDQUFDLFNBQVMsQ0FBQyxFQUFFO1FBQzdCLE9BQU8sU0FBUyxDQUFDO0tBQ2xCO1NBQU07UUFDTCxNQUFNLFlBQVksR0FBRyxlQUFlLEVBQUUsQ0FBQztRQUN2QyxZQUFZLENBQUM7WUFDWCxFQUFFLEVBQUUsWUFBWTtZQUNoQixRQUFRO1NBQ1QsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxZQUFZLENBQUM7S0FDckI7QUFDSCxDQUFDLENBQUM7QUFDRixNQUFNLENBQUMsTUFBTSxlQUFlLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDNUMsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHLENBQUMsRUFDM0IsRUFBRSxFQUNGLFFBQVEsRUFHRSxFQUFFLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQztJQUNuQyxHQUFHLEVBQUUseUJBQXlCO0lBQzlCLEtBQUssRUFBRSxFQUFFO0lBQ1QsUUFBUTtDQUNULENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgQ2FuVHJhY2sgfSBmcm9tICcuLi90eXBlcy9jYW4tdHJhY2snO1xuaW1wb3J0IHsgZ2V0TG9jYWxTdG9yYWdlSXRlbSwgc2V0TG9jYWxTdG9yYWdlSXRlbSB9IGZyb20gJy4vbG9jYWxTdG9yYWdlJztcbmltcG9ydCB7IGNoZWNrSXNEZWZpbmVkIH0gZnJvbSAnLi9udWxsYWJsZSc7XG5pbXBvcnQgeyB1dWlkIH0gZnJvbSAnLi91dWlkJztcbmNvbnN0IFZJU0lUT1JfTE9DQUxfU1RPUkFHRV9LRVkgPSAnYnVpbGRlclZpc2l0b3JJZCc7XG5leHBvcnQgY29uc3QgZ2V0VmlzaXRvcklkID0gKHtcbiAgY2FuVHJhY2tcbn06IENhblRyYWNrKTogc3RyaW5nIHwgdW5kZWZpbmVkID0+IHtcbiAgaWYgKCFjYW5UcmFjaykge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgY29uc3QgdmlzaXRvcklkID0gZ2V0TG9jYWxTdG9yYWdlSXRlbSh7XG4gICAga2V5OiBWSVNJVE9SX0xPQ0FMX1NUT1JBR0VfS0VZLFxuICAgIGNhblRyYWNrXG4gIH0pO1xuICBpZiAoY2hlY2tJc0RlZmluZWQodmlzaXRvcklkKSkge1xuICAgIHJldHVybiB2aXNpdG9ySWQ7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgbmV3VmlzaXRvcklkID0gY3JlYXRlVmlzaXRvcklkKCk7XG4gICAgc2V0VmlzaXRvcklkKHtcbiAgICAgIGlkOiBuZXdWaXNpdG9ySWQsXG4gICAgICBjYW5UcmFja1xuICAgIH0pO1xuICAgIHJldHVybiBuZXdWaXNpdG9ySWQ7XG4gIH1cbn07XG5leHBvcnQgY29uc3QgY3JlYXRlVmlzaXRvcklkID0gKCkgPT4gdXVpZCgpO1xuZXhwb3J0IGNvbnN0IHNldFZpc2l0b3JJZCA9ICh7XG4gIGlkLFxuICBjYW5UcmFja1xufToge1xuICBpZDogc3RyaW5nO1xufSAmIENhblRyYWNrKSA9PiBzZXRMb2NhbFN0b3JhZ2VJdGVtKHtcbiAga2V5OiBWSVNJVE9SX0xPQ0FMX1NUT1JBR0VfS0VZLFxuICB2YWx1ZTogaWQsXG4gIGNhblRyYWNrXG59KSJdfQ==