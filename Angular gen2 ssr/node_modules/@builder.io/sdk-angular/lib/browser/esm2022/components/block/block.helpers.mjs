import { evaluate } from '../../functions/evaluate/index';
import { extractTextStyles } from '../../functions/extract-text-styles';
import { getStyle } from '../../functions/get-style';
const checkIsComponentRestricted = (component, model) => {
    if (!component)
        return true;
    if (!model)
        return false;
    return component.models && component.models.length > 0 && !component.models.includes(model);
};
export const getComponent = ({ block, registeredComponents, model }) => {
    const componentName = block.component?.name;
    if (!componentName) {
        return null;
    }
    const ref = registeredComponents[componentName];
    if (!ref || checkIsComponentRestricted(ref, model)) {
        // TODO: Public doc page with more info about this message
        console.warn(`
      Could not find a registered component named "${componentName}". 
      If you registered it, is the file that registered it imported by the file that needs to render it?`);
        return undefined;
    }
    else {
        return ref;
    }
};
export const getRepeatItemData = ({ block, context }) => {
    /**
     * we don't use `state.processedBlock` here because the processing done within its logic includes evaluating the block's bindings,
     * which will not work if there is a repeat.
     */
    const { repeat, ...blockWithoutRepeat } = block;
    if (!repeat?.collection) {
        return undefined;
    }
    const itemsArray = evaluate({
        code: repeat.collection,
        localState: context.localState,
        rootState: context.rootState,
        rootSetState: context.rootSetState,
        context: context.context
    });
    if (!Array.isArray(itemsArray)) {
        return undefined;
    }
    const collectionName = repeat.collection.split('.').pop();
    const itemNameToUse = repeat.itemName || (collectionName ? collectionName + 'Item' : 'item');
    const repeatArray = itemsArray.map((item, index) => ({
        context: {
            ...context,
            localState: {
                ...context.localState,
                $index: index,
                $item: item,
                [itemNameToUse]: item,
                [`$${itemNameToUse}Index`]: index
            }
        },
        block: blockWithoutRepeat
    }));
    return repeatArray;
};
export const getInheritedStyles = ({ block, context }) => {
    const style = getStyle({
        block,
        context
    });
    if (!style) {
        return {};
    }
    return extractTextStyles(style);
};
export const provideLinkComponent = (block, linkComponent) => {
    if (block?.shouldReceiveBuilderProps?.builderLinkComponent)
        return {
            builderLinkComponent: linkComponent
        };
    return {};
};
export const provideRegisteredComponents = (block, registeredComponents, model) => {
    if (block?.shouldReceiveBuilderProps?.builderComponents) {
        const filteredRegisteredComponents = Object.fromEntries(Object.entries(registeredComponents).filter(([_, component]) => {
            return !checkIsComponentRestricted(component, model);
        }));
        return {
            builderComponents: filteredRegisteredComponents
        };
    }
    return {};
};
export const provideBuilderBlock = (block, builderBlock) => {
    if (block?.shouldReceiveBuilderProps?.builderBlock)
        return {
            builderBlock
        };
    return {};
};
export const provideBuilderContext = (block, context) => {
    if (block?.shouldReceiveBuilderProps?.builderContext)
        return {
            builderContext: context
        };
    return {};
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmxvY2suaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2Jsb2NrL2Jsb2NrLmhlbHBlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQzFELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUdyRCxNQUFNLDBCQUEwQixHQUFHLENBQUMsU0FBaUQsRUFBRSxLQUFhLEVBQUUsRUFBRTtJQUN0RyxJQUFJLENBQUMsU0FBUztRQUFFLE9BQU8sSUFBSSxDQUFDO0lBQzVCLElBQUksQ0FBQyxLQUFLO1FBQUUsT0FBTyxLQUFLLENBQUM7SUFDekIsT0FBTyxTQUFTLENBQUMsTUFBTSxJQUFJLFNBQVMsQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQzlGLENBQUMsQ0FBQztBQUNGLE1BQU0sQ0FBQyxNQUFNLFlBQVksR0FBRyxDQUFDLEVBQzNCLEtBQUssRUFDTCxvQkFBb0IsRUFDcEIsS0FBSyxFQUtOLEVBQUUsRUFBRTtJQUNILE1BQU0sYUFBYSxHQUFHLEtBQUssQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDO0lBQzVDLElBQUksQ0FBQyxhQUFhLEVBQUU7UUFDbEIsT0FBTyxJQUFJLENBQUM7S0FDYjtJQUNELE1BQU0sR0FBRyxHQUFHLG9CQUFvQixDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ2hELElBQUksQ0FBQyxHQUFHLElBQUksMEJBQTBCLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxFQUFFO1FBQ2xELDBEQUEwRDtRQUMxRCxPQUFPLENBQUMsSUFBSSxDQUFDO3FEQUNvQyxhQUFhO3lHQUN1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T0FBTyxDQUFDLDBCQUEwQixDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2RCxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ0osT0FBTztZQUNMLGlCQUFpQixFQUFFLDRCQUE0QjtTQUNoRCxDQUFDO0tBQ0g7SUFDRCxPQUFPLEVBQUUsQ0FBQztBQUNaLENBQUMsQ0FBQztBQUNGLE1BQU0sQ0FBQyxNQUFNLG1CQUFtQixHQUFHLENBQUMsS0FBNkMsRUFBRSxZQUEwQixFQUFFLEVBQUU7SUFDL0csSUFBSSxLQUFLLEVBQUUseUJBQXlCLEVBQUUsWUFBWTtRQUFFLE9BQU87WUFDekQsWUFBWTtTQUNiLENBQUM7SUFDRixPQUFPLEVBQUUsQ0FBQztBQUNaLENBQUMsQ0FBQztBQUNGLE1BQU0sQ0FBQyxNQUFNLHFCQUFxQixHQUFHLENBQUMsS0FBNkMsRUFBRSxPQUFnQyxFQUFFLEVBQUU7SUFDdkgsSUFBSSxLQUFLLEVBQUUseUJBQXlCLEVBQUUsY0FBYztRQUFFLE9BQU87WUFDM0QsY0FBYyxFQUFFLE9BQU87U0FDeEIsQ0FBQztJQUNGLE9BQU8sRUFBRSxDQUFDO0FBQ1osQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBCdWlsZGVyQ29udGV4dEludGVyZmFjZSwgUmVnaXN0ZXJlZENvbXBvbmVudCwgUmVnaXN0ZXJlZENvbXBvbmVudHMgfSBmcm9tICcuLi8uLi9jb250ZXh0L3R5cGVzJztcbmltcG9ydCB7IGV2YWx1YXRlIH0gZnJvbSAnLi4vLi4vZnVuY3Rpb25zL2V2YWx1YXRlL2luZGV4JztcbmltcG9ydCB7IGV4dHJhY3RUZXh0U3R5bGVzIH0gZnJvbSAnLi4vLi4vZnVuY3Rpb25zL2V4dHJhY3QtdGV4dC1zdHlsZXMnO1xuaW1wb3J0IHsgZ2V0U3R5bGUgfSBmcm9tICcuLi8uLi9mdW5jdGlvbnMvZ2V0LXN0eWxlJztcbmltcG9ydCB0eXBlIHsgQnVpbGRlckJsb2NrIH0gZnJvbSAnLi4vLi4vdHlwZXMvYnVpbGRlci1ibG9jayc7XG5pbXBvcnQgdHlwZSB7IFJlcGVhdERhdGEgfSBmcm9tICcuL3R5cGVzJztcbmNvbnN0IGNoZWNrSXNDb21wb25lbnRSZXN0cmljdGVkID0gKGNvbXBvbmVudDogUmVnaXN0ZXJlZENvbXBvbmVudCB8IG51bGwgfCB1bmRlZmluZWQsIG1vZGVsOiBzdHJpbmcpID0+IHtcbiAgaWYgKCFjb21wb25lbnQpIHJldHVybiB0cnVlO1xuICBpZiAoIW1vZGVsKSByZXR1cm4gZmFsc2U7XG4gIHJldHVybiBjb21wb25lbnQubW9kZWxzICYmIGNvbXBvbmVudC5tb2RlbHMubGVuZ3RoID4gMCAmJiAhY29tcG9uZW50Lm1vZGVscy5pbmNsdWRlcyhtb2RlbCk7XG59O1xuZXhwb3J0IGNvbnN0IGdldENvbXBvbmVudCA9ICh7XG4gIGJsb2NrLFxuICByZWdpc3RlcmVkQ29tcG9uZW50cyxcbiAgbW9kZWxcbn06IHtcbiAgYmxvY2s6IEJ1aWxkZXJCbG9jaztcbiAgcmVnaXN0ZXJlZENvbXBvbmVudHM6IFJlZ2lzdGVyZWRDb21wb25lbnRzO1xuICBtb2RlbDogc3RyaW5nO1xufSkgPT4ge1xuICBjb25zdCBjb21wb25lbnROYW1lID0gYmxvY2suY29tcG9uZW50Py5uYW1lO1xuICBpZiAoIWNvbXBvbmVudE5hbWUpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCByZWYgPSByZWdpc3RlcmVkQ29tcG9uZW50c1tjb21wb25lbnROYW1lXTtcbiAgaWYgKCFyZWYgfHwgY2hlY2tJc0NvbXBvbmVudFJlc3RyaWN0ZWQocmVmLCBtb2RlbCkpIHtcbiAgICAvLyBUT0RPOiBQdWJsaWMgZG9jIHBhZ2Ugd2l0aCBtb3JlIGluZm8gYWJvdXQgdGhpcyBtZXNzYWdlXG4gICAgY29uc29sZS53YXJuKGBcbiAgICAgIENvdWxkIG5vdCBmaW5kIGEgcmVnaXN0ZXJlZCBjb21wb25lbnQgbmFtZWQgXCIke2NvbXBvbmVudE5hbWV9XCIuIFxuICAgICAgSWYgeW91IHJlZ2lzdGVyZWQgaXQsIGlzIHRoZSBmaWxlIHRoYXQgcmVnaXN0ZXJlZCBpdCBpbXBvcnRlZCBieSB0aGUgZmlsZSB0aGF0IG5lZWRzIHRvIHJlbmRlciBpdD9gKTtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiByZWY7XG4gIH1cbn07XG5leHBvcnQgY29uc3QgZ2V0UmVwZWF0SXRlbURhdGEgPSAoe1xuICBibG9jayxcbiAgY29udGV4dFxufToge1xuICBibG9jazogQnVpbGRlckJsb2NrO1xuICBjb250ZXh0OiBCdWlsZGVyQ29udGV4dEludGVyZmFjZTtcbn0pOiBSZXBlYXREYXRhW10gfCB1bmRlZmluZWQgPT4ge1xuICAvKipcbiAgICogd2UgZG9uJ3QgdXNlIGBzdGF0ZS5wcm9jZXNzZWRCbG9ja2AgaGVyZSBiZWNhdXNlIHRoZSBwcm9jZXNzaW5nIGRvbmUgd2l0aGluIGl0cyBsb2dpYyBpbmNsdWRlcyBldmFsdWF0aW5nIHRoZSBibG9jaydzIGJpbmRpbmdzLFxuICAgKiB3aGljaCB3aWxsIG5vdCB3b3JrIGlmIHRoZXJlIGlzIGEgcmVwZWF0LlxuICAgKi9cbiAgY29uc3Qge1xuICAgIHJlcGVhdCxcbiAgICAuLi5ibG9ja1dpdGhvdXRSZXBlYXRcbiAgfSA9IGJsb2NrO1xuICBpZiAoIXJlcGVhdD8uY29sbGVjdGlvbikge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgY29uc3QgaXRlbXNBcnJheSA9IGV2YWx1YXRlKHtcbiAgICBjb2RlOiByZXBlYXQuY29sbGVjdGlvbixcbiAgICBsb2NhbFN0YXRlOiBjb250ZXh0LmxvY2FsU3RhdGUsXG4gICAgcm9vdFN0YXRlOiBjb250ZXh0LnJvb3RTdGF0ZSxcbiAgICByb290U2V0U3RhdGU6IGNvbnRleHQucm9vdFNldFN0YXRlLFxuICAgIGNvbnRleHQ6IGNvbnRleHQuY29udGV4dFxuICB9KTtcbiAgaWYgKCFBcnJheS5pc0FycmF5KGl0ZW1zQXJyYXkpKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBjb25zdCBjb2xsZWN0aW9uTmFtZSA9IHJlcGVhdC5jb2xsZWN0aW9uLnNwbGl0KCcuJykucG9wKCk7XG4gIGNvbnN0IGl0ZW1OYW1lVG9Vc2UgPSByZXBlYXQuaXRlbU5hbWUgfHwgKGNvbGxlY3Rpb25OYW1lID8gY29sbGVjdGlvbk5hbWUgKyAnSXRlbScgOiAnaXRlbScpO1xuICBjb25zdCByZXBlYXRBcnJheSA9IGl0ZW1zQXJyYXkubWFwPFJlcGVhdERhdGE+KChpdGVtLCBpbmRleCkgPT4gKHtcbiAgICBjb250ZXh0OiB7XG4gICAgICAuLi5jb250ZXh0LFxuICAgICAgbG9jYWxTdGF0ZToge1xuICAgICAgICAuLi5jb250ZXh0LmxvY2FsU3RhdGUsXG4gICAgICAgICRpbmRleDogaW5kZXgsXG4gICAgICAgICRpdGVtOiBpdGVtLFxuICAgICAgICBbaXRlbU5hbWVUb1VzZV06IGl0ZW0sXG4gICAgICAgIFtgJCR7aXRlbU5hbWVUb1VzZX1JbmRleGBdOiBpbmRleFxuICAgICAgfVxuICAgIH0sXG4gICAgYmxvY2s6IGJsb2NrV2l0aG91dFJlcGVhdFxuICB9KSk7XG4gIHJldHVybiByZXBlYXRBcnJheTtcbn07XG5leHBvcnQgY29uc3QgZ2V0SW5oZXJpdGVkU3R5bGVzID0gKHtcbiAgYmxvY2ssXG4gIGNvbnRleHRcbn06IHtcbiAgYmxvY2s6IEJ1aWxkZXJCbG9jaztcbiAgY29udGV4dDogQnVpbGRlckNvbnRleHRJbnRlcmZhY2U7XG59KSA9PiB7XG4gIGNvbnN0IHN0eWxlID0gZ2V0U3R5bGUoe1xuICAgIGJsb2NrLFxuICAgIGNvbnRleHRcbiAgfSk7XG4gIGlmICghc3R5bGUpIHtcbiAgICByZXR1cm4ge307XG4gIH1cbiAgcmV0dXJuIGV4dHJhY3RUZXh0U3R5bGVzKHN0eWxlKTtcbn07XG5leHBvcnQgY29uc3QgcHJvdmlkZUxpbmtDb21wb25lbnQgPSAoYmxvY2s6IFJlZ2lzdGVyZWRDb21wb25lbnQgfCBudWxsIHwgdW5kZWZpbmVkLCBsaW5rQ29tcG9uZW50OiBhbnkpID0+IHtcbiAgaWYgKGJsb2NrPy5zaG91bGRSZWNlaXZlQnVpbGRlclByb3BzPy5idWlsZGVyTGlua0NvbXBvbmVudCkgcmV0dXJuIHtcbiAgICBidWlsZGVyTGlua0NvbXBvbmVudDogbGlua0NvbXBvbmVudFxuICB9O1xuICByZXR1cm4ge307XG59O1xuZXhwb3J0IGNvbnN0IHByb3ZpZGVSZWdpc3RlcmVkQ29tcG9uZW50cyA9IChibG9jazogUmVnaXN0ZXJlZENvbXBvbmVudCB8IG51bGwgfCB1bmRlZmluZWQsIHJlZ2lzdGVyZWRDb21wb25lbnRzOiBSZWdpc3RlcmVkQ29tcG9uZW50cywgbW9kZWw6IHN0cmluZykgPT4ge1xuICBpZiAoYmxvY2s/LnNob3VsZFJlY2VpdmVCdWlsZGVyUHJvcHM/LmJ1aWxkZXJDb21wb25lbnRzKSB7XG4gICAgY29uc3QgZmlsdGVyZWRSZWdpc3RlcmVkQ29tcG9uZW50cyA9IE9iamVjdC5mcm9tRW50cmllcyhPYmplY3QuZW50cmllcyhyZWdpc3RlcmVkQ29tcG9uZW50cykuZmlsdGVyKChbXywgY29tcG9uZW50XSkgPT4ge1xuICAgICAgcmV0dXJuICFjaGVja0lzQ29tcG9uZW50UmVzdHJpY3RlZChjb21wb25lbnQsIG1vZGVsKTtcbiAgICB9KSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGJ1aWxkZXJDb21wb25lbnRzOiBmaWx0ZXJlZFJlZ2lzdGVyZWRDb21wb25lbnRzXG4gICAgfTtcbiAgfVxuICByZXR1cm4ge307XG59O1xuZXhwb3J0IGNvbnN0IHByb3ZpZGVCdWlsZGVyQmxvY2sgPSAoYmxvY2s6IFJlZ2lzdGVyZWRDb21wb25lbnQgfCBudWxsIHwgdW5kZWZpbmVkLCBidWlsZGVyQmxvY2s6IEJ1aWxkZXJCbG9jaykgPT4ge1xuICBpZiAoYmxvY2s/LnNob3VsZFJlY2VpdmVCdWlsZGVyUHJvcHM/LmJ1aWxkZXJCbG9jaykgcmV0dXJuIHtcbiAgICBidWlsZGVyQmxvY2tcbiAgfTtcbiAgcmV0dXJuIHt9O1xufTtcbmV4cG9ydCBjb25zdCBwcm92aWRlQnVpbGRlckNvbnRleHQgPSAoYmxvY2s6IFJlZ2lzdGVyZWRDb21wb25lbnQgfCBudWxsIHwgdW5kZWZpbmVkLCBjb250ZXh0OiBCdWlsZGVyQ29udGV4dEludGVyZmFjZSkgPT4ge1xuICBpZiAoYmxvY2s/LnNob3VsZFJlY2VpdmVCdWlsZGVyUHJvcHM/LmJ1aWxkZXJDb250ZXh0KSByZXR1cm4ge1xuICAgIGJ1aWxkZXJDb250ZXh0OiBjb250ZXh0XG4gIH07XG4gIHJldHVybiB7fTtcbn0iXX0=