import { Component, Input } from "@angular/core";
import { CommonModule } from "@angular/common";
import { TARGET } from "../../constants/target";
import { handleABTestingSync } from "../../helpers/ab-tests";
import { getDefaultCanTrack } from "../../helpers/canTrack";
import ContentComponent from "../content/content";
import InlinedScript from "../inlined-script";
import InlinedStyles from "../inlined-styles";
import { checkShouldRenderVariants, getInitVariantsFnsScriptString, getUpdateCookieAndStylesScript, getVariants, } from "./helpers";
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export default class ContentVariants {
    constructor() {
        this.TARGET = TARGET;
        this.getVariants = getVariants;
        this.shouldRenderVariants = null;
        this.node_0_InlinedScript = null;
    }
    get updateCookieAndStylesScriptStr() {
        return getUpdateCookieAndStylesScript(getVariants(this.content).map((value) => ({
            id: value.testVariationId,
            testRatio: value.testRatio,
        })), this.content?.id || "");
    }
    get hideVariantsStyleString() {
        return getVariants(this.content)
            .map((value) => `.variant-${value.testVariationId} { display: none; } `)
            .join("");
    }
    get defaultContent() {
        return this.shouldRenderVariants
            ? {
                ...this.content,
                testVariationId: this.content?.id,
            }
            : handleABTestingSync({
                item: this.content,
                canTrack: getDefaultCanTrack(this.canTrack),
            });
    }
    trackByVariant0(_, variant) {
        return variant.testVariationId;
    }
    ngOnInit() {
        this.shouldRenderVariants = checkShouldRenderVariants({
            canTrack: getDefaultCanTrack(this.canTrack),
            content: this.content,
        });
        this.node_0_InlinedScript = getInitVariantsFnsScriptString();
        if (typeof window !== "undefined") {
            /**
             * For Solid/Svelte: we unmount the non-winning variants post-hydration.
             */
        }
    }
    ngOnChanges(changes) {
        if (typeof window !== "undefined") {
            this.node_0_InlinedScript = getInitVariantsFnsScriptString();
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: ContentVariants, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: ContentVariants, isStandalone: true, selector: "builder-content, content-variants", inputs: { canTrack: "canTrack", content: "content", isNestedRender: "isNestedRender", nonce: "nonce", apiHost: "apiHost", model: "model", data: "data", context: "context", apiKey: "apiKey", apiVersion: "apiVersion", customComponents: "customComponents", linkComponent: "linkComponent", locale: "locale", enrich: "enrich", blocksWrapper: "blocksWrapper", blocksWrapperProps: "blocksWrapperProps", contentWrapper: "contentWrapper", contentWrapperProps: "contentWrapperProps", trustedHosts: "trustedHosts" }, usesOnChanges: true, ngImport: i0, template: `
    <ng-container>
      <ng-container *ngIf="!isNestedRender && TARGET !== 'reactNative'">
        <inlined-script
          id="builderio-init-variants-fns"
          [scriptStr]="node_0_InlinedScript"
          [nonce]="nonce || ''"
        ></inlined-script>
      </ng-container>
      <ng-container *ngIf="shouldRenderVariants">
        <inlined-styles
          id="builderio-variants"
          [styles]="hideVariantsStyleString"
          [nonce]="nonce || ''"
        ></inlined-styles>
        <inlined-script
          id="builderio-variants-visibility"
          [scriptStr]="updateCookieAndStylesScriptStr"
          [nonce]="nonce || ''"
        ></inlined-script>
        <ng-container
          *ngFor="let variant of getVariants(content); trackBy: trackByVariant0"
        >
          <content-component
            [apiHost]="apiHost"
            [isNestedRender]="isNestedRender"
            [nonce]="nonce"
            [content]="variant"
            [showContent]="false"
            [model]="model"
            [data]="data"
            [context]="context"
            [apiKey]="apiKey"
            [apiVersion]="apiVersion"
            [customComponents]="customComponents"
            [linkComponent]="linkComponent"
            [canTrack]="canTrack"
            [locale]="locale"
            [enrich]="enrich"
            [isSsrAbTest]="shouldRenderVariants"
            [blocksWrapper]="blocksWrapper"
            [blocksWrapperProps]="blocksWrapperProps"
            [contentWrapper]="contentWrapper"
            [contentWrapperProps]="contentWrapperProps"
            [trustedHosts]="trustedHosts"
          ></content-component>
        </ng-container>
      </ng-container>
      <content-component
        [apiHost]="apiHost"
        [nonce]="nonce"
        [isNestedRender]="isNestedRender"
        [content]="defaultContent"
        [showContent]="true"
        [model]="model"
        [data]="data"
        [context]="context"
        [apiKey]="apiKey"
        [apiVersion]="apiVersion"
        [customComponents]="customComponents"
        [linkComponent]="linkComponent"
        [canTrack]="canTrack"
        [locale]="locale"
        [enrich]="enrich"
        [isSsrAbTest]="shouldRenderVariants"
        [blocksWrapper]="blocksWrapper"
        [blocksWrapperProps]="blocksWrapperProps"
        [contentWrapper]="contentWrapper"
        [contentWrapperProps]="contentWrapperProps"
        [trustedHosts]="trustedHosts"
      ></content-component>
    </ng-container>
  `, isInline: true, styles: [":host{display:contents}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: InlinedScript, selector: "inlined-script, InlinedScript", inputs: ["scriptStr", "id", "nonce"] }, { kind: "component", type: InlinedStyles, selector: "inlined-styles, InlinedStyles", inputs: ["styles", "id", "nonce"] }, { kind: "component", type: ContentComponent, selector: "content-component", inputs: ["apiKey", "context", "content", "customComponents", "data", "locale", "canTrack", "apiVersion", "blocksWrapper", "blocksWrapperProps", "nonce", "model", "apiHost", "enrich", "showContent", "contentWrapper", "contentWrapperProps", "trustedHosts", "isNestedRender", "isSsrAbTest", "linkComponent"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: ContentVariants, decorators: [{
            type: Component,
            args: [{ selector: "builder-content, content-variants", template: `
    <ng-container>
      <ng-container *ngIf="!isNestedRender && TARGET !== 'reactNative'">
        <inlined-script
          id="builderio-init-variants-fns"
          [scriptStr]="node_0_InlinedScript"
          [nonce]="nonce || ''"
        ></inlined-script>
      </ng-container>
      <ng-container *ngIf="shouldRenderVariants">
        <inlined-styles
          id="builderio-variants"
          [styles]="hideVariantsStyleString"
          [nonce]="nonce || ''"
        ></inlined-styles>
        <inlined-script
          id="builderio-variants-visibility"
          [scriptStr]="updateCookieAndStylesScriptStr"
          [nonce]="nonce || ''"
        ></inlined-script>
        <ng-container
          *ngFor="let variant of getVariants(content); trackBy: trackByVariant0"
        >
          <content-component
            [apiHost]="apiHost"
            [isNestedRender]="isNestedRender"
            [nonce]="nonce"
            [content]="variant"
            [showContent]="false"
            [model]="model"
            [data]="data"
            [context]="context"
            [apiKey]="apiKey"
            [apiVersion]="apiVersion"
            [customComponents]="customComponents"
            [linkComponent]="linkComponent"
            [canTrack]="canTrack"
            [locale]="locale"
            [enrich]="enrich"
            [isSsrAbTest]="shouldRenderVariants"
            [blocksWrapper]="blocksWrapper"
            [blocksWrapperProps]="blocksWrapperProps"
            [contentWrapper]="contentWrapper"
            [contentWrapperProps]="contentWrapperProps"
            [trustedHosts]="trustedHosts"
          ></content-component>
        </ng-container>
      </ng-container>
      <content-component
        [apiHost]="apiHost"
        [nonce]="nonce"
        [isNestedRender]="isNestedRender"
        [content]="defaultContent"
        [showContent]="true"
        [model]="model"
        [data]="data"
        [context]="context"
        [apiKey]="apiKey"
        [apiVersion]="apiVersion"
        [customComponents]="customComponents"
        [linkComponent]="linkComponent"
        [canTrack]="canTrack"
        [locale]="locale"
        [enrich]="enrich"
        [isSsrAbTest]="shouldRenderVariants"
        [blocksWrapper]="blocksWrapper"
        [blocksWrapperProps]="blocksWrapperProps"
        [contentWrapper]="contentWrapper"
        [contentWrapperProps]="contentWrapperProps"
        [trustedHosts]="trustedHosts"
      ></content-component>
    </ng-container>
  `, standalone: true, imports: [CommonModule, InlinedScript, InlinedStyles, ContentComponent], styles: [":host{display:contents}\n"] }]
        }], propDecorators: { canTrack: [{
                type: Input
            }], content: [{
                type: Input
            }], isNestedRender: [{
                type: Input
            }], nonce: [{
                type: Input
            }], apiHost: [{
                type: Input
            }], model: [{
                type: Input
            }], data: [{
                type: Input
            }], context: [{
                type: Input
            }], apiKey: [{
                type: Input
            }], apiVersion: [{
                type: Input
            }], customComponents: [{
                type: Input
            }], linkComponent: [{
                type: Input
            }], locale: [{
                type: Input
            }], enrich: [{
                type: Input
            }], blocksWrapper: [{
                type: Input
            }], blocksWrapperProps: [{
                type: Input
            }], contentWrapper: [{
                type: Input
            }], contentWrapperProps: [{
                type: Input
            }], trustedHosts: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGVudC12YXJpYW50cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2NvbnRlbnQtdmFyaWFudHMvY29udGVudC12YXJpYW50cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFDaEUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBUy9DLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNoRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM3RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM1RCxPQUFPLGdCQUFnQixNQUFNLG9CQUFvQixDQUFDO0FBQ2xELE9BQU8sYUFBYSxNQUFNLG1CQUFtQixDQUFDO0FBQzlDLE9BQU8sYUFBYSxNQUFNLG1CQUFtQixDQUFDO0FBRTlDLE9BQU8sRUFDTCx5QkFBeUIsRUFDekIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5QixXQUFXLEdBQ1osTUFBTSxXQUFXLENBQUM7OztBQXVGbkIsTUFBTSxDQUFDLE9BQU8sT0FBTyxlQUFlO0lBckZwQztRQXNGRSxXQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ2hCLGdCQUFXLEdBQUcsV0FBVyxDQUFDO1FBc0IxQix5QkFBb0IsR0FBRyxJQUFJLENBQUM7UUEwQjVCLHlCQUFvQixHQUFHLElBQUksQ0FBQztLQXdCN0I7SUFqREMsSUFBSSw4QkFBOEI7UUFDaEMsT0FBTyw4QkFBOEIsQ0FDbkMsV0FBVyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDeEMsRUFBRSxFQUFFLEtBQUssQ0FBQyxlQUFnQjtZQUMxQixTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7U0FDM0IsQ0FBQyxDQUFDLEVBQ0gsSUFBSSxDQUFDLE9BQU8sRUFBRSxFQUFFLElBQUksRUFBRSxDQUN2QixDQUFDO0lBQ0osQ0FBQztJQUNELElBQUksdUJBQXVCO1FBQ3pCLE9BQU8sV0FBVyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7YUFDN0IsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxZQUFZLEtBQUssQ0FBQyxlQUFlLHNCQUFzQixDQUFDO2FBQ3ZFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNkLENBQUM7SUFDRCxJQUFJLGNBQWM7UUFDaEIsT0FBTyxJQUFJLENBQUMsb0JBQW9CO1lBQzlCLENBQUMsQ0FBQztnQkFDRSxHQUFHLElBQUksQ0FBQyxPQUFPO2dCQUNmLGVBQWUsRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLEVBQUU7YUFDbEM7WUFDSCxDQUFDLENBQUMsbUJBQW1CLENBQUM7Z0JBQ2xCLElBQUksRUFBRSxJQUFJLENBQUMsT0FBTztnQkFDbEIsUUFBUSxFQUFFLGtCQUFrQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7YUFDNUMsQ0FBQyxDQUFDO0lBQ1QsQ0FBQztJQUVELGVBQWUsQ0FBQyxDQUFDLEVBQUUsT0FBTztRQUN4QixPQUFPLE9BQU8sQ0FBQyxlQUFlLENBQUM7SUFDakMsQ0FBQztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMsb0JBQW9CLEdBQUcseUJBQXlCLENBQUM7WUFDcEQsUUFBUSxFQUFFLGtCQUFrQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7WUFDM0MsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO1NBQ3RCLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxvQkFBb0IsR0FBRyw4QkFBOEIsRUFBRSxDQUFDO1FBRTdELElBQUksT0FBTyxNQUFNLEtBQUssV0FBVyxFQUFFO1lBQ2pDOztlQUVHO1NBQ0o7SUFDSCxDQUFDO0lBRUQsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVyxFQUFFO1lBQ2pDLElBQUksQ0FBQyxvQkFBb0IsR0FBRyw4QkFBOEIsRUFBRSxDQUFDO1NBQzlEO0lBQ0gsQ0FBQzsrR0F6RWtCLGVBQWU7bUdBQWYsZUFBZSw0bUJBbkZ4Qjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBd0VULGtHQVNTLFlBQVksZ1FBQUUsYUFBYSxnSEFBRSxhQUFhLDZHQUFFLGdCQUFnQjs7NEZBRW5ELGVBQWU7a0JBckZuQyxTQUFTOytCQUNFLG1DQUFtQyxZQUNuQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBd0VULGNBUVcsSUFBSSxXQUNQLENBQUMsWUFBWSxFQUFFLGFBQWEsRUFBRSxhQUFhLEVBQUUsZ0JBQWdCLENBQUM7OEJBTTlELFFBQVE7c0JBQWhCLEtBQUs7Z0JBQ0csT0FBTztzQkFBZixLQUFLO2dCQUNHLGNBQWM7c0JBQXRCLEtBQUs7Z0JBQ0csS0FBSztzQkFBYixLQUFLO2dCQUNHLE9BQU87c0JBQWYsS0FBSztnQkFDRyxLQUFLO3NCQUFiLEtBQUs7Z0JBQ0csSUFBSTtzQkFBWixLQUFLO2dCQUNHLE9BQU87c0JBQWYsS0FBSztnQkFDRyxNQUFNO3NCQUFkLEtBQUs7Z0JBQ0csVUFBVTtzQkFBbEIsS0FBSztnQkFDRyxnQkFBZ0I7c0JBQXhCLEtBQUs7Z0JBQ0csYUFBYTtzQkFBckIsS0FBSztnQkFDRyxNQUFNO3NCQUFkLEtBQUs7Z0JBQ0csTUFBTTtzQkFBZCxLQUFLO2dCQUNHLGFBQWE7c0JBQXJCLEtBQUs7Z0JBQ0csa0JBQWtCO3NCQUExQixLQUFLO2dCQUNHLGNBQWM7c0JBQXRCLEtBQUs7Z0JBQ0csbUJBQW1CO3NCQUEzQixLQUFLO2dCQUNHLFlBQVk7c0JBQXBCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gXCJAYW5ndWxhci9jb21tb25cIjtcblxudHlwZSBWYXJpYW50c1Byb3ZpZGVyUHJvcHMgPSBDb250ZW50VmFyaWFudHNQcnBzICYge1xuICAvKipcbiAgICogRm9yIGludGVybmFsIHVzZSBvbmx5LiBEbyBub3QgcHJvdmlkZSB0aGlzIHByb3AuXG4gICAqL1xuICBpc05lc3RlZFJlbmRlcj86IGJvb2xlYW47XG59O1xuXG5pbXBvcnQgeyBUQVJHRVQgfSBmcm9tIFwiLi4vLi4vY29uc3RhbnRzL3RhcmdldFwiO1xuaW1wb3J0IHsgaGFuZGxlQUJUZXN0aW5nU3luYyB9IGZyb20gXCIuLi8uLi9oZWxwZXJzL2FiLXRlc3RzXCI7XG5pbXBvcnQgeyBnZXREZWZhdWx0Q2FuVHJhY2sgfSBmcm9tIFwiLi4vLi4vaGVscGVycy9jYW5UcmFja1wiO1xuaW1wb3J0IENvbnRlbnRDb21wb25lbnQgZnJvbSBcIi4uL2NvbnRlbnQvY29udGVudFwiO1xuaW1wb3J0IElubGluZWRTY3JpcHQgZnJvbSBcIi4uL2lubGluZWQtc2NyaXB0XCI7XG5pbXBvcnQgSW5saW5lZFN0eWxlcyBmcm9tIFwiLi4vaW5saW5lZC1zdHlsZXNcIjtcbmltcG9ydCB0eXBlIHsgQ29udGVudFZhcmlhbnRzUHJwcyB9IGZyb20gXCIuL2NvbnRlbnQtdmFyaWFudHMudHlwZXNcIjtcbmltcG9ydCB7XG4gIGNoZWNrU2hvdWxkUmVuZGVyVmFyaWFudHMsXG4gIGdldEluaXRWYXJpYW50c0Zuc1NjcmlwdFN0cmluZyxcbiAgZ2V0VXBkYXRlQ29va2llQW5kU3R5bGVzU2NyaXB0LFxuICBnZXRWYXJpYW50cyxcbn0gZnJvbSBcIi4vaGVscGVyc1wiO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6IFwiYnVpbGRlci1jb250ZW50LCBjb250ZW50LXZhcmlhbnRzXCIsXG4gIHRlbXBsYXRlOiBgXG4gICAgPG5nLWNvbnRhaW5lcj5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhaXNOZXN0ZWRSZW5kZXIgJiYgVEFSR0VUICE9PSAncmVhY3ROYXRpdmUnXCI+XG4gICAgICAgIDxpbmxpbmVkLXNjcmlwdFxuICAgICAgICAgIGlkPVwiYnVpbGRlcmlvLWluaXQtdmFyaWFudHMtZm5zXCJcbiAgICAgICAgICBbc2NyaXB0U3RyXT1cIm5vZGVfMF9JbmxpbmVkU2NyaXB0XCJcbiAgICAgICAgICBbbm9uY2VdPVwibm9uY2UgfHwgJydcIlxuICAgICAgICA+PC9pbmxpbmVkLXNjcmlwdD5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInNob3VsZFJlbmRlclZhcmlhbnRzXCI+XG4gICAgICAgIDxpbmxpbmVkLXN0eWxlc1xuICAgICAgICAgIGlkPVwiYnVpbGRlcmlvLXZhcmlhbnRzXCJcbiAgICAgICAgICBbc3R5bGVzXT1cImhpZGVWYXJpYW50c1N0eWxlU3RyaW5nXCJcbiAgICAgICAgICBbbm9uY2VdPVwibm9uY2UgfHwgJydcIlxuICAgICAgICA+PC9pbmxpbmVkLXN0eWxlcz5cbiAgICAgICAgPGlubGluZWQtc2NyaXB0XG4gICAgICAgICAgaWQ9XCJidWlsZGVyaW8tdmFyaWFudHMtdmlzaWJpbGl0eVwiXG4gICAgICAgICAgW3NjcmlwdFN0cl09XCJ1cGRhdGVDb29raWVBbmRTdHlsZXNTY3JpcHRTdHJcIlxuICAgICAgICAgIFtub25jZV09XCJub25jZSB8fCAnJ1wiXG4gICAgICAgID48L2lubGluZWQtc2NyaXB0PlxuICAgICAgICA8bmctY29udGFpbmVyXG4gICAgICAgICAgKm5nRm9yPVwibGV0IHZhcmlhbnQgb2YgZ2V0VmFyaWFudHMoY29udGVudCk7IHRyYWNrQnk6IHRyYWNrQnlWYXJpYW50MFwiXG4gICAgICAgID5cbiAgICAgICAgICA8Y29udGVudC1jb21wb25lbnRcbiAgICAgICAgICAgIFthcGlIb3N0XT1cImFwaUhvc3RcIlxuICAgICAgICAgICAgW2lzTmVzdGVkUmVuZGVyXT1cImlzTmVzdGVkUmVuZGVyXCJcbiAgICAgICAgICAgIFtub25jZV09XCJub25jZVwiXG4gICAgICAgICAgICBbY29udGVudF09XCJ2YXJpYW50XCJcbiAgICAgICAgICAgIFtzaG93Q29udGVudF09XCJmYWxzZVwiXG4gICAgICAgICAgICBbbW9kZWxdPVwibW9kZWxcIlxuICAgICAgICAgICAgW2RhdGFdPVwiZGF0YVwiXG4gICAgICAgICAgICBbY29udGV4dF09XCJjb250ZXh0XCJcbiAgICAgICAgICAgIFthcGlLZXldPVwiYXBpS2V5XCJcbiAgICAgICAgICAgIFthcGlWZXJzaW9uXT1cImFwaVZlcnNpb25cIlxuICAgICAgICAgICAgW2N1c3RvbUNvbXBvbmVudHNdPVwiY3VzdG9tQ29tcG9uZW50c1wiXG4gICAgICAgICAgICBbbGlua0NvbXBvbmVudF09XCJsaW5rQ29tcG9uZW50XCJcbiAgICAgICAgICAgIFtjYW5UcmFja109XCJjYW5UcmFja1wiXG4gICAgICAgICAgICBbbG9jYWxlXT1cImxvY2FsZVwiXG4gICAgICAgICAgICBbZW5yaWNoXT1cImVucmljaFwiXG4gICAgICAgICAgICBbaXNTc3JBYlRlc3RdPVwic2hvdWxkUmVuZGVyVmFyaWFudHNcIlxuICAgICAgICAgICAgW2Jsb2Nrc1dyYXBwZXJdPVwiYmxvY2tzV3JhcHBlclwiXG4gICAgICAgICAgICBbYmxvY2tzV3JhcHBlclByb3BzXT1cImJsb2Nrc1dyYXBwZXJQcm9wc1wiXG4gICAgICAgICAgICBbY29udGVudFdyYXBwZXJdPVwiY29udGVudFdyYXBwZXJcIlxuICAgICAgICAgICAgW2NvbnRlbnRXcmFwcGVyUHJvcHNdPVwiY29udGVudFdyYXBwZXJQcm9wc1wiXG4gICAgICAgICAgICBbdHJ1c3RlZEhvc3RzXT1cInRydXN0ZWRIb3N0c1wiXG4gICAgICAgICAgPjwvY29udGVudC1jb21wb25lbnQ+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICA8Y29udGVudC1jb21wb25lbnRcbiAgICAgICAgW2FwaUhvc3RdPVwiYXBpSG9zdFwiXG4gICAgICAgIFtub25jZV09XCJub25jZVwiXG4gICAgICAgIFtpc05lc3RlZFJlbmRlcl09XCJpc05lc3RlZFJlbmRlclwiXG4gICAgICAgIFtjb250ZW50XT1cImRlZmF1bHRDb250ZW50XCJcbiAgICAgICAgW3Nob3dDb250ZW50XT1cInRydWVcIlxuICAgICAgICBbbW9kZWxdPVwibW9kZWxcIlxuICAgICAgICBbZGF0YV09XCJkYXRhXCJcbiAgICAgICAgW2NvbnRleHRdPVwiY29udGV4dFwiXG4gICAgICAgIFthcGlLZXldPVwiYXBpS2V5XCJcbiAgICAgICAgW2FwaVZlcnNpb25dPVwiYXBpVmVyc2lvblwiXG4gICAgICAgIFtjdXN0b21Db21wb25lbnRzXT1cImN1c3RvbUNvbXBvbmVudHNcIlxuICAgICAgICBbbGlua0NvbXBvbmVudF09XCJsaW5rQ29tcG9uZW50XCJcbiAgICAgICAgW2NhblRyYWNrXT1cImNhblRyYWNrXCJcbiAgICAgICAgW2xvY2FsZV09XCJsb2NhbGVcIlxuICAgICAgICBbZW5yaWNoXT1cImVucmljaFwiXG4gICAgICAgIFtpc1NzckFiVGVzdF09XCJzaG91bGRSZW5kZXJWYXJpYW50c1wiXG4gICAgICAgIFtibG9ja3NXcmFwcGVyXT1cImJsb2Nrc1dyYXBwZXJcIlxuICAgICAgICBbYmxvY2tzV3JhcHBlclByb3BzXT1cImJsb2Nrc1dyYXBwZXJQcm9wc1wiXG4gICAgICAgIFtjb250ZW50V3JhcHBlcl09XCJjb250ZW50V3JhcHBlclwiXG4gICAgICAgIFtjb250ZW50V3JhcHBlclByb3BzXT1cImNvbnRlbnRXcmFwcGVyUHJvcHNcIlxuICAgICAgICBbdHJ1c3RlZEhvc3RzXT1cInRydXN0ZWRIb3N0c1wiXG4gICAgICA+PC9jb250ZW50LWNvbXBvbmVudD5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgYCxcbiAgc3R5bGVzOiBbXG4gICAgYFxuICAgICAgOmhvc3Qge1xuICAgICAgICBkaXNwbGF5OiBjb250ZW50cztcbiAgICAgIH1cbiAgICBgLFxuICBdLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbQ29tbW9uTW9kdWxlLCBJbmxpbmVkU2NyaXB0LCBJbmxpbmVkU3R5bGVzLCBDb250ZW50Q29tcG9uZW50XSxcbn0pXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb250ZW50VmFyaWFudHMge1xuICBUQVJHRVQgPSBUQVJHRVQ7XG4gIGdldFZhcmlhbnRzID0gZ2V0VmFyaWFudHM7XG5cbiAgQElucHV0KCkgY2FuVHJhY2shOiBWYXJpYW50c1Byb3ZpZGVyUHJvcHNbXCJjYW5UcmFja1wiXTtcbiAgQElucHV0KCkgY29udGVudCE6IFZhcmlhbnRzUHJvdmlkZXJQcm9wc1tcImNvbnRlbnRcIl07XG4gIEBJbnB1dCgpIGlzTmVzdGVkUmVuZGVyITogVmFyaWFudHNQcm92aWRlclByb3BzW1wiaXNOZXN0ZWRSZW5kZXJcIl07XG4gIEBJbnB1dCgpIG5vbmNlITogVmFyaWFudHNQcm92aWRlclByb3BzW1wibm9uY2VcIl07XG4gIEBJbnB1dCgpIGFwaUhvc3QhOiBWYXJpYW50c1Byb3ZpZGVyUHJvcHNbXCJhcGlIb3N0XCJdO1xuICBASW5wdXQoKSBtb2RlbCE6IFZhcmlhbnRzUHJvdmlkZXJQcm9wc1tcIm1vZGVsXCJdO1xuICBASW5wdXQoKSBkYXRhITogVmFyaWFudHNQcm92aWRlclByb3BzW1wiZGF0YVwiXTtcbiAgQElucHV0KCkgY29udGV4dCE6IFZhcmlhbnRzUHJvdmlkZXJQcm9wc1tcImNvbnRleHRcIl07XG4gIEBJbnB1dCgpIGFwaUtleSE6IFZhcmlhbnRzUHJvdmlkZXJQcm9wc1tcImFwaUtleVwiXTtcbiAgQElucHV0KCkgYXBpVmVyc2lvbiE6IFZhcmlhbnRzUHJvdmlkZXJQcm9wc1tcImFwaVZlcnNpb25cIl07XG4gIEBJbnB1dCgpIGN1c3RvbUNvbXBvbmVudHMhOiBWYXJpYW50c1Byb3ZpZGVyUHJvcHNbXCJjdXN0b21Db21wb25lbnRzXCJdO1xuICBASW5wdXQoKSBsaW5rQ29tcG9uZW50ITogVmFyaWFudHNQcm92aWRlclByb3BzW1wibGlua0NvbXBvbmVudFwiXTtcbiAgQElucHV0KCkgbG9jYWxlITogVmFyaWFudHNQcm92aWRlclByb3BzW1wibG9jYWxlXCJdO1xuICBASW5wdXQoKSBlbnJpY2ghOiBWYXJpYW50c1Byb3ZpZGVyUHJvcHNbXCJlbnJpY2hcIl07XG4gIEBJbnB1dCgpIGJsb2Nrc1dyYXBwZXIhOiBWYXJpYW50c1Byb3ZpZGVyUHJvcHNbXCJibG9ja3NXcmFwcGVyXCJdO1xuICBASW5wdXQoKSBibG9ja3NXcmFwcGVyUHJvcHMhOiBWYXJpYW50c1Byb3ZpZGVyUHJvcHNbXCJibG9ja3NXcmFwcGVyUHJvcHNcIl07XG4gIEBJbnB1dCgpIGNvbnRlbnRXcmFwcGVyITogVmFyaWFudHNQcm92aWRlclByb3BzW1wiY29udGVudFdyYXBwZXJcIl07XG4gIEBJbnB1dCgpIGNvbnRlbnRXcmFwcGVyUHJvcHMhOiBWYXJpYW50c1Byb3ZpZGVyUHJvcHNbXCJjb250ZW50V3JhcHBlclByb3BzXCJdO1xuICBASW5wdXQoKSB0cnVzdGVkSG9zdHMhOiBWYXJpYW50c1Byb3ZpZGVyUHJvcHNbXCJ0cnVzdGVkSG9zdHNcIl07XG5cbiAgc2hvdWxkUmVuZGVyVmFyaWFudHMgPSBudWxsO1xuICBnZXQgdXBkYXRlQ29va2llQW5kU3R5bGVzU2NyaXB0U3RyKCkge1xuICAgIHJldHVybiBnZXRVcGRhdGVDb29raWVBbmRTdHlsZXNTY3JpcHQoXG4gICAgICBnZXRWYXJpYW50cyh0aGlzLmNvbnRlbnQpLm1hcCgodmFsdWUpID0+ICh7XG4gICAgICAgIGlkOiB2YWx1ZS50ZXN0VmFyaWF0aW9uSWQhLFxuICAgICAgICB0ZXN0UmF0aW86IHZhbHVlLnRlc3RSYXRpbyxcbiAgICAgIH0pKSxcbiAgICAgIHRoaXMuY29udGVudD8uaWQgfHwgXCJcIlxuICAgICk7XG4gIH1cbiAgZ2V0IGhpZGVWYXJpYW50c1N0eWxlU3RyaW5nKCkge1xuICAgIHJldHVybiBnZXRWYXJpYW50cyh0aGlzLmNvbnRlbnQpXG4gICAgICAubWFwKCh2YWx1ZSkgPT4gYC52YXJpYW50LSR7dmFsdWUudGVzdFZhcmlhdGlvbklkfSB7IGRpc3BsYXk6IG5vbmU7IH0gYClcbiAgICAgIC5qb2luKFwiXCIpO1xuICB9XG4gIGdldCBkZWZhdWx0Q29udGVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5zaG91bGRSZW5kZXJWYXJpYW50c1xuICAgICAgPyB7XG4gICAgICAgICAgLi4udGhpcy5jb250ZW50LFxuICAgICAgICAgIHRlc3RWYXJpYXRpb25JZDogdGhpcy5jb250ZW50Py5pZCxcbiAgICAgICAgfVxuICAgICAgOiBoYW5kbGVBQlRlc3RpbmdTeW5jKHtcbiAgICAgICAgICBpdGVtOiB0aGlzLmNvbnRlbnQsXG4gICAgICAgICAgY2FuVHJhY2s6IGdldERlZmF1bHRDYW5UcmFjayh0aGlzLmNhblRyYWNrKSxcbiAgICAgICAgfSk7XG4gIH1cbiAgbm9kZV8wX0lubGluZWRTY3JpcHQgPSBudWxsO1xuICB0cmFja0J5VmFyaWFudDAoXywgdmFyaWFudCkge1xuICAgIHJldHVybiB2YXJpYW50LnRlc3RWYXJpYXRpb25JZDtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuc2hvdWxkUmVuZGVyVmFyaWFudHMgPSBjaGVja1Nob3VsZFJlbmRlclZhcmlhbnRzKHtcbiAgICAgIGNhblRyYWNrOiBnZXREZWZhdWx0Q2FuVHJhY2sodGhpcy5jYW5UcmFjayksXG4gICAgICBjb250ZW50OiB0aGlzLmNvbnRlbnQsXG4gICAgfSk7XG4gICAgdGhpcy5ub2RlXzBfSW5saW5lZFNjcmlwdCA9IGdldEluaXRWYXJpYW50c0Zuc1NjcmlwdFN0cmluZygpO1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIC8qKlxuICAgICAgICogRm9yIFNvbGlkL1N2ZWx0ZTogd2UgdW5tb3VudCB0aGUgbm9uLXdpbm5pbmcgdmFyaWFudHMgcG9zdC1oeWRyYXRpb24uXG4gICAgICAgKi9cbiAgICB9XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIHRoaXMubm9kZV8wX0lubGluZWRTY3JpcHQgPSBnZXRJbml0VmFyaWFudHNGbnNTY3JpcHRTdHJpbmcoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==