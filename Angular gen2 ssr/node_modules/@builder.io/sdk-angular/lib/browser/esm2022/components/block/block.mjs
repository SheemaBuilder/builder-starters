import { Component, Input } from "@angular/core";
import { CommonModule } from "@angular/common";
import { TARGET } from "../../constants/target";
import { getBlockComponentOptions } from "../../functions/get-block-component-options";
import { getProcessedBlock } from "../../functions/get-processed-block";
import DynamicDiv from "../dynamic-div";
import { bindAnimations } from "./animator";
import { getComponent, getRepeatItemData, provideBuilderBlock, provideBuilderContext, provideLinkComponent, provideRegisteredComponents, } from "./block.helpers";
import BlockStyles from "./components/block-styles";
import BlockWrapper from "./components/block-wrapper";
import ComponentRef from "./components/component-ref/component-ref";
import RepeatedBlock from "./components/repeated-block";
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export default class Block {
    constructor() {
        this._processedBlock = {
            value: null,
            update: false,
        };
    }
    get repeatItem() {
        return getRepeatItemData({
            block: this.block,
            context: this.context,
        });
    }
    get processedBlock() {
        const blockToUse = this.block.repeat?.collection
            ? this.block
            : getProcessedBlock({
                block: this.block,
                localState: this.context.localState,
                rootState: this.context.rootState,
                rootSetState: this.context.rootSetState,
                context: this.context.context,
            });
        return blockToUse;
    }
    get blockComponent() {
        return getComponent({
            block: this.processedBlock,
            registeredComponents: this.registeredComponents,
            model: this.context.model,
        });
    }
    get Tag() {
        const shouldUseLink = this.block.tagName === "a" ||
            this.processedBlock.properties?.href ||
            this.processedBlock.href;
        if (shouldUseLink) {
            return this.linkComponent || "a";
        }
        return DynamicDiv;
    }
    get canShowBlock() {
        if (this.block.repeat?.collection) {
            if (this.repeatItem?.length)
                return true;
            return false;
        }
        const shouldHide = "hide" in this.processedBlock ? this.processedBlock.hide : false;
        const shouldShow = "show" in this.processedBlock ? this.processedBlock.show : true;
        return shouldShow && !shouldHide;
    }
    get childrenWithoutParentComponent() {
        /**
         * When there is no `componentRef`, there might still be children that need to be rendered. In this case,
         * we render them outside of `componentRef`.
         * NOTE: We make sure not to render this if `repeatItemData` is non-null, because that means we are rendering an array of
         * blocks, and the children will be repeated within those blocks.
         */
        const shouldRenderChildrenOutsideRef = !this.blockComponent?.component && !this.repeatItem;
        return shouldRenderChildrenOutsideRef
            ? this.processedBlock.children ?? []
            : [];
    }
    get componentRefProps() {
        return {
            blockChildren: this.processedBlock.children ?? [],
            componentRef: this.blockComponent?.component,
            componentOptions: {
                ...getBlockComponentOptions(this.processedBlock, this.context),
                ...provideBuilderBlock(this.blockComponent, this.processedBlock),
                ...provideBuilderContext(this.blockComponent, this.context),
                ...provideLinkComponent(this.blockComponent, this.linkComponent),
                ...provideRegisteredComponents(this.blockComponent, this.registeredComponents, this.context.model),
            },
            context: this.context,
            linkComponent: this.linkComponent,
            registeredComponents: this.registeredComponents,
            builderBlock: this.processedBlock,
            includeBlockProps: this.blockComponent?.noWrap === true,
            isInteractive: !(this.blockComponent?.isRSC && TARGET === "rsc"),
        };
    }
    trackByChild0(_, child) {
        return child.id;
    }
    trackByData1(index, data) {
        return index;
    }
    trackByData2(index, data) {
        return index;
    }
    ngOnInit() {
        if (typeof window !== "undefined") {
            const blockId = this.processedBlock.id;
            const animations = this.processedBlock.animations;
            if (animations && blockId) {
                // in Angular, the DynamicDiv sets attributes (builder-id) on the element late (ngAfterViewInit)
                // so we need to wait for them to be attached to the DOM before calling this else we'll not find the element
                requestAnimationFrame(() => {
                    bindAnimations(animations.map((animation) => ({
                        ...animation,
                        elementId: blockId,
                    })));
                });
            }
        }
    }
    ngOnChanges(changes) {
        if (typeof window !== "undefined") {
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: Block, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: Block, isStandalone: true, selector: "block", inputs: { block: "block", context: "context", registeredComponents: "registeredComponents", linkComponent: "linkComponent" }, usesOnChanges: true, ngImport: i0, template: `
    <ng-container *ngIf="canShowBlock">
      <block-styles [block]="processedBlock" [context]="context"></block-styles>
      <ng-container *ngIf="!blockComponent?.noWrap">
        <ng-container *ngIf="!repeatItem">
          <block-wrapper
            [Wrapper]="Tag"
            [block]="processedBlock"
            [context]="context"
          >
            <component-ref
              [componentRef]="componentRefProps.componentRef"
              [componentOptions]="componentRefProps.componentOptions"
              [blockChildren]="componentRefProps.blockChildren"
              [context]="componentRefProps.context"
              [registeredComponents]="componentRefProps.registeredComponents"
              [linkComponent]="componentRefProps.linkComponent"
              [builderBlock]="componentRefProps.builderBlock"
              [includeBlockProps]="componentRefProps.includeBlockProps"
              [isInteractive]="componentRefProps.isInteractive"
            ></component-ref>
            <ng-container
              *ngFor="let child of childrenWithoutParentComponent; trackBy: trackByChild0"
            >
              <block
                [block]="child"
                [registeredComponents]="registeredComponents"
                [linkComponent]="linkComponent"
                [context]="context"
              ></block>
            </ng-container>
          </block-wrapper>
        </ng-container>
        <ng-container *ngIf="!(!repeatItem)">
          <ng-container
            *ngFor="let data of repeatItem; index as index; trackBy: trackByData1"
          >
            <repeated-block
              [repeatContext]="data.context"
              [block]="data.block"
              [registeredComponents]="registeredComponents"
              [linkComponent]="linkComponent"
            ></repeated-block>
          </ng-container>
        </ng-container>
      </ng-container>
      <ng-container *ngIf="!(!blockComponent?.noWrap)">
        <ng-container *ngIf="!repeatItem">
          <component-ref
            [componentRef]="componentRefProps.componentRef"
            [componentOptions]="componentRefProps.componentOptions"
            [blockChildren]="componentRefProps.blockChildren"
            [context]="componentRefProps.context"
            [registeredComponents]="componentRefProps.registeredComponents"
            [linkComponent]="componentRefProps.linkComponent"
            [builderBlock]="componentRefProps.builderBlock"
            [includeBlockProps]="componentRefProps.includeBlockProps"
            [isInteractive]="componentRefProps.isInteractive"
          ></component-ref>
        </ng-container>
        <ng-container *ngIf="!(!repeatItem)">
          <ng-container
            *ngFor="let data of repeatItem; index as index; trackBy: trackByData2"
          >
            <repeated-block
              [repeatContext]="data.context"
              [block]="data.block"
              [registeredComponents]="registeredComponents"
              [linkComponent]="linkComponent"
            ></repeated-block>
          </ng-container>
        </ng-container>
      </ng-container>
    </ng-container>
  `, isInline: true, styles: [":host{display:contents}\n"], dependencies: [{ kind: "component", type: Block, selector: "block", inputs: ["block", "context", "registeredComponents", "linkComponent"] }, { kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: BlockStyles, selector: "block-styles", inputs: ["block", "context"] }, { kind: "component", type: RepeatedBlock, selector: "repeated-block", inputs: ["repeatContext", "block", "registeredComponents", "linkComponent"] }, { kind: "component", type: ComponentRef, selector: "component-ref", inputs: ["componentOptions", "builderBlock", "context", "componentRef", "linkComponent", "includeBlockProps", "isInteractive", "blockChildren", "registeredComponents"] }, { kind: "component", type: BlockWrapper, selector: "block-wrapper", inputs: ["block", "context", "Wrapper"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: Block, decorators: [{
            type: Component,
            args: [{ selector: "block", template: `
    <ng-container *ngIf="canShowBlock">
      <block-styles [block]="processedBlock" [context]="context"></block-styles>
      <ng-container *ngIf="!blockComponent?.noWrap">
        <ng-container *ngIf="!repeatItem">
          <block-wrapper
            [Wrapper]="Tag"
            [block]="processedBlock"
            [context]="context"
          >
            <component-ref
              [componentRef]="componentRefProps.componentRef"
              [componentOptions]="componentRefProps.componentOptions"
              [blockChildren]="componentRefProps.blockChildren"
              [context]="componentRefProps.context"
              [registeredComponents]="componentRefProps.registeredComponents"
              [linkComponent]="componentRefProps.linkComponent"
              [builderBlock]="componentRefProps.builderBlock"
              [includeBlockProps]="componentRefProps.includeBlockProps"
              [isInteractive]="componentRefProps.isInteractive"
            ></component-ref>
            <ng-container
              *ngFor="let child of childrenWithoutParentComponent; trackBy: trackByChild0"
            >
              <block
                [block]="child"
                [registeredComponents]="registeredComponents"
                [linkComponent]="linkComponent"
                [context]="context"
              ></block>
            </ng-container>
          </block-wrapper>
        </ng-container>
        <ng-container *ngIf="!(!repeatItem)">
          <ng-container
            *ngFor="let data of repeatItem; index as index; trackBy: trackByData1"
          >
            <repeated-block
              [repeatContext]="data.context"
              [block]="data.block"
              [registeredComponents]="registeredComponents"
              [linkComponent]="linkComponent"
            ></repeated-block>
          </ng-container>
        </ng-container>
      </ng-container>
      <ng-container *ngIf="!(!blockComponent?.noWrap)">
        <ng-container *ngIf="!repeatItem">
          <component-ref
            [componentRef]="componentRefProps.componentRef"
            [componentOptions]="componentRefProps.componentOptions"
            [blockChildren]="componentRefProps.blockChildren"
            [context]="componentRefProps.context"
            [registeredComponents]="componentRefProps.registeredComponents"
            [linkComponent]="componentRefProps.linkComponent"
            [builderBlock]="componentRefProps.builderBlock"
            [includeBlockProps]="componentRefProps.includeBlockProps"
            [isInteractive]="componentRefProps.isInteractive"
          ></component-ref>
        </ng-container>
        <ng-container *ngIf="!(!repeatItem)">
          <ng-container
            *ngFor="let data of repeatItem; index as index; trackBy: trackByData2"
          >
            <repeated-block
              [repeatContext]="data.context"
              [block]="data.block"
              [registeredComponents]="registeredComponents"
              [linkComponent]="linkComponent"
            ></repeated-block>
          </ng-container>
        </ng-container>
      </ng-container>
    </ng-container>
  `, standalone: true, imports: [
                        CommonModule,
                        BlockStyles,
                        RepeatedBlock,
                        ComponentRef,
                        BlockWrapper,
                        Block,
                    ], styles: [":host{display:contents}\n"] }]
        }], propDecorators: { block: [{
                type: Input
            }], context: [{
                type: Input
            }], registeredComponents: [{
                type: Input
            }], linkComponent: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmxvY2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9ibG9jay9ibG9jay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFDaEUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBUy9DLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUtoRCxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSw2Q0FBNkMsQ0FBQztBQUN2RixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUd4RSxPQUFPLFVBQVUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4QyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQzVDLE9BQU8sRUFDTCxZQUFZLEVBRVosaUJBQWlCLEVBQ2pCLG1CQUFtQixFQUNuQixxQkFBcUIsRUFDckIsb0JBQW9CLEVBQ3BCLDJCQUEyQixHQUM1QixNQUFNLGlCQUFpQixDQUFDO0FBQ3pCLE9BQU8sV0FBVyxNQUFNLDJCQUEyQixDQUFDO0FBQ3BELE9BQU8sWUFBWSxNQUFNLDRCQUE0QixDQUFDO0FBRXRELE9BQU8sWUFBWSxNQUFNLDBDQUEwQyxDQUFDO0FBQ3BFLE9BQU8sYUFBYSxNQUFNLDZCQUE2QixDQUFDOzs7QUFnR3hELE1BQU0sQ0FBQyxPQUFPLE9BQU8sS0FBSztJQTlGMUI7UUEwR0Usb0JBQWUsR0FBRztZQUNoQixLQUFLLEVBQUUsSUFBMkI7WUFDbEMsTUFBTSxFQUFFLEtBQUs7U0FDZCxDQUFDO0tBOEdIO0lBdkhDLElBQUksVUFBVTtRQUNaLE9BQU8saUJBQWlCLENBQUM7WUFDdkIsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLO1lBQ2pCLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTztTQUN0QixDQUFDLENB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RSxDQUFDLENBQUM7d0JBQzdCLEdBQUcsU0FBUzt3QkFDWixTQUFTLEVBQUUsT0FBTztxQkFDbkIsQ0FBQyxDQUFDLENBQ0osQ0FBQztnQkFDSixDQUFDLENBQUMsQ0FBQzthQUNKO1NBQ0Y7SUFDSCxDQUFDO0lBRUQsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVyxFQUFFO1NBQ2xDO0lBQ0gsQ0FBQzsrR0E1SGtCLEtBQUs7bUdBQUwsS0FBSyxvTkE1RmQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBMEVULG1HQWtCa0IsS0FBSyx3SEFSdEIsWUFBWSxnUUFDWixXQUFXLHVGQUNYLGFBQWEsd0lBQ2IsWUFBWSxtT0FDWixZQUFZOzs0RkFJSyxLQUFLO2tCQTlGekIsU0FBUzsrQkFDRSxPQUFPLFlBQ1A7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBMEVULGNBUVcsSUFBSSxXQUNQO3dCQUNQLFlBQVk7d0JBQ1osV0FBVzt3QkFDWCxhQUFhO3dCQUNiLFlBQVk7d0JBQ1osWUFBWTs7cUJBRWI7OEJBR1EsS0FBSztzQkFBYixLQUFLO2dCQUNHLE9BQU87c0JBQWYsS0FBSztnQkFDRyxvQkFBb0I7c0JBQTVCLEtBQUs7Z0JBQ0csYUFBYTtzQkFBckIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIFNpbXBsZUNoYW5nZXMgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvbW1vblwiO1xuXG5leHBvcnQgdHlwZSBCbG9ja1Byb3BzID0ge1xuICBibG9jazogQnVpbGRlckJsb2NrO1xuICBjb250ZXh0OiBCdWlsZGVyQ29udGV4dEludGVyZmFjZTtcbiAgcmVnaXN0ZXJlZENvbXBvbmVudHM6IFJlZ2lzdGVyZWRDb21wb25lbnRzO1xuICBsaW5rQ29tcG9uZW50OiBhbnk7XG59O1xuXG5pbXBvcnQgeyBUQVJHRVQgfSBmcm9tIFwiLi4vLi4vY29uc3RhbnRzL3RhcmdldFwiO1xuaW1wb3J0IHR5cGUge1xuICBCdWlsZGVyQ29udGV4dEludGVyZmFjZSxcbiAgUmVnaXN0ZXJlZENvbXBvbmVudHMsXG59IGZyb20gXCIuLi8uLi9jb250ZXh0L3R5cGVzXCI7XG5pbXBvcnQgeyBnZXRCbG9ja0NvbXBvbmVudE9wdGlvbnMgfSBmcm9tIFwiLi4vLi4vZnVuY3Rpb25zL2dldC1ibG9jay1jb21wb25lbnQtb3B0aW9uc1wiO1xuaW1wb3J0IHsgZ2V0UHJvY2Vzc2VkQmxvY2sgfSBmcm9tIFwiLi4vLi4vZnVuY3Rpb25zL2dldC1wcm9jZXNzZWQtYmxvY2tcIjtcbmltcG9ydCB7IGlzUHJldmlld2luZyB9IGZyb20gXCIuLi8uLi9zZXJ2ZXItaW5kZXhcIjtcbmltcG9ydCB0eXBlIHsgQnVpbGRlckJsb2NrIH0gZnJvbSBcIi4uLy4uL3R5cGVzL2J1aWxkZXItYmxvY2tcIjtcbmltcG9ydCBEeW5hbWljRGl2IGZyb20gXCIuLi9keW5hbWljLWRpdlwiO1xuaW1wb3J0IHsgYmluZEFuaW1hdGlvbnMgfSBmcm9tIFwiLi9hbmltYXRvclwiO1xuaW1wb3J0IHtcbiAgZ2V0Q29tcG9uZW50LFxuICBnZXRJbmhlcml0ZWRTdHlsZXMsXG4gIGdldFJlcGVhdEl0ZW1EYXRhLFxuICBwcm92aWRlQnVpbGRlckJsb2NrLFxuICBwcm92aWRlQnVpbGRlckNvbnRleHQsXG4gIHByb3ZpZGVMaW5rQ29tcG9uZW50LFxuICBwcm92aWRlUmVnaXN0ZXJlZENvbXBvbmVudHMsXG59IGZyb20gXCIuL2Jsb2NrLmhlbHBlcnNcIjtcbmltcG9ydCBCbG9ja1N0eWxlcyBmcm9tIFwiLi9jb21wb25lbnRzL2Jsb2NrLXN0eWxlc1wiO1xuaW1wb3J0IEJsb2NrV3JhcHBlciBmcm9tIFwiLi9jb21wb25lbnRzL2Jsb2NrLXdyYXBwZXJcIjtcbmltcG9ydCB0eXBlIHsgQ29tcG9uZW50UHJvcHMgfSBmcm9tIFwiLi9jb21wb25lbnRzL2NvbXBvbmVudC1yZWYvY29tcG9uZW50LXJlZi5oZWxwZXJzXCI7XG5pbXBvcnQgQ29tcG9uZW50UmVmIGZyb20gXCIuL2NvbXBvbmVudHMvY29tcG9uZW50LXJlZi9jb21wb25lbnQtcmVmXCI7XG5pbXBvcnQgUmVwZWF0ZWRCbG9jayBmcm9tIFwiLi9jb21wb25lbnRzL3JlcGVhdGVkLWJsb2NrXCI7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJibG9ja1wiLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJjYW5TaG93QmxvY2tcIj5cbiAgICAgIDxibG9jay1zdHlsZXMgW2Jsb2NrXT1cInByb2Nlc3NlZEJsb2NrXCIgW2NvbnRleHRdPVwiY29udGV4dFwiPjwvYmxvY2stc3R5bGVzPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFibG9ja0NvbXBvbmVudD8ubm9XcmFwXCI+XG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhcmVwZWF0SXRlbVwiPlxuICAgICAgICAgIDxibG9jay13cmFwcGVyXG4gICAgICAgICAgICBbV3JhcHBlcl09XCJUYWdcIlxuICAgICAgICAgICAgW2Jsb2NrXT1cInByb2Nlc3NlZEJsb2NrXCJcbiAgICAgICAgICAgIFtjb250ZXh0XT1cImNvbnRleHRcIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxjb21wb25lbnQtcmVmXG4gICAgICAgICAgICAgIFtjb21wb25lbnRSZWZdPVwiY29tcG9uZW50UmVmUHJvcHMuY29tcG9uZW50UmVmXCJcbiAgICAgICAgICAgICAgW2NvbXBvbmVudE9wdGlvbnNdPVwiY29tcG9uZW50UmVmUHJvcHMuY29tcG9uZW50T3B0aW9uc1wiXG4gICAgICAgICAgICAgIFtibG9ja0NoaWxkcmVuXT1cImNvbXBvbmVudFJlZlByb3BzLmJsb2NrQ2hpbGRyZW5cIlxuICAgICAgICAgICAgICBbY29udGV4dF09XCJjb21wb25lbnRSZWZQcm9wcy5jb250ZXh0XCJcbiAgICAgICAgICAgICAgW3JlZ2lzdGVyZWRDb21wb25lbnRzXT1cImNvbXBvbmVudFJlZlByb3BzLnJlZ2lzdGVyZWRDb21wb25lbnRzXCJcbiAgICAgICAgICAgICAgW2xpbmtDb21wb25lbnRdPVwiY29tcG9uZW50UmVmUHJvcHMubGlua0NvbXBvbmVudFwiXG4gICAgICAgICAgICAgIFtidWlsZGVyQmxvY2tdPVwiY29tcG9uZW50UmVmUHJvcHMuYnVpbGRlckJsb2NrXCJcbiAgICAgICAgICAgICAgW2luY2x1ZGVCbG9ja1Byb3BzXT1cImNvbXBvbmVudFJlZlByb3BzLmluY2x1ZGVCbG9ja1Byb3BzXCJcbiAgICAgICAgICAgICAgW2lzSW50ZXJhY3RpdmVdPVwiY29tcG9uZW50UmVmUHJvcHMuaXNJbnRlcmFjdGl2ZVwiXG4gICAgICAgICAgICA+PC9jb21wb25lbnQtcmVmPlxuICAgICAgICAgICAgPG5nLWNvbnRhaW5lclxuICAgICAgICAgICAgICAqbmdGb3I9XCJsZXQgY2hpbGQgb2YgY2hpbGRyZW5XaXRob3V0UGFyZW50Q29tcG9uZW50OyB0cmFja0J5OiB0cmFja0J5Q2hpbGQwXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPGJsb2NrXG4gICAgICAgICAgICAgICAgW2Jsb2NrXT1cImNoaWxkXCJcbiAgICAgICAgICAgICAgICBbcmVnaXN0ZXJlZENvbXBvbmVudHNdPVwicmVnaXN0ZXJlZENvbXBvbmVudHNcIlxuICAgICAgICAgICAgICAgIFtsaW5rQ29tcG9uZW50XT1cImxpbmtDb21wb25lbnRcIlxuICAgICAgICAgICAgICAgIFtjb250ZXh0XT1cImNvbnRleHRcIlxuICAgICAgICAgICAgICA+PC9ibG9jaz5cbiAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgIDwvYmxvY2std3JhcHBlcj5cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhKCFyZXBlYXRJdGVtKVwiPlxuICAgICAgICAgIDxuZy1jb250YWluZXJcbiAgICAgICAgICAgICpuZ0Zvcj1cImxldCBkYXRhIG9mIHJlcGVhdEl0ZW07IGluZGV4IGFzIGluZGV4OyB0cmFja0J5OiB0cmFja0J5RGF0YTFcIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxyZXBlYXRlZC1ibG9ja1xuICAgICAgICAgICAgICBbcmVwZWF0Q29udGV4dF09XCJkYXRhLmNvbnRleHRcIlxuICAgICAgICAgICAgICBbYmxvY2tdPVwiZGF0YS5ibG9ja1wiXG4gICAgICAgICAgICAgIFtyZWdpc3RlcmVkQ29tcG9uZW50c109XCJyZWdpc3RlcmVkQ29tcG9uZW50c1wiXG4gICAgICAgICAgICAgIFtsaW5rQ29tcG9uZW50XT1cImxpbmtDb21wb25lbnRcIlxuICAgICAgICAgICAgPjwvcmVwZWF0ZWQtYmxvY2s+XG4gICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiISghYmxvY2tDb21wb25lbnQ/Lm5vV3JhcClcIj5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFyZXBlYXRJdGVtXCI+XG4gICAgICAgICAgPGNvbXBvbmVudC1yZWZcbiAgICAgICAgICAgIFtjb21wb25lbnRSZWZdPVwiY29tcG9uZW50UmVmUHJvcHMuY29tcG9uZW50UmVmXCJcbiAgICAgICAgICAgIFtjb21wb25lbnRPcHRpb25zXT1cImNvbXBvbmVudFJlZlByb3BzLmNvbXBvbmVudE9wdGlvbnNcIlxuICAgICAgICAgICAgW2Jsb2NrQ2hpbGRyZW5dPVwiY29tcG9uZW50UmVmUHJvcHMuYmxvY2tDaGlsZHJlblwiXG4gICAgICAgICAgICBbY29udGV4dF09XCJjb21wb25lbnRSZWZQcm9wcy5jb250ZXh0XCJcbiAgICAgICAgICAgIFtyZWdpc3RlcmVkQ29tcG9uZW50c109XCJjb21wb25lbnRSZWZQcm9wcy5yZWdpc3RlcmVkQ29tcG9uZW50c1wiXG4gICAgICAgICAgICBbbGlua0NvbXBvbmVudF09XCJjb21wb25lbnRSZWZQcm9wcy5saW5rQ29tcG9uZW50XCJcbiAgICAgICAgICAgIFtidWlsZGVyQmxvY2tdPVwiY29tcG9uZW50UmVmUHJvcHMuYnVpbGRlckJsb2NrXCJcbiAgICAgICAgICAgIFtpbmNsdWRlQmxvY2tQcm9wc109XCJjb21wb25lbnRSZWZQcm9wcy5pbmNsdWRlQmxvY2tQcm9wc1wiXG4gICAgICAgICAgICBbaXNJbnRlcmFjdGl2ZV09XCJjb21wb25lbnRSZWZQcm9wcy5pc0ludGVyYWN0aXZlXCJcbiAgICAgICAgICA+PC9jb21wb25lbnQtcmVmPlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiEoIXJlcGVhdEl0ZW0pXCI+XG4gICAgICAgICAgPG5nLWNvbnRhaW5lclxuICAgICAgICAgICAgKm5nRm9yPVwibGV0IGRhdGEgb2YgcmVwZWF0SXRlbTsgaW5kZXggYXMgaW5kZXg7IHRyYWNrQnk6IHRyYWNrQnlEYXRhMlwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPHJlcGVhdGVkLWJsb2NrXG4gICAgICAgICAgICAgIFtyZXBlYXRDb250ZXh0XT1cImRhdGEuY29udGV4dFwiXG4gICAgICAgICAgICAgIFtibG9ja109XCJkYXRhLmJsb2NrXCJcbiAgICAgICAgICAgICAgW3JlZ2lzdGVyZWRDb21wb25lbnRzXT1cInJlZ2lzdGVyZWRDb21wb25lbnRzXCJcbiAgICAgICAgICAgICAgW2xpbmtDb21wb25lbnRdPVwibGlua0NvbXBvbmVudFwiXG4gICAgICAgICAgICA+PC9yZXBlYXRlZC1ibG9jaz5cbiAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgYCxcbiAgc3R5bGVzOiBbXG4gICAgYFxuICAgICAgOmhvc3Qge1xuICAgICAgICBkaXNwbGF5OiBjb250ZW50cztcbiAgICAgIH1cbiAgICBgLFxuICBdLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgQ29tbW9uTW9kdWxlLFxuICAgIEJsb2NrU3R5bGVzLFxuICAgIFJlcGVhdGVkQmxvY2ssXG4gICAgQ29tcG9uZW50UmVmLFxuICAgIEJsb2NrV3JhcHBlcixcbiAgICBCbG9jayxcbiAgXSxcbn0pXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCbG9jayB7XG4gIEBJbnB1dCgpIGJsb2NrITogQmxvY2tQcm9wc1tcImJsb2NrXCJdO1xuICBASW5wdXQoKSBjb250ZXh0ITogQmxvY2tQcm9wc1tcImNvbnRleHRcIl07XG4gIEBJbnB1dCgpIHJlZ2lzdGVyZWRDb21wb25lbnRzITogQmxvY2tQcm9wc1tcInJlZ2lzdGVyZWRDb21wb25lbnRzXCJdO1xuICBASW5wdXQoKSBsaW5rQ29tcG9uZW50ITogQmxvY2tQcm9wc1tcImxpbmtDb21wb25lbnRcIl07XG5cbiAgZ2V0IHJlcGVhdEl0ZW0oKSB7XG4gICAgcmV0dXJuIGdldFJlcGVhdEl0ZW1EYXRhKHtcbiAgICAgIGJsb2NrOiB0aGlzLmJsb2NrLFxuICAgICAgY29udGV4dDogdGhpcy5jb250ZXh0LFxuICAgIH0pO1xuICB9XG4gIF9wcm9jZXNzZWRCbG9jayA9IHtcbiAgICB2YWx1ZTogbnVsbCBhcyBCdWlsZGVyQmxvY2sgfCBudWxsLFxuICAgIHVwZGF0ZTogZmFsc2UsXG4gIH07XG4gIGdldCBwcm9jZXNzZWRCbG9jaygpIHtcbiAgICBjb25zdCBibG9ja1RvVXNlID0gdGhpcy5ibG9jay5yZXBlYXQ/LmNvbGxlY3Rpb25cbiAgICAgID8gdGhpcy5ibG9ja1xuICAgICAgOiBnZXRQcm9jZXNzZWRCbG9jayh7XG4gICAgICAgICAgYmxvY2s6IHRoaXMuYmxvY2ssXG4gICAgICAgICAgbG9jYWxTdGF0ZTogdGhpcy5jb250ZXh0LmxvY2FsU3RhdGUsXG4gICAgICAgICAgcm9vdFN0YXRlOiB0aGlzLmNvbnRleHQucm9vdFN0YXRlLFxuICAgICAgICAgIHJvb3RTZXRTdGF0ZTogdGhpcy5jb250ZXh0LnJvb3RTZXRTdGF0ZSxcbiAgICAgICAgICBjb250ZXh0OiB0aGlzLmNvbnRleHQuY29udGV4dCxcbiAgICAgICAgfSk7XG4gICAgcmV0dXJuIGJsb2NrVG9Vc2U7XG4gIH1cbiAgZ2V0IGJsb2NrQ29tcG9uZW50KCkge1xuICAgIHJldHVybiBnZXRDb21wb25lbnQoe1xuICAgICAgYmxvY2s6IHRoaXMucHJvY2Vzc2VkQmxvY2ssXG4gICAgICByZWdpc3RlcmVkQ29tcG9uZW50czogdGhpcy5yZWdpc3RlcmVkQ29tcG9uZW50cyxcbiAgICAgIG1vZGVsOiB0aGlzLmNvbnRleHQubW9kZWwsXG4gICAgfSk7XG4gIH1cbiAgZ2V0IFRhZygpIHtcbiAgICBjb25zdCBzaG91bGRVc2VMaW5rID1cbiAgICAgIHRoaXMuYmxvY2sudGFnTmFtZSA9PT0gXCJhXCIgfHxcbiAgICAgIHRoaXMucHJvY2Vzc2VkQmxvY2sucHJvcGVydGllcz8uaHJlZiB8fFxuICAgICAgdGhpcy5wcm9jZXNzZWRCbG9jay5ocmVmO1xuICAgIGlmIChzaG91bGRVc2VMaW5rKSB7XG4gICAgICByZXR1cm4gdGhpcy5saW5rQ29tcG9uZW50IHx8IFwiYVwiO1xuICAgIH1cbiAgICByZXR1cm4gRHluYW1pY0RpdjtcbiAgfVxuICBnZXQgY2FuU2hvd0Jsb2NrKCkge1xuICAgIGlmICh0aGlzLmJsb2NrLnJlcGVhdD8uY29sbGVjdGlvbikge1xuICAgICAgaWYgKHRoaXMucmVwZWF0SXRlbT8ubGVuZ3RoKSByZXR1cm4gdHJ1ZTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3Qgc2hvdWxkSGlkZSA9XG4gICAgICBcImhpZGVcIiBpbiB0aGlzLnByb2Nlc3NlZEJsb2NrID8gdGhpcy5wcm9jZXNzZWRCbG9jay5oaWRlIDogZmFsc2U7XG4gICAgY29uc3Qgc2hvdWxkU2hvdyA9XG4gICAgICBcInNob3dcIiBpbiB0aGlzLnByb2Nlc3NlZEJsb2NrID8gdGhpcy5wcm9jZXNzZWRCbG9jay5zaG93IDogdHJ1ZTtcbiAgICByZXR1cm4gc2hvdWxkU2hvdyAmJiAhc2hvdWxkSGlkZTtcbiAgfVxuICBnZXQgY2hpbGRyZW5XaXRob3V0UGFyZW50Q29tcG9uZW50KCkge1xuICAgIC8qKlxuICAgICAqIFdoZW4gdGhlcmUgaXMgbm8gYGNvbXBvbmVudFJlZmAsIHRoZXJlIG1pZ2h0IHN0aWxsIGJlIGNoaWxkcmVuIHRoYXQgbmVlZCB0byBiZSByZW5kZXJlZC4gSW4gdGhpcyBjYXNlLFxuICAgICAqIHdlIHJlbmRlciB0aGVtIG91dHNpZGUgb2YgYGNvbXBvbmVudFJlZmAuXG4gICAgICogTk9URTogV2UgbWFrZSBzdXJlIG5vdCB0byByZW5kZXIgdGhpcyBpZiBgcmVwZWF0SXRlbURhdGFgIGlzIG5vbi1udWxsLCBiZWNhdXNlIHRoYXQgbWVhbnMgd2UgYXJlIHJlbmRlcmluZyBhbiBhcnJheSBvZlxuICAgICAqIGJsb2NrcywgYW5kIHRoZSBjaGlsZHJlbiB3aWxsIGJlIHJlcGVhdGVkIHdpdGhpbiB0aG9zZSBibG9ja3MuXG4gICAgICovXG4gICAgY29uc3Qgc2hvdWxkUmVuZGVyQ2hpbGRyZW5PdXRzaWRlUmVmID1cbiAgICAgICF0aGlzLmJsb2NrQ29tcG9uZW50Py5jb21wb25lbnQgJiYgIXRoaXMucmVwZWF0SXRlbTtcbiAgICByZXR1cm4gc2hvdWxkUmVuZGVyQ2hpbGRyZW5PdXRzaWRlUmVmXG4gICAgICA/IHRoaXMucHJvY2Vzc2VkQmxvY2suY2hpbGRyZW4gPz8gW11cbiAgICAgIDogW107XG4gIH1cbiAgZ2V0IGNvbXBvbmVudFJlZlByb3BzKCkge1xuICAgIHJldHVybiB7XG4gICAgICBibG9ja0NoaWxkcmVuOiB0aGlzLnByb2Nlc3NlZEJsb2NrLmNoaWxkcmVuID8/IFtdLFxuICAgICAgY29tcG9uZW50UmVmOiB0aGlzLmJsb2NrQ29tcG9uZW50Py5jb21wb25lbnQsXG4gICAgICBjb21wb25lbnRPcHRpb25zOiB7XG4gICAgICAgIC4uLmdldEJsb2NrQ29tcG9uZW50T3B0aW9ucyh0aGlzLnByb2Nlc3NlZEJsb2NrLCB0aGlzLmNvbnRleHQpLFxuICAgICAgICAuLi5wcm92aWRlQnVpbGRlckJsb2NrKHRoaXMuYmxvY2tDb21wb25lbnQsIHRoaXMucHJvY2Vzc2VkQmxvY2spLFxuICAgICAgICAuLi5wcm92aWRlQnVpbGRlckNvbnRleHQodGhpcy5ibG9ja0NvbXBvbmVudCwgdGhpcy5jb250ZXh0KSxcbiAgICAgICAgLi4ucHJvdmlkZUxpbmtDb21wb25lbnQodGhpcy5ibG9ja0NvbXBvbmVudCwgdGhpcy5saW5rQ29tcG9uZW50KSxcbiAgICAgICAgLi4ucHJvdmlkZVJlZ2lzdGVyZWRDb21wb25lbnRzKFxuICAgICAgICAgIHRoaXMuYmxvY2tDb21wb25lbnQsXG4gICAgICAgICAgdGhpcy5yZWdpc3RlcmVkQ29tcG9uZW50cyxcbiAgICAgICAgICB0aGlzLmNvbnRleHQubW9kZWxcbiAgICAgICAgKSxcbiAgICAgIH0sXG4gICAgICBjb250ZXh0OiB0aGlzLmNvbnRleHQsXG4gICAgICBsaW5rQ29tcG9uZW50OiB0aGlzLmxpbmtDb21wb25lbnQsXG4gICAgICByZWdpc3RlcmVkQ29tcG9uZW50czogdGhpcy5yZWdpc3RlcmVkQ29tcG9uZW50cyxcbiAgICAgIGJ1aWxkZXJCbG9jazogdGhpcy5wcm9jZXNzZWRCbG9jayxcbiAgICAgIGluY2x1ZGVCbG9ja1Byb3BzOiB0aGlzLmJsb2NrQ29tcG9uZW50Py5ub1dyYXAgPT09IHRydWUsXG4gICAgICBpc0ludGVyYWN0aXZlOiAhKHRoaXMuYmxvY2tDb21wb25lbnQ/LmlzUlNDICYmIFRBUkdFVCA9PT0gXCJyc2NcIiksXG4gICAgfTtcbiAgfVxuICB0cmFja0J5Q2hpbGQwKF8sIGNoaWxkKSB7XG4gICAgcmV0dXJuIGNoaWxkLmlkO1xuICB9XG4gIHRyYWNrQnlEYXRhMShpbmRleCwgZGF0YSkge1xuICAgIHJldHVybiBpbmRleDtcbiAgfVxuICB0cmFja0J5RGF0YTIoaW5kZXgsIGRhdGEpIHtcbiAgICByZXR1cm4gaW5kZXg7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgY29uc3QgYmxvY2tJZCA9IHRoaXMucHJvY2Vzc2VkQmxvY2suaWQ7XG4gICAgICBjb25zdCBhbmltYXRpb25zID0gdGhpcy5wcm9jZXNzZWRCbG9jay5hbmltYXRpb25zO1xuICAgICAgaWYgKGFuaW1hdGlvbnMgJiYgYmxvY2tJZCkge1xuICAgICAgICAvLyBpbiBBbmd1bGFyLCB0aGUgRHluYW1pY0RpdiBzZXRzIGF0dHJpYnV0ZXMgKGJ1aWxkZXItaWQpIG9uIHRoZSBlbGVtZW50IGxhdGUgKG5nQWZ0ZXJWaWV3SW5pdClcbiAgICAgICAgLy8gc28gd2UgbmVlZCB0byB3YWl0IGZvciB0aGVtIHRvIGJlIGF0dGFjaGVkIHRvIHRoZSBET00gYmVmb3JlIGNhbGxpbmcgdGhpcyBlbHNlIHdlJ2xsIG5vdCBmaW5kIHRoZSBlbGVtZW50XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgICAgYmluZEFuaW1hdGlvbnMoXG4gICAgICAgICAgICBhbmltYXRpb25zLm1hcCgoYW5pbWF0aW9uKSA9PiAoe1xuICAgICAgICAgICAgICAuLi5hbmltYXRpb24sXG4gICAgICAgICAgICAgIGVsZW1lbnRJZDogYmxvY2tJZCxcbiAgICAgICAgICAgIH0pKVxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIH1cbiAgfVxufVxuIl19