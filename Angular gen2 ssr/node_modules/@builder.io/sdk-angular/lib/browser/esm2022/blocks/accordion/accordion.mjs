import { Component, Input } from "@angular/core";
import { CommonModule } from "@angular/common";
import Blocks from "../../components/blocks/index";
import { convertOrderNumberToString } from "./helpers";
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export default class Accordion {
    constructor() {
        this.open = [];
        this.node_0_div = (item, index) => this.getAccordionTitleClassName(index);
        this.node_1_div = (item, index) => ({
            ...this.accordionTitleStyles,
            ...(this.grid && {
                width: this.gridRowWidth,
                ...{
                    order: this.openGridItemOrder !== null
                        ? convertOrderNumberToString(index)
                        : convertOrderNumberToString(index + 1),
                },
            }),
        });
        this.node_3_Blocks = (item, index) => `items.${index}.title`;
        this.node_4_Show = (item, index) => this.open.includes(index);
        this.node_5_div = (item, index) => this.getAccordionDetailClassName(index);
        this.node_6_Blocks = (item, index) => `items.${index}.detail`;
    }
    get onlyOneAtATime() {
        return Boolean(this.grid || this.oneAtATime);
    }
    get accordionStyles() {
        const styles = {
            display: "flex",
            alignItems: "stretch",
            flexDirection: "column",
            ...(this.grid && {
                flexDirection: "row",
                alignItems: "flex-start",
                flexWrap: "wrap",
            }),
        };
        return styles;
    }
    get accordionTitleStyles() {
        const shared = {
            display: "flex",
            flexDirection: "column",
        };
        const styles = {
            ...shared,
            alignItems: "stretch",
            cursor: "pointer",
        };
        return Object.fromEntries(Object.entries(styles).filter(([_, value]) => value !== undefined));
    }
    getAccordionTitleClassName(index) {
        return `builder-accordion-title builder-accordion-title-${this.open.includes(index) ? "open" : "closed"}`;
    }
    getAccordionDetailClassName(index) {
        return `builder-accordion-detail builder-accordion-detail-${this.open.includes(index) ? "open" : "closed"}`;
    }
    get openGridItemOrder() {
        let itemOrder = null;
        const getOpenGridItemPosition = this.grid && this.open.length;
        if (getOpenGridItemPosition && document) {
            const openItemIndex = this.open[0];
            const openItem = document.querySelector(`.builder-accordion-title[data-index="${openItemIndex}"]`);
            let subjectItem = openItem;
            itemOrder = openItemIndex;
            if (subjectItem) {
                let prevItemRect = subjectItem.getBoundingClientRect();
                while ((subjectItem = subjectItem && subjectItem.nextElementSibling)) {
                    if (subjectItem) {
                        if (subjectItem.classList.contains("builder-accordion-detail")) {
                            continue;
                        }
                        const subjectItemRect = subjectItem.getBoundingClientRect();
                        if (subjectItemRect.left > prevItemRect.left) {
                            const index = parseInt(subjectItem.getAttribute("data-index") || "", 10);
                            if (!isNaN(index)) {
                                prevItemRect = subjectItemRect;
                                itemOrder = index;
                            }
                        }
                        else {
                            break;
                        }
                    }
                }
            }
        }
        if (typeof itemOrder === "number") {
            itemOrder = itemOrder + 1;
        }
        return itemOrder;
    }
    get accordionDetailStyles() {
        const styles = {
            ...{
                order: typeof this.openGridItemOrder === "number"
                    ? this.openGridItemOrder
                    : undefined,
            },
            ...(this.grid && {
                width: "100%",
            }),
        };
        return Object.fromEntries(Object.entries(styles).filter(([_, value]) => value !== undefined));
    }
    onClick(index) {
        if (this.open.includes(index)) {
            this.open = this.onlyOneAtATime
                ? []
                : this.open.filter((item) => item !== index);
        }
        else {
            this.open = this.onlyOneAtATime ? [index] : this.open.concat(index);
        }
    }
    trackByItem0(index, item) {
        return index;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: Accordion, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: Accordion, isStandalone: true, selector: "accordion", inputs: { grid: "grid", oneAtATime: "oneAtATime", gridRowWidth: "gridRowWidth", items: "items", builderBlock: "builderBlock", builderContext: "builderContext", builderComponents: "builderComponents", builderLinkComponent: "builderLinkComponent" }, ngImport: i0, template: `
    <div class="builder-accordion" [ngStyle]="accordionStyles">
      <ng-container
        *ngFor="let item of items; index as index; trackBy: trackByItem0"
      >
        <ng-container>
          <div
            [class]="node_0_div(item, index)"
            [ngStyle]="node_1_div(item, index)"
            [attr.data-index]="index"
            (click)="onClick(index)"
          >
            <blocks
              [blocks]="item.title"
              [path]="node_3_Blocks(item, index)"
              [parent]="builderBlock.id"
              [context]="builderContext"
              [registeredComponents]="builderComponents"
              [linkComponent]="builderLinkComponent"
            ></blocks>
          </div>
          <ng-container *ngIf="node_4_Show(item, index)">
            <div
              [class]="node_5_div(item, index)"
              [ngStyle]="accordionDetailStyles"
            >
              <blocks
                [blocks]="item.detail"
                [path]="node_6_Blocks(item, index)"
                [parent]="builderBlock.id"
                [context]="builderContext"
                [registeredComponents]="builderComponents"
                [linkComponent]="builderLinkComponent"
              ></blocks>
            </div>
          </ng-container>
        </ng-container>
      </ng-container>
    </div>
  `, isInline: true, styles: [":host{display:contents}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i1.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { kind: "component", type: Blocks, selector: "blocks", inputs: ["blocks", "parent", "path", "styleProp", "className", "context", "linkComponent", "registeredComponents"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: Accordion, decorators: [{
            type: Component,
            args: [{ selector: "accordion", template: `
    <div class="builder-accordion" [ngStyle]="accordionStyles">
      <ng-container
        *ngFor="let item of items; index as index; trackBy: trackByItem0"
      >
        <ng-container>
          <div
            [class]="node_0_div(item, index)"
            [ngStyle]="node_1_div(item, index)"
            [attr.data-index]="index"
            (click)="onClick(index)"
          >
            <blocks
              [blocks]="item.title"
              [path]="node_3_Blocks(item, index)"
              [parent]="builderBlock.id"
              [context]="builderContext"
              [registeredComponents]="builderComponents"
              [linkComponent]="builderLinkComponent"
            ></blocks>
          </div>
          <ng-container *ngIf="node_4_Show(item, index)">
            <div
              [class]="node_5_div(item, index)"
              [ngStyle]="accordionDetailStyles"
            >
              <blocks
                [blocks]="item.detail"
                [path]="node_6_Blocks(item, index)"
                [parent]="builderBlock.id"
                [context]="builderContext"
                [registeredComponents]="builderComponents"
                [linkComponent]="builderLinkComponent"
              ></blocks>
            </div>
          </ng-container>
        </ng-container>
      </ng-container>
    </div>
  `, standalone: true, imports: [CommonModule, Blocks], styles: [":host{display:contents}\n"] }]
        }], propDecorators: { grid: [{
                type: Input
            }], oneAtATime: [{
                type: Input
            }], gridRowWidth: [{
                type: Input
            }], items: [{
                type: Input
            }], builderBlock: [{
                type: Input
            }], builderContext: [{
                type: Input
            }], builderComponents: [{
                type: Input
            }], builderLinkComponent: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjb3JkaW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2Jsb2Nrcy9hY2NvcmRpb24vYWNjb3JkaW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUvQyxPQUFPLE1BQU0sTUFBTSwrQkFBK0IsQ0FBQztBQUluRCxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxXQUFXLENBQUM7OztBQXNEdkQsTUFBTSxDQUFDLE9BQU8sT0FBTyxTQUFTO0lBcEQ5QjtRQThERSxTQUFJLEdBQUcsRUFBRSxDQUFDO1FBMkhWLGVBQVUsR0FBRyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNyRSxlQUFVLEdBQUcsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzdCLEdBQUcsSUFBSSxDQUFDLG9CQUFvQjtZQUM1QixHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSTtnQkFDZixLQUFLLEVBQUUsSUFBSSxDQUFDLFlBQVk7Z0JBQ3hCLEdBQUk7b0JBQ0YsS0FBSyxFQUNILElBQUksQ0FBQyxpQkFBaUIsS0FBSyxJQUFJO3dCQUM3QixDQUFDLENBQUMsMEJBQTBCLENBQUMsS0FBSyxDQUFDO3dCQUNuQyxDQUFDLENBQUMsMEJBQTBCLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztpQkFDcEM7YUFDVixDQUFDO1NBQ0gsQ0FBQyxDQUFDO1FBQ0gsa0JBQWEsR0FBRyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLFNBQVMsS0FBSyxRQUFRLENBQUM7UUFDeEQsZ0JBQVcsR0FBRyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUs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LEdBQUcsSUFBSSxDQUFDLGNBQWM7Z0JBQzdCLENBQUMsQ0FBQyxFQUFFO2dCQUNKLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxLQUFLLEtBQUssQ0FBQyxDQUFDO1NBQ2hEO2FBQU07WUFDTCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3JFO0lBQ0gsQ0FBQztJQWtCRCxZQUFZLENBQUMsS0FBSyxFQUFFLElBQUk7UUFDdEIsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDOytHQXhKa0IsU0FBUzttR0FBVCxTQUFTLDZUQWxEbEI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQXVDVCxrR0FTUyxZQUFZLHFWQUFFLE1BQU07OzRGQUVYLFNBQVM7a0JBcEQ3QixTQUFTOytCQUNFLFdBQVcsWUFDWDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBdUNULGNBUVcsSUFBSSxXQUNQLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQzs4QkFHdEIsSUFBSTtzQkFBWixLQUFLO2dCQUNHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBQ0csWUFBWTtzQkFBcEIsS0FBSztnQkFDRyxLQUFLO3NCQUFiLEtBQUs7Z0JBQ0csWUFBWTtzQkFBcEIsS0FBSztnQkFDRyxjQUFjO3NCQUF0QixLQUFLO2dCQUNHLGlCQUFpQjtzQkFBekIsS0FBSztnQkFDRyxvQkFBb0I7c0JBQTVCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gXCJAYW5ndWxhci9jb21tb25cIjtcblxuaW1wb3J0IEJsb2NrcyBmcm9tIFwiLi4vLi4vY29tcG9uZW50cy9ibG9ja3MvaW5kZXhcIjtcbmltcG9ydCB7IGNhbWVsVG9LZWJhYkNhc2UgfSBmcm9tIFwiLi4vLi4vZnVuY3Rpb25zL2NhbWVsLXRvLWtlYmFiLWNhc2VcIjtcbmltcG9ydCB0eXBlIHsgRGljdGlvbmFyeSB9IGZyb20gXCIuLi8uLi90eXBlcy90eXBlc2NyaXB0XCI7XG5pbXBvcnQgdHlwZSB7IEFjY29yZGlvblByb3BzIH0gZnJvbSBcIi4vYWNjb3JkaW9uLnR5cGVzXCI7XG5pbXBvcnQgeyBjb252ZXJ0T3JkZXJOdW1iZXJUb1N0cmluZyB9IGZyb20gXCIuL2hlbHBlcnNcIjtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcImFjY29yZGlvblwiLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxkaXYgY2xhc3M9XCJidWlsZGVyLWFjY29yZGlvblwiIFtuZ1N0eWxlXT1cImFjY29yZGlvblN0eWxlc1wiPlxuICAgICAgPG5nLWNvbnRhaW5lclxuICAgICAgICAqbmdGb3I9XCJsZXQgaXRlbSBvZiBpdGVtczsgaW5kZXggYXMgaW5kZXg7IHRyYWNrQnk6IHRyYWNrQnlJdGVtMFwiXG4gICAgICA+XG4gICAgICAgIDxuZy1jb250YWluZXI+XG4gICAgICAgICAgPGRpdlxuICAgICAgICAgICAgW2NsYXNzXT1cIm5vZGVfMF9kaXYoaXRlbSwgaW5kZXgpXCJcbiAgICAgICAgICAgIFtuZ1N0eWxlXT1cIm5vZGVfMV9kaXYoaXRlbSwgaW5kZXgpXCJcbiAgICAgICAgICAgIFthdHRyLmRhdGEtaW5kZXhdPVwiaW5kZXhcIlxuICAgICAgICAgICAgKGNsaWNrKT1cIm9uQ2xpY2soaW5kZXgpXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICA8YmxvY2tzXG4gICAgICAgICAgICAgIFtibG9ja3NdPVwiaXRlbS50aXRsZVwiXG4gICAgICAgICAgICAgIFtwYXRoXT1cIm5vZGVfM19CbG9ja3MoaXRlbSwgaW5kZXgpXCJcbiAgICAgICAgICAgICAgW3BhcmVudF09XCJidWlsZGVyQmxvY2suaWRcIlxuICAgICAgICAgICAgICBbY29udGV4dF09XCJidWlsZGVyQ29udGV4dFwiXG4gICAgICAgICAgICAgIFtyZWdpc3RlcmVkQ29tcG9uZW50c109XCJidWlsZGVyQ29tcG9uZW50c1wiXG4gICAgICAgICAgICAgIFtsaW5rQ29tcG9uZW50XT1cImJ1aWxkZXJMaW5rQ29tcG9uZW50XCJcbiAgICAgICAgICAgID48L2Jsb2Nrcz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwibm9kZV80X1Nob3coaXRlbSwgaW5kZXgpXCI+XG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgIFtjbGFzc109XCJub2RlXzVfZGl2KGl0ZW0sIGluZGV4KVwiXG4gICAgICAgICAgICAgIFtuZ1N0eWxlXT1cImFjY29yZGlvbkRldGFpbFN0eWxlc1wiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxibG9ja3NcbiAgICAgICAgICAgICAgICBbYmxvY2tzXT1cIml0ZW0uZGV0YWlsXCJcbiAgICAgICAgICAgICAgICBbcGF0aF09XCJub2RlXzZfQmxvY2tzKGl0ZW0sIGluZGV4KVwiXG4gICAgICAgICAgICAgICAgW3BhcmVudF09XCJidWlsZGVyQmxvY2suaWRcIlxuICAgICAgICAgICAgICAgIFtjb250ZXh0XT1cImJ1aWxkZXJDb250ZXh0XCJcbiAgICAgICAgICAgICAgICBbcmVnaXN0ZXJlZENvbXBvbmVudHNdPVwiYnVpbGRlckNvbXBvbmVudHNcIlxuICAgICAgICAgICAgICAgIFtsaW5rQ29tcG9uZW50XT1cImJ1aWxkZXJMaW5rQ29tcG9uZW50XCJcbiAgICAgICAgICAgICAgPjwvYmxvY2tzPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9kaXY+XG4gIGAsXG4gIHN0eWxlczogW1xuICAgIGBcbiAgICAgIDpob3N0IHtcbiAgICAgICAgZGlzcGxheTogY29udGVudHM7XG4gICAgICB9XG4gICAgYCxcbiAgXSxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW0NvbW1vbk1vZHVsZSwgQmxvY2tzXSxcbn0pXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBY2NvcmRpb24ge1xuICBASW5wdXQoKSBncmlkITogQWNjb3JkaW9uUHJvcHNbXCJncmlkXCJdO1xuICBASW5wdXQoKSBvbmVBdEFUaW1lITogQWNjb3JkaW9uUHJvcHNbXCJvbmVBdEFUaW1lXCJdO1xuICBASW5wdXQoKSBncmlkUm93V2lkdGghOiBBY2NvcmRpb25Qcm9wc1tcImdyaWRSb3dXaWR0aFwiXTtcbiAgQElucHV0KCkgaXRlbXMhOiBBY2NvcmRpb25Qcm9wc1tcIml0ZW1zXCJdO1xuICBASW5wdXQoKSBidWlsZGVyQmxvY2shOiBBY2NvcmRpb25Qcm9wc1tcImJ1aWxkZXJCbG9ja1wiXTtcbiAgQElucHV0KCkgYnVpbGRlckNvbnRleHQhOiBBY2NvcmRpb25Qcm9wc1tcImJ1aWxkZXJDb250ZXh0XCJdO1xuICBASW5wdXQoKSBidWlsZGVyQ29tcG9uZW50cyE6IEFjY29yZGlvblByb3BzW1wiYnVpbGRlckNvbXBvbmVudHNcIl07XG4gIEBJbnB1dCgpIGJ1aWxkZXJMaW5rQ29tcG9uZW50ITogQWNjb3JkaW9uUHJvcHNbXCJidWlsZGVyTGlua0NvbXBvbmVudFwiXTtcblxuICBvcGVuID0gW107XG4gIGdldCBvbmx5T25lQXRBVGltZSgpIHtcbiAgICByZXR1cm4gQm9vbGVhbih0aGlzLmdyaWQgfHwgdGhpcy5vbmVBdEFUaW1lKTtcbiAgfVxuICBnZXQgYWNjb3JkaW9uU3R5bGVzKCkge1xuICAgIGNvbnN0IHN0eWxlcyA9IHtcbiAgICAgIGRpc3BsYXk6IFwiZmxleFwiIGFzIFwiZmxleFwiIHwgXCJub25lXCIsXG4gICAgICBhbGlnbkl0ZW1zOiBcInN0cmV0Y2hcIiBhc1xuICAgICAgICB8IFwic3RyZXRjaFwiXG4gICAgICAgIHwgXCJmbGV4LXN0YXJ0XCJcbiAgICAgICAgfCBcImZsZXgtZW5kXCJcbiAgICAgICAgfCBcImNlbnRlclwiXG4gICAgICAgIHwgXCJiYXNlbGluZVwiLFxuICAgICAgZmxleERpcmVjdGlvbjogXCJjb2x1bW5cIiBhc1xuICAgICAgICB8IFwiY29sdW1uXCJcbiAgICAgICAgfCBcInJvd1wiXG4gICAgICAgIHwgXCJjb2x1bW4tcmV2ZXJzZVwiXG4gICAgICAgIHwgXCJyb3ctcmV2ZXJzZVwiLFxuICAgICAgLi4uKHRoaXMuZ3JpZCAmJiB7XG4gICAgICAgIGZsZXhEaXJlY3Rpb246IFwicm93XCIgYXNcbiAgICAgICAgICB8IFwiY29sdW1uXCJcbiAgICAgICAgICB8IFwicm93XCJcbiAgICAgICAgICB8IFwiY29sdW1uLXJldmVyc2VcIlxuICAgICAgICAgIHwgXCJyb3ctcmV2ZXJzZVwiLFxuICAgICAgICBhbGlnbkl0ZW1zOiBcImZsZXgtc3RhcnRcIiBhc1xuICAgICAgICAgIHwgXCJzdHJldGNoXCJcbiAgICAgICAgICB8IFwiZmxleC1zdGFydFwiXG4gICAgICAgICAgfCBcImZsZXgtZW5kXCJcbiAgICAgICAgICB8IFwiY2VudGVyXCJcbiAgICAgICAgICB8IFwiYmFzZWxpbmVcIixcbiAgICAgICAgZmxleFdyYXA6IFwid3JhcFwiIGFzIFwibm93cmFwXCIgfCBcIndyYXBcIixcbiAgICAgIH0pLFxuICAgIH07XG4gICAgcmV0dXJuIHN0eWxlcztcbiAgfVxuICBnZXQgYWNjb3JkaW9uVGl0bGVTdHlsZXMoKSB7XG4gICAgY29uc3Qgc2hhcmVkID0ge1xuICAgICAgZGlzcGxheTogXCJmbGV4XCIsXG4gICAgICBmbGV4RGlyZWN0aW9uOiBcImNvbHVtblwiLFxuICAgIH07XG4gICAgY29uc3Qgc3R5bGVzID0ge1xuICAgICAgLi4uc2hhcmVkLFxuICAgICAgYWxpZ25JdGVtczogXCJzdHJldGNoXCIsXG4gICAgICBjdXJzb3I6IFwicG9pbnRlclwiLFxuICAgIH07XG4gICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgIE9iamVjdC5lbnRyaWVzKHN0eWxlcykuZmlsdGVyKChbXywgdmFsdWVdKSA9PiB2YWx1ZSAhPT0gdW5kZWZpbmVkKVxuICAgICkgYXMgRGljdGlvbmFyeTxzdHJpbmc+O1xuICB9XG4gIGdldEFjY29yZGlvblRpdGxlQ2xhc3NOYW1lKGluZGV4OiBudW1iZXIpIHtcbiAgICByZXR1cm4gYGJ1aWxkZXItYWNjb3JkaW9uLXRpdGxlIGJ1aWxkZXItYWNjb3JkaW9uLXRpdGxlLSR7XG4gICAgICB0aGlzLm9wZW4uaW5jbHVkZXMoaW5kZXgpID8gXCJvcGVuXCIgOiBcImNsb3NlZFwiXG4gICAgfWA7XG4gIH1cbiAgZ2V0QWNjb3JkaW9uRGV0YWlsQ2xhc3NOYW1lKGluZGV4OiBudW1iZXIpIHtcbiAgICByZXR1cm4gYGJ1aWxkZXItYWNjb3JkaW9uLWRldGFpbCBidWlsZGVyLWFjY29yZGlvbi1kZXRhaWwtJHtcbiAgICAgIHRoaXMub3Blbi5pbmNsdWRlcyhpbmRleCkgPyBcIm9wZW5cIiA6IFwiY2xvc2VkXCJcbiAgICB9YDtcbiAgfVxuICBnZXQgb3BlbkdyaWRJdGVtT3JkZXIoKSB7XG4gICAgbGV0IGl0ZW1PcmRlcjogbnVtYmVyIHwgbnVsbCA9IG51bGw7XG4gICAgY29uc3QgZ2V0T3BlbkdyaWRJdGVtUG9zaXRpb24gPSB0aGlzLmdyaWQgJiYgdGhpcy5vcGVuLmxlbmd0aDtcbiAgICBpZiAoZ2V0T3BlbkdyaWRJdGVtUG9zaXRpb24gJiYgZG9jdW1lbnQpIHtcbiAgICAgIGNvbnN0IG9wZW5JdGVtSW5kZXggPSB0aGlzLm9wZW5bMF07XG4gICAgICBjb25zdCBvcGVuSXRlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIGAuYnVpbGRlci1hY2NvcmRpb24tdGl0bGVbZGF0YS1pbmRleD1cIiR7b3Blbkl0ZW1JbmRleH1cIl1gXG4gICAgICApO1xuICAgICAgbGV0IHN1YmplY3RJdGVtID0gb3Blbkl0ZW07XG4gICAgICBpdGVtT3JkZXIgPSBvcGVuSXRlbUluZGV4O1xuICAgICAgaWYgKHN1YmplY3RJdGVtKSB7XG4gICAgICAgIGxldCBwcmV2SXRlbVJlY3QgPSBzdWJqZWN0SXRlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgd2hpbGUgKChzdWJqZWN0SXRlbSA9IHN1YmplY3RJdGVtICYmIHN1YmplY3RJdGVtLm5leHRFbGVtZW50U2libGluZykpIHtcbiAgICAgICAgICBpZiAoc3ViamVjdEl0ZW0pIHtcbiAgICAgICAgICAgIGlmIChzdWJqZWN0SXRlbS5jbGFzc0xpc3QuY29udGFpbnMoXCJidWlsZGVyLWFjY29yZGlvbi1kZXRhaWxcIikpIHtcbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzdWJqZWN0SXRlbVJlY3QgPSBzdWJqZWN0SXRlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgIGlmIChzdWJqZWN0SXRlbVJlY3QubGVmdCA+IHByZXZJdGVtUmVjdC5sZWZ0KSB7XG4gICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQoXG4gICAgICAgICAgICAgICAgc3ViamVjdEl0ZW0uZ2V0QXR0cmlidXRlKFwiZGF0YS1pbmRleFwiKSB8fCBcIlwiLFxuICAgICAgICAgICAgICAgIDEwXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIGlmICghaXNOYU4oaW5kZXgpKSB7XG4gICAgICAgICAgICAgICAgcHJldkl0ZW1SZWN0ID0gc3ViamVjdEl0ZW1SZWN0O1xuICAgICAgICAgICAgICAgIGl0ZW1PcmRlciA9IGluZGV4O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHR5cGVvZiBpdGVtT3JkZXIgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgIGl0ZW1PcmRlciA9IGl0ZW1PcmRlciArIDE7XG4gICAgfVxuICAgIHJldHVybiBpdGVtT3JkZXI7XG4gIH1cbiAgZ2V0IGFjY29yZGlvbkRldGFpbFN0eWxlcygpIHtcbiAgICBjb25zdCBzdHlsZXMgPSB7XG4gICAgICAuLi57XG4gICAgICAgIG9yZGVyOlxuICAgICAgICAgIHR5cGVvZiB0aGlzLm9wZW5HcmlkSXRlbU9yZGVyID09PSBcIm51bWJlclwiXG4gICAgICAgICAgICA/ICh0aGlzLm9wZW5HcmlkSXRlbU9yZGVyIGFzIG51bWJlcilcbiAgICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgfSxcbiAgICAgIC4uLih0aGlzLmdyaWQgJiYge1xuICAgICAgICB3aWR0aDogXCIxMDAlXCIsXG4gICAgICB9KSxcbiAgICB9O1xuICAgIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICBPYmplY3QuZW50cmllcyhzdHlsZXMpLmZpbHRlcigoW18sIHZhbHVlXSkgPT4gdmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICApIGFzIERpY3Rpb25hcnk8c3RyaW5nPjtcbiAgfVxuICBvbkNsaWNrKGluZGV4OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5vcGVuLmluY2x1ZGVzKGluZGV4KSkge1xuICAgICAgdGhpcy5vcGVuID0gdGhpcy5vbmx5T25lQXRBVGltZVxuICAgICAgICA/IFtdXG4gICAgICAgIDogdGhpcy5vcGVuLmZpbHRlcigoaXRlbSkgPT4gaXRlbSAhPT0gaW5kZXgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9wZW4gPSB0aGlzLm9ubHlPbmVBdEFUaW1lID8gW2luZGV4XSA6IHRoaXMub3Blbi5jb25jYXQoaW5kZXgpO1xuICAgIH1cbiAgfVxuICBub2RlXzBfZGl2ID0gKGl0ZW0sIGluZGV4KSA9PiB0aGlzLmdldEFjY29yZGlvblRpdGxlQ2xhc3NOYW1lKGluZGV4KTtcbiAgbm9kZV8xX2RpdiA9IChpdGVtLCBpbmRleCkgPT4gKHtcbiAgICAuLi50aGlzLmFjY29yZGlvblRpdGxlU3R5bGVzLFxuICAgIC4uLih0aGlzLmdyaWQgJiYge1xuICAgICAgd2lkdGg6IHRoaXMuZ3JpZFJvd1dpZHRoLFxuICAgICAgLi4uKHtcbiAgICAgICAgb3JkZXI6XG4gICAgICAgICAgdGhpcy5vcGVuR3JpZEl0ZW1PcmRlciAhPT0gbnVsbFxuICAgICAgICAgICAgPyBjb252ZXJ0T3JkZXJOdW1iZXJUb1N0cmluZyhpbmRleClcbiAgICAgICAgICAgIDogY29udmVydE9yZGVyTnVtYmVyVG9TdHJpbmcoaW5kZXggKyAxKSxcbiAgICAgIH0gYXMgYW55KSxcbiAgICB9KSxcbiAgfSk7XG4gIG5vZGVfM19CbG9ja3MgPSAoaXRlbSwgaW5kZXgpID0+IGBpdGVtcy4ke2luZGV4fS50aXRsZWA7XG4gIG5vZGVfNF9TaG93ID0gKGl0ZW0sIGluZGV4KSA9PiB0aGlzLm9wZW4uaW5jbHVkZXMoaW5kZXgpO1xuICBub2RlXzVfZGl2ID0gKGl0ZW0sIGluZGV4KSA9PiB0aGlzLmdldEFjY29yZGlvbkRldGFpbENsYXNzTmFtZShpbmRleCk7XG4gIG5vZGVfNl9CbG9ja3MgPSAoaXRlbSwgaW5kZXgpID0+IGBpdGVtcy4ke2luZGV4fS5kZXRhaWxgO1xuICB0cmFja0J5SXRlbTAoaW5kZXgsIGl0ZW0pIHtcbiAgICByZXR1cm4gaW5kZXg7XG4gIH1cbn1cbiJdfQ==