import { Component, Input } from "@angular/core";
import { CommonModule } from "@angular/common";
import { getSrcSet } from "./image.helpers";
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export default class BuilderImage {
    constructor() {
        this.node_0_img = null;
        this.node_1_img = null;
        this.node_2_Show = null;
        this.node_3_div = null;
    }
    get srcSetToUse() {
        const imageToUse = this.image || this.src;
        const url = imageToUse;
        if (!url ||
            // We can auto add srcset for cdn.builder.io and shopify
            // images, otherwise you can supply this prop manually
            !(typeof url === "string" &&
                (url.match(/builder\.io/) || url.match(/cdn\.shopify\.com/)))) {
            return this.srcset;
        }
        if (this.noWebp) {
            return undefined; // no need to add srcset to svg images
        }
        if (this.srcset && this.image?.includes("builder.io/api/v1/image")) {
            if (!this.srcset.includes(this.image.split("?")[0])) {
                console.debug("Removed given srcset");
                return getSrcSet(url);
            }
        }
        else if (this.image && !this.srcset) {
            return getSrcSet(url);
        }
        return getSrcSet(url);
    }
    get webpSrcSet() {
        if (this.srcSetToUse?.match(/builder\.io/) && !this.noWebp) {
            return this.srcSetToUse.replace(/\?/g, "?format=webp&");
        }
        else {
            return "";
        }
    }
    get aspectRatioCss() {
        const aspectRatioStyles = {
            position: "absolute",
            height: "100%",
            width: "100%",
            left: "0px",
            top: "0px",
        };
        const out = this.aspectRatio ? aspectRatioStyles : undefined;
        return out;
    }
    ngOnInit() {
        this.node_0_img = {
            objectPosition: this.backgroundPosition || "center",
            objectFit: this.backgroundSize || "cover",
            ...this.aspectRatioCss,
        };
        this.node_1_img =
            "builder-image" + (this.className ? " " + this.className : "");
        this.node_2_Show =
            this.aspectRatio &&
                !(this.builderBlock?.children?.length && this.fitContent);
        this.node_3_div = {
            paddingTop: this.aspectRatio * 100 + "%",
        };
    }
    ngOnChanges(changes) {
        if (typeof window !== "undefined") {
            this.node_0_img = {
                objectPosition: this.backgroundPosition || "center",
                objectFit: this.backgroundSize || "cover",
                ...this.aspectRatioCss,
            };
            this.node_1_img =
                "builder-image" + (this.className ? " " + this.className : "");
            this.node_2_Show =
                this.aspectRatio &&
                    !(this.builderBlock?.children?.length && this.fitContent);
            this.node_3_div = {
                paddingTop: this.aspectRatio * 100 + "%",
            };
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: BuilderImage, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: BuilderImage, isStandalone: true, selector: "builder-image", inputs: { backgroundPosition: "backgroundPosition", backgroundSize: "backgroundSize", className: "className", aspectRatio: "aspectRatio", builderBlock: "builderBlock", fitContent: "fitContent", image: "image", src: "src", srcset: "srcset", noWebp: "noWebp", highPriority: "highPriority", altText: "altText", sizes: "sizes" }, usesOnChanges: true, ngImport: i0, template: `
    <ng-container>
      <picture>
        <ng-container *ngIf="webpSrcSet">
          <source type="image/webp" [attr.srcset]="webpSrcSet" />
        </ng-container>
        <img
          [attr.loading]="highPriority ? 'eager' : 'lazy'"
          [attr.fetchpriority]="highPriority ? 'high' : 'auto'"
          [attr.alt]="altText"
          [attr.role]="altText ? undefined : 'presentation'"
          [ngStyle]="node_0_img"
          [class]="node_1_img + ' img'"
          [attr.src]="image"
          [attr.srcset]="srcSetToUse"
          [attr.sizes]="sizes"
        />
      </picture>
      <ng-container *ngIf="node_2_Show">
        <div class="builder-image-sizer div" [ngStyle]="node_3_div"></div>
      </ng-container>
      <ng-container *ngIf="builderBlock?.children?.length && fitContent">
        <ng-content></ng-content>
      </ng-container>
      <ng-container *ngIf="!fitContent && builderBlock?.children?.length">
        <div class="div-2"><ng-content></ng-content></div>
      </ng-container>
    </ng-container>
  `, isInline: true, styles: [":host{display:contents}.img{opacity:1;transition:opacity .2s ease-in-out}.div{width:100%;pointer-events:none;font-size:0}.div-2{display:flex;flex-direction:column;align-items:stretch;position:absolute;top:0;left:0;width:100%;height:100%}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i1.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: BuilderImage, decorators: [{
            type: Component,
            args: [{ selector: "builder-image", template: `
    <ng-container>
      <picture>
        <ng-container *ngIf="webpSrcSet">
          <source type="image/webp" [attr.srcset]="webpSrcSet" />
        </ng-container>
        <img
          [attr.loading]="highPriority ? 'eager' : 'lazy'"
          [attr.fetchpriority]="highPriority ? 'high' : 'auto'"
          [attr.alt]="altText"
          [attr.role]="altText ? undefined : 'presentation'"
          [ngStyle]="node_0_img"
          [class]="node_1_img + ' img'"
          [attr.src]="image"
          [attr.srcset]="srcSetToUse"
          [attr.sizes]="sizes"
        />
      </picture>
      <ng-container *ngIf="node_2_Show">
        <div class="builder-image-sizer div" [ngStyle]="node_3_div"></div>
      </ng-container>
      <ng-container *ngIf="builderBlock?.children?.length && fitContent">
        <ng-content></ng-content>
      </ng-container>
      <ng-container *ngIf="!fitContent && builderBlock?.children?.length">
        <div class="div-2"><ng-content></ng-content></div>
      </ng-container>
    </ng-container>
  `, standalone: true, imports: [CommonModule], styles: [":host{display:contents}.img{opacity:1;transition:opacity .2s ease-in-out}.div{width:100%;pointer-events:none;font-size:0}.div-2{display:flex;flex-direction:column;align-items:stretch;position:absolute;top:0;left:0;width:100%;height:100%}\n"] }]
        }], propDecorators: { backgroundPosition: [{
                type: Input
            }], backgroundSize: [{
                type: Input
            }], className: [{
                type: Input
            }], aspectRatio: [{
                type: Input
            }], builderBlock: [{
                type: Input
            }], fitContent: [{
                type: Input
            }], image: [{
                type: Input
            }], src: [{
                type: Input
            }], srcset: [{
                type: Input
            }], noWebp: [{
                type: Input
            }], highPriority: [{
                type: Input
            }], altText: [{
                type: Input
            }], sizes: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvYmxvY2tzL2ltYWdlL2ltYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUNoRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFL0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGlCQUFpQixDQUFDOzs7QUErRDVDLE1BQU0sQ0FBQyxPQUFPLE9BQU8sWUFBWTtJQTVEakM7UUF3SEUsZUFBVSxHQUFHLElBQUksQ0FBQztRQUNsQixlQUFVLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ25CLGVBQVUsR0FBRyxJQUFJLENBQUM7S0FtQ25CO0lBbkZDLElBQUksV0FBVztRQUNiLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQztRQUMxQyxNQUFNLEdBQUcsR0FBRyxVQUFVLENBQUM7UUFDdkIsSUFDRSxDQUFDLEdBQUc7WUFDSix3REFBd0Q7WUFDeEQsc0RBQXNEO1lBQ3RELENBQUMsQ0FDQyxPQUFPLEdBQUcsS0FBSyxRQUFRO2dCQUN2QixDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQzdELEVBQ0Q7WUFDQSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7U0FDcEI7UUFDRCxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDZixPQUFPLFNBQVMsQ0FBQyxDQUFDLHNDQUFzQztTQUN6RDtRQUNELElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyx5QkFBeUIsQ0FBQyxFQUFFO1lBQ2xFLElBQUksQ0FBQyxJQUFJ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QUksQ0FBQyxXQUFZLEdBQUcsR0FBRyxHQUFHLEdBQUc7YUFDMUMsQ0FBQztTQUNIO0lBQ0gsQ0FBQzsrR0FqR2tCLFlBQVk7bUdBQVosWUFBWSxvYUExRHJCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBNEJULHdUQTRCUyxZQUFZOzs0RkFFSCxZQUFZO2tCQTVEaEMsU0FBUzsrQkFDRSxlQUFlLFlBQ2Y7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0E0QlQsY0EyQlcsSUFBSSxXQUNQLENBQUMsWUFBWSxDQUFDOzhCQUdkLGtCQUFrQjtzQkFBMUIsS0FBSztnQkFDRyxjQUFjO3NCQUF0QixLQUFLO2dCQUNHLFNBQVM7c0JBQWpCLEtBQUs7Z0JBQ0csV0FBVztzQkFBbkIsS0FBSztnQkFDRyxZQUFZO3NCQUFwQixLQUFLO2dCQUNHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBQ0csS0FBSztzQkFBYixLQUFLO2dCQUNHLEdBQUc7c0JBQVgsS0FBSztnQkFDRyxNQUFNO3NCQUFkLEtBQUs7Z0JBQ0csTUFBTTtzQkFBZCxLQUFLO2dCQUNHLFlBQVk7c0JBQXBCLEtBQUs7Z0JBQ0csT0FBTztzQkFBZixLQUFLO2dCQUNHLEtBQUs7c0JBQWIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIFNpbXBsZUNoYW5nZXMgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvbW1vblwiO1xuXG5pbXBvcnQgeyBnZXRTcmNTZXQgfSBmcm9tIFwiLi9pbWFnZS5oZWxwZXJzXCI7XG5pbXBvcnQgdHlwZSB7IEltYWdlUHJvcHMgfSBmcm9tIFwiLi9pbWFnZS50eXBlc1wiO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6IFwiYnVpbGRlci1pbWFnZVwiLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxuZy1jb250YWluZXI+XG4gICAgICA8cGljdHVyZT5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIndlYnBTcmNTZXRcIj5cbiAgICAgICAgICA8c291cmNlIHR5cGU9XCJpbWFnZS93ZWJwXCIgW2F0dHIuc3Jjc2V0XT1cIndlYnBTcmNTZXRcIiAvPlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgPGltZ1xuICAgICAgICAgIFthdHRyLmxvYWRpbmddPVwiaGlnaFByaW9yaXR5ID8gJ2VhZ2VyJyA6ICdsYXp5J1wiXG4gICAgICAgICAgW2F0dHIuZmV0Y2hwcmlvcml0eV09XCJoaWdoUHJpb3JpdHkgPyAnaGlnaCcgOiAnYXV0bydcIlxuICAgICAgICAgIFthdHRyLmFsdF09XCJhbHRUZXh0XCJcbiAgICAgICAgICBbYXR0ci5yb2xlXT1cImFsdFRleHQgPyB1bmRlZmluZWQgOiAncHJlc2VudGF0aW9uJ1wiXG4gICAgICAgICAgW25nU3R5bGVdPVwibm9kZV8wX2ltZ1wiXG4gICAgICAgICAgW2NsYXNzXT1cIm5vZGVfMV9pbWcgKyAnIGltZydcIlxuICAgICAgICAgIFthdHRyLnNyY109XCJpbWFnZVwiXG4gICAgICAgICAgW2F0dHIuc3Jjc2V0XT1cInNyY1NldFRvVXNlXCJcbiAgICAgICAgICBbYXR0ci5zaXplc109XCJzaXplc1wiXG4gICAgICAgIC8+XG4gICAgICA8L3BpY3R1cmU+XG4gICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwibm9kZV8yX1Nob3dcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImJ1aWxkZXItaW1hZ2Utc2l6ZXIgZGl2XCIgW25nU3R5bGVdPVwibm9kZV8zX2RpdlwiPjwvZGl2PlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiYnVpbGRlckJsb2NrPy5jaGlsZHJlbj8ubGVuZ3RoICYmIGZpdENvbnRlbnRcIj5cbiAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiIWZpdENvbnRlbnQgJiYgYnVpbGRlckJsb2NrPy5jaGlsZHJlbj8ubGVuZ3RoXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJkaXYtMlwiPjxuZy1jb250ZW50PjwvbmctY29udGVudD48L2Rpdj5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgIDwvbmctY29udGFpbmVyPlxuICBgLFxuICBzdHlsZXM6IFtcbiAgICBgXG4gICAgICA6aG9zdCB7XG4gICAgICAgIGRpc3BsYXk6IGNvbnRlbnRzO1xuICAgICAgfVxuICAgICAgLmltZyB7XG4gICAgICAgIG9wYWNpdHk6IDE7XG4gICAgICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC4ycyBlYXNlLWluLW91dDtcbiAgICAgIH1cbiAgICAgIC5kaXYge1xuICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7XG4gICAgICAgIGZvbnQtc2l6ZTogMDtcbiAgICAgIH1cbiAgICAgIC5kaXYtMiB7XG4gICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gICAgICAgIGFsaWduLWl0ZW1zOiBzdHJldGNoO1xuICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICAgIHRvcDogMDtcbiAgICAgICAgbGVmdDogMDtcbiAgICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICAgIGhlaWdodDogMTAwJTtcbiAgICAgIH1cbiAgICBgLFxuICBdLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbQ29tbW9uTW9kdWxlXSxcbn0pXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCdWlsZGVySW1hZ2Uge1xuICBASW5wdXQoKSBiYWNrZ3JvdW5kUG9zaXRpb24hOiBJbWFnZVByb3BzW1wiYmFja2dyb3VuZFBvc2l0aW9uXCJdO1xuICBASW5wdXQoKSBiYWNrZ3JvdW5kU2l6ZSE6IEltYWdlUHJvcHNbXCJiYWNrZ3JvdW5kU2l6ZVwiXTtcbiAgQElucHV0KCkgY2xhc3NOYW1lITogSW1hZ2VQcm9wc1tcImNsYXNzTmFtZVwiXTtcbiAgQElucHV0KCkgYXNwZWN0UmF0aW8hOiBJbWFnZVByb3BzW1wiYXNwZWN0UmF0aW9cIl07XG4gIEBJbnB1dCgpIGJ1aWxkZXJCbG9jayE6IEltYWdlUHJvcHNbXCJidWlsZGVyQmxvY2tcIl07XG4gIEBJbnB1dCgpIGZpdENvbnRlbnQhOiBJbWFnZVByb3BzW1wiZml0Q29udGVudFwiXTtcbiAgQElucHV0KCkgaW1hZ2UhOiBJbWFnZVByb3BzW1wiaW1hZ2VcIl07XG4gIEBJbnB1dCgpIHNyYyE6IEltYWdlUHJvcHNbXCJzcmNcIl07XG4gIEBJbnB1dCgpIHNyY3NldCE6IEltYWdlUHJvcHNbXCJzcmNzZXRcIl07XG4gIEBJbnB1dCgpIG5vV2VicCE6IEltYWdlUHJvcHNbXCJub1dlYnBcIl07XG4gIEBJbnB1dCgpIGhpZ2hQcmlvcml0eSE6IEltYWdlUHJvcHNbXCJoaWdoUHJpb3JpdHlcIl07XG4gIEBJbnB1dCgpIGFsdFRleHQhOiBJbWFnZVByb3BzW1wiYWx0VGV4dFwiXTtcbiAgQElucHV0KCkgc2l6ZXMhOiBJbWFnZVByb3BzW1wic2l6ZXNcIl07XG5cbiAgZ2V0IHNyY1NldFRvVXNlKCkge1xuICAgIGNvbnN0IGltYWdlVG9Vc2UgPSB0aGlzLmltYWdlIHx8IHRoaXMuc3JjO1xuICAgIGNvbnN0IHVybCA9IGltYWdlVG9Vc2U7XG4gICAgaWYgKFxuICAgICAgIXVybCB8fFxuICAgICAgLy8gV2UgY2FuIGF1dG8gYWRkIHNyY3NldCBmb3IgY2RuLmJ1aWxkZXIuaW8gYW5kIHNob3BpZnlcbiAgICAgIC8vIGltYWdlcywgb3RoZXJ3aXNlIHlvdSBjYW4gc3VwcGx5IHRoaXMgcHJvcCBtYW51YWxseVxuICAgICAgIShcbiAgICAgICAgdHlwZW9mIHVybCA9PT0gXCJzdHJpbmdcIiAmJlxuICAgICAgICAodXJsLm1hdGNoKC9idWlsZGVyXFwuaW8vKSB8fCB1cmwubWF0Y2goL2NkblxcLnNob3BpZnlcXC5jb20vKSlcbiAgICAgIClcbiAgICApIHtcbiAgICAgIHJldHVybiB0aGlzLnNyY3NldDtcbiAgICB9XG4gICAgaWYgKHRoaXMubm9XZWJwKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkOyAvLyBubyBuZWVkIHRvIGFkZCBzcmNzZXQgdG8gc3ZnIGltYWdlc1xuICAgIH1cbiAgICBpZiAodGhpcy5zcmNzZXQgJiYgdGhpcy5pbWFnZT8uaW5jbHVkZXMoXCJidWlsZGVyLmlvL2FwaS92MS9pbWFnZVwiKSkge1xuICAgICAgaWYgKCF0aGlzLnNyY3NldC5pbmNsdWRlcyh0aGlzLmltYWdlLnNwbGl0KFwiP1wiKVswXSkpIHtcbiAgICAgICAgY29uc29sZS5kZWJ1ZyhcIlJlbW92ZWQgZ2l2ZW4gc3Jjc2V0XCIpO1xuICAgICAgICByZXR1cm4gZ2V0U3JjU2V0KHVybCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0aGlzLmltYWdlICYmICF0aGlzLnNyY3NldCkge1xuICAgICAgcmV0dXJuIGdldFNyY1NldCh1cmwpO1xuICAgIH1cbiAgICByZXR1cm4gZ2V0U3JjU2V0KHVybCk7XG4gIH1cbiAgZ2V0IHdlYnBTcmNTZXQoKSB7XG4gICAgaWYgKHRoaXMuc3JjU2V0VG9Vc2U/Lm1hdGNoKC9idWlsZGVyXFwuaW8vKSAmJiAhdGhpcy5ub1dlYnApIHtcbiAgICAgIHJldHVybiB0aGlzLnNyY1NldFRvVXNlLnJlcGxhY2UoL1xcPy9nLCBcIj9mb3JtYXQ9d2VicCZcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbiAgfVxuICBnZXQgYXNwZWN0UmF0aW9Dc3MoKSB7XG4gICAgY29uc3QgYXNwZWN0UmF0aW9TdHlsZXMgPSB7XG4gICAgICBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuICAgICAgaGVpZ2h0OiBcIjEwMCVcIixcbiAgICAgIHdpZHRoOiBcIjEwMCVcIixcbiAgICAgIGxlZnQ6IFwiMHB4XCIsXG4gICAgICB0b3A6IFwiMHB4XCIsXG4gICAgfSBhcyBjb25zdDtcbiAgICBjb25zdCBvdXQgPSB0aGlzLmFzcGVjdFJhdGlvID8gYXNwZWN0UmF0aW9TdHlsZXMgOiB1bmRlZmluZWQ7XG4gICAgcmV0dXJuIG91dDtcbiAgfVxuICBub2RlXzBfaW1nID0gbnVsbDtcbiAgbm9kZV8xX2ltZyA9IG51bGw7XG4gIG5vZGVfMl9TaG93ID0gbnVsbDtcbiAgbm9kZV8zX2RpdiA9IG51bGw7XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5ub2RlXzBfaW1nID0ge1xuICAgICAgb2JqZWN0UG9zaXRpb246IHRoaXMuYmFja2dyb3VuZFBvc2l0aW9uIHx8IFwiY2VudGVyXCIsXG4gICAgICBvYmplY3RGaXQ6IHRoaXMuYmFja2dyb3VuZFNpemUgfHwgXCJjb3ZlclwiLFxuICAgICAgLi4udGhpcy5hc3BlY3RSYXRpb0NzcyxcbiAgICB9O1xuICAgIHRoaXMubm9kZV8xX2ltZyA9XG4gICAgICBcImJ1aWxkZXItaW1hZ2VcIiArICh0aGlzLmNsYXNzTmFtZSA/IFwiIFwiICsgdGhpcy5jbGFzc05hbWUgOiBcIlwiKTtcbiAgICB0aGlzLm5vZGVfMl9TaG93ID1cbiAgICAgIHRoaXMuYXNwZWN0UmF0aW8gJiZcbiAgICAgICEodGhpcy5idWlsZGVyQmxvY2s/LmNoaWxkcmVuPy5sZW5ndGggJiYgdGhpcy5maXRDb250ZW50KTtcbiAgICB0aGlzLm5vZGVfM19kaXYgPSB7XG4gICAgICBwYWRkaW5nVG9wOiB0aGlzLmFzcGVjdFJhdGlvISAqIDEwMCArIFwiJVwiLFxuICAgIH07XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIHRoaXMubm9kZV8wX2ltZyA9IHtcbiAgICAgICAgb2JqZWN0UG9zaXRpb246IHRoaXMuYmFja2dyb3VuZFBvc2l0aW9uIHx8IFwiY2VudGVyXCIsXG4gICAgICAgIG9iamVjdEZpdDogdGhpcy5iYWNrZ3JvdW5kU2l6ZSB8fCBcImNvdmVyXCIsXG4gICAgICAgIC4uLnRoaXMuYXNwZWN0UmF0aW9Dc3MsXG4gICAgICB9O1xuICAgICAgdGhpcy5ub2RlXzFfaW1nID1cbiAgICAgICAgXCJidWlsZGVyLWltYWdlXCIgKyAodGhpcy5jbGFzc05hbWUgPyBcIiBcIiArIHRoaXMuY2xhc3NOYW1lIDogXCJcIik7XG4gICAgICB0aGlzLm5vZGVfMl9TaG93ID1cbiAgICAgICAgdGhpcy5hc3BlY3RSYXRpbyAmJlxuICAgICAgICAhKHRoaXMuYnVpbGRlckJsb2NrPy5jaGlsZHJlbj8ubGVuZ3RoICYmIHRoaXMuZml0Q29udGVudCk7XG4gICAgICB0aGlzLm5vZGVfM19kaXYgPSB7XG4gICAgICAgIHBhZGRpbmdUb3A6IHRoaXMuYXNwZWN0UmF0aW8hICogMTAwICsgXCIlXCIsXG4gICAgICB9O1xuICAgIH1cbiAgfVxufVxuIl19