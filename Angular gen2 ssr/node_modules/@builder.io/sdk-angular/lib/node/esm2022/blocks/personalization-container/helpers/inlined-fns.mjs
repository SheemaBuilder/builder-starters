/**
 * WARNING: This file contains functions that get stringified and inlined into the HTML at build-time.
 * They cannot import anything.
 */
export function filterWithCustomTargeting(userAttributes, query, startDate, endDate) {
    function isString(val) {
        return typeof val === 'string';
    }
    function isNumber(val) {
        return typeof val === 'number';
    }
    function objectMatchesQuery(userattr, query) {
        const result = (() => {
            const property = query.property;
            const operator = query.operator;
            let testValue = query.value;
            if (query && query.property === 'urlPath' && query.value && typeof query.value === 'string' && query.value !== '/' && query.value.endsWith('/')) {
                testValue = query.value.slice(0, -1);
            }
            if (!(property && operator)) {
                return true;
            }
            if (Array.isArray(testValue)) {
                if (operator === 'isNot') {
                    return testValue.every(val => objectMatchesQuery(userattr, {
                        property,
                        operator,
                        value: val
                    }));
                }
                return !!testValue.find(val => objectMatchesQuery(userattr, {
                    property,
                    operator,
                    value: val
                }));
            }
            const value = userattr[property];
            if (Array.isArray(value)) {
                return value.includes(testValue);
            }
            switch (operator) {
                case 'is':
                    return value === testValue;
                case 'isNot':
                    return value !== testValue;
                case 'contains':
                    return (isString(value) || Array.isArray(value)) && value.includes(String(testValue));
                case 'startsWith':
                    return isString(value) && value.startsWith(String(testValue));
                case 'endsWith':
                    return isString(value) && value.endsWith(String(testValue));
                case 'greaterThan':
                    return isNumber(value) && isNumber(testValue) && value > testValue;
                case 'lessThan':
                    return isNumber(value) && isNumber(testValue) && value < testValue;
                case 'greaterThanOrEqualTo':
                    return isNumber(value) && isNumber(testValue) && value >= testValue;
                case 'lessThanOrEqualTo':
                    return isNumber(value) && isNumber(testValue) && value <= testValue;
                default:
                    return false;
            }
        })();
        return result;
    }
    const item = {
        query,
        startDate,
        endDate
    };
    const now = userAttributes.date && new Date(userAttributes.date) || new Date();
    if (item.startDate && new Date(item.startDate) > now) {
        return false;
    }
    else if (item.endDate && new Date(item.endDate) < now) {
        return false;
    }
    if (!item.query || !item.query.length) {
        return true;
    }
    return item.query.every((filter) => {
        return objectMatchesQuery(userAttributes, filter);
    });
}
export const PERSONALIZATION_SCRIPT = "function getPersonalizedVariant(variants, blockId, locale) {\n  if (!navigator.cookieEnabled) {\n    return;\n  }\n  function getCookie(name) {\n    const nameEQ = name + '=';\n    const ca = document.cookie.split(';');\n    for (let i = 0; i < ca.length; i++) {\n      let c = ca[i];\n      while (c.charAt(0) == ' ') c = c.substring(1, c.length);\n      if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);\n    }\n    return null;\n  }\n  function removeVariants() {\n    variants?.forEach(function (_, index) {\n      document.querySelector('template[data-variant-id=\"' + blockId + '-' + index + '\"]')?.remove();\n    });\n    document.querySelector('script[data-id=\"variants-script-' + blockId + '\"]')?.remove();\n    document.querySelector('style[data-id=\"variants-styles-' + blockId + '\"]')?.remove();\n  }\n  const attributes = JSON.parse(getCookie('builder.userAttributes') || '{}');\n  if (locale) {\n    attributes.locale = locale;\n  }\n  const winningVariantIndex = variants?.findIndex(function (variant) {\n    return filterWithCustomTargeting(attributes, variant.query, variant.startDate, variant.endDate);\n  });\n  const isDebug = location.href.includes('builder.debug=true');\n  if (isDebug) {\n    console.debug('PersonalizationContainer', {\n      attributes,\n      variants,\n      winningVariantIndex\n    });\n  }\n  if (winningVariantIndex !== -1) {\n    const winningVariant = document.querySelector('template[data-variant-id=\"' + blockId + '-' + winningVariantIndex + '\"]');\n    if (winningVariant) {\n      const parentNode = winningVariant.parentNode;\n      if (parentNode) {\n        const newParent = parentNode.cloneNode(false);\n        newParent.appendChild(winningVariant.content.firstChild);\n        newParent.appendChild(winningVariant.content.lastChild);\n        parentNode.parentNode?.replaceChild(newParent, parentNode);\n      }\n      if (isDebug) {\n        console.debug('PersonalizationContainer', 'Winning variant Replaced:', winningVariant);\n      }\n    }\n  } else if (variants && variants.length > 0) {\n    removeVariants();\n  }\n}";
export const FILTER_WITH_CUSTOM_TARGETING_SCRIPT = "function filterWithCustomTargeting(userAttributes, query, startDate, endDate) {\n  function isString(val) {\n    return typeof val === 'string';\n  }\n  function isNumber(val) {\n    return typeof val === 'number';\n  }\n  function objectMatchesQuery(userattr, query) {\n    const result = (() => {\n      const property = query.property;\n      const operator = query.operator;\n      let testValue = query.value;\n      if (query && query.property === 'urlPath' && query.value && typeof query.value === 'string' && query.value !== '/' && query.value.endsWith('/')) {\n        testValue = query.value.slice(0, -1);\n      }\n      if (!(property && operator)) {\n        return true;\n      }\n      if (Array.isArray(testValue)) {\n        if (operator === 'isNot') {\n          return testValue.every(val => objectMatchesQuery(userattr, {\n            property,\n            operator,\n            value: val\n          }));\n        }\n        return !!testValue.find(val => objectMatchesQuery(userattr, {\n          property,\n          operator,\n          value: val\n        }));\n      }\n      const value = userattr[property];\n      if (Array.isArray(value)) {\n        return value.includes(testValue);\n      }\n      switch (operator) {\n        case 'is':\n          return value === testValue;\n        case 'isNot':\n          return value !== testValue;\n        case 'contains':\n          return (isString(value) || Array.isArray(value)) && value.includes(String(testValue));\n        case 'startsWith':\n          return isString(value) && value.startsWith(String(testValue));\n        case 'endsWith':\n          return isString(value) && value.endsWith(String(testValue));\n        case 'greaterThan':\n          return isNumber(value) && isNumber(testValue) && value > testValue;\n        case 'lessThan':\n          return isNumber(value) && isNumber(testValue) && value < testValue;\n        case 'greaterThanOrEqualTo':\n          return isNumber(value) && isNumber(testValue) && value >= testValue;\n        case 'lessThanOrEqualTo':\n          return isNumber(value) && isNumber(testValue) && value <= testValue;\n        default:\n          return false;\n      }\n    })();\n    return result;\n  }\n  const item = {\n    query,\n    startDate,\n    endDate\n  };\n  const now = userAttributes.date && new Date(userAttributes.date) || new Date();\n  if (item.startDate && new Date(item.startDate) > now) {\n    return false;\n  } else if (item.endDate && new Date(item.endDate) < now) {\n    return false;\n  }\n  if (!item.query || !item.query.length) {\n    return true;\n  }\n  return item.query.every(filter => {\n    return objectMatchesQuery(userAttributes, filter);\n  });\n}";
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5saW5lZC1mbnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvYmxvY2tzL3BlcnNvbmFsaXphdGlvbi1jb250YWluZXIvaGVscGVycy9pbmxpbmVkLWZucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0dBR0c7QUFJSCxNQUFNLFVBQVUseUJBQXlCLENBQUMsY0FBOEIsRUFBRSxLQUFjLEVBQUUsU0FBa0IsRUFBRSxPQUFnQjtJQUM1SCxTQUFTLFFBQVEsQ0FBQyxHQUFZO1FBQzVCLE9BQU8sT0FBTyxHQUFHLEtBQUssUUFBUSxDQUFDO0lBQ2pDLENBQUM7SUFDRCxTQUFTLFFBQVEsQ0FBQyxHQUFZO1FBQzVCLE9BQU8sT0FBTyxHQUFHLEtBQUssUUFBUSxDQUFDO0lBQ2pDLENBQUM7SUFDRCxTQUFTLGtCQUFrQixDQUFDLFFBQXdCLEVBQUUsS0FBWTtRQUNoRSxNQUFNLE1BQU0sR0FBRyxDQUFDLEdBQUcsRUFBRTtZQUNuQixNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDO1lBQ2hDLE1BQU0sUUFBUSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUM7WUFDaEMsSUFBSSxTQUFTLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztZQUM1QixJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsUUFBUSxLQUFLLFNBQVMsSUFBSSxLQUFLLENBQUMsS0FBSyxJQUFJLE9BQU8sS0FBSyxDQUFDLEtBQUssS0FBSyxRQUFRLElBQUksS0FBSyxDQUFDLEtBQUssS0FBSyxHQUFHLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUU7Z0JBQy9JLFNBQVMsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUN0QztZQUNELElBQUksQ0FBQyxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsRUFBRTtnQkFD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QUksSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxHQUFHLEVBQUU7UUFDdkQsT0FBTyxLQUFLLENBQUM7S0FDZDtJQUNELElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUU7UUFDckMsT0FBTyxJQUFJLENBQUM7S0FDYjtJQUNELE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFhLEVBQUUsRUFBRTtRQUN4QyxPQUFPLGtCQUFrQixDQUFDLGNBQWMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNwRCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFDRCxNQUFNLENBQUMsTUFBTSxzQkFBc0IsR0FBRyxza0VBQXNrRSxDQUFDO0FBQzdtRSxNQUFNLENBQUMsTUFBTSxtQ0FBbUMsR0FBRyw0cEZBQTRwRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBXQVJOSU5HOiBUaGlzIGZpbGUgY29udGFpbnMgZnVuY3Rpb25zIHRoYXQgZ2V0IHN0cmluZ2lmaWVkIGFuZCBpbmxpbmVkIGludG8gdGhlIEhUTUwgYXQgYnVpbGQtdGltZS5cbiAqIFRoZXkgY2Fubm90IGltcG9ydCBhbnl0aGluZy5cbiAqL1xuXG5pbXBvcnQgdHlwZSB7IFF1ZXJ5LCBVc2VyQXR0cmlidXRlcyB9IGZyb20gJy4uL2hlbHBlcnMnO1xuaW1wb3J0IHsgdHlwZSBQZXJzb25hbGl6YXRpb25Db250YWluZXJQcm9wcyB9IGZyb20gJy4uL3BlcnNvbmFsaXphdGlvbi1jb250YWluZXIudHlwZXMnO1xuZXhwb3J0IGZ1bmN0aW9uIGZpbHRlcldpdGhDdXN0b21UYXJnZXRpbmcodXNlckF0dHJpYnV0ZXM6IFVzZXJBdHRyaWJ1dGVzLCBxdWVyeTogUXVlcnlbXSwgc3RhcnREYXRlPzogc3RyaW5nLCBlbmREYXRlPzogc3RyaW5nKSB7XG4gIGZ1bmN0aW9uIGlzU3RyaW5nKHZhbDogdW5rbm93bik6IHZhbCBpcyBzdHJpbmcge1xuICAgIHJldHVybiB0eXBlb2YgdmFsID09PSAnc3RyaW5nJztcbiAgfVxuICBmdW5jdGlvbiBpc051bWJlcih2YWw6IHVua25vd24pOiB2YWwgaXMgbnVtYmVyIHtcbiAgICByZXR1cm4gdHlwZW9mIHZhbCA9PT0gJ251bWJlcic7XG4gIH1cbiAgZnVuY3Rpb24gb2JqZWN0TWF0Y2hlc1F1ZXJ5KHVzZXJhdHRyOiBVc2VyQXR0cmlidXRlcywgcXVlcnk6IFF1ZXJ5KTogYm9vbGVhbiB7XG4gICAgY29uc3QgcmVzdWx0ID0gKCgpID0+IHtcbiAgICAgIGNvbnN0IHByb3BlcnR5ID0gcXVlcnkucHJvcGVydHk7XG4gICAgICBjb25zdCBvcGVyYXRvciA9IHF1ZXJ5Lm9wZXJhdG9yO1xuICAgICAgbGV0IHRlc3RWYWx1ZSA9IHF1ZXJ5LnZhbHVlO1xuICAgICAgaWYgKHF1ZXJ5ICYmIHF1ZXJ5LnByb3BlcnR5ID09PSAndXJsUGF0aCcgJiYgcXVlcnkudmFsdWUgJiYgdHlwZW9mIHF1ZXJ5LnZhbHVlID09PSAnc3RyaW5nJyAmJiBxdWVyeS52YWx1ZSAhPT0gJy8nICYmIHF1ZXJ5LnZhbHVlLmVuZHNXaXRoKCcvJykpIHtcbiAgICAgICAgdGVzdFZhbHVlID0gcXVlcnkudmFsdWUuc2xpY2UoMCwgLTEpO1xuICAgICAgfVxuICAgICAgaWYgKCEocHJvcGVydHkgJiYgb3BlcmF0b3IpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGVzdFZhbHVlKSkge1xuICAgICAgICBpZiAob3BlcmF0b3IgPT09ICdpc05vdCcpIHtcbiAgICAgICAgICByZXR1cm4gdGVzdFZhbHVlLmV2ZXJ5KHZhbCA9PiBvYmplY3RNYXRjaGVzUXVlcnkodXNlcmF0dHIsIHtcbiAgICAgICAgICAgIHByb3BlcnR5LFxuICAgICAgICAgICAgb3BlcmF0b3IsXG4gICAgICAgICAgICB2YWx1ZTogdmFsXG4gICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhIXRlc3RWYWx1ZS5maW5kKHZhbCA9PiBvYmplY3RNYXRjaGVzUXVlcnkodXNlcmF0dHIsIHtcbiAgICAgICAgICBwcm9wZXJ0eSxcbiAgICAgICAgICBvcGVyYXRvcixcbiAgICAgICAgICB2YWx1ZTogdmFsXG4gICAgICAgIH0pKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHZhbHVlID0gdXNlcmF0dHJbcHJvcGVydHldO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZS5pbmNsdWRlcyh0ZXN0VmFsdWUpO1xuICAgICAgfVxuICAgICAgc3dpdGNoIChvcGVyYXRvcikge1xuICAgICAgICBjYXNlICdpcyc6XG4gICAgICAgICAgcmV0dXJuIHZhbHVlID09PSB0ZXN0VmFsdWU7XG4gICAgICAgIGNhc2UgJ2lzTm90JzpcbiAgICAgICAgICByZXR1cm4gdmFsdWUgIT09IHRlc3RWYWx1ZTtcbiAgICAgICAgY2FzZSAnY29udGFpbnMnOlxuICAgICAgICAgIHJldHVybiAoaXNTdHJpbmcodmFsdWUpIHx8IEFycmF5LmlzQXJyYXkodmFsdWUpKSAmJiB2YWx1ZS5pbmNsdWRlcyhTdHJpbmcodGVzdFZhbHVlKSk7XG4gICAgICAgIGNhc2UgJ3N0YXJ0c1dpdGgnOlxuICAgICAgICAgIHJldHVybiBpc1N0cmluZyh2YWx1ZSkgJiYgdmFsdWUuc3RhcnRzV2l0aChTdHJpbmcodGVzdFZhbHVlKSk7XG4gICAgICAgIGNhc2UgJ2VuZHNXaXRoJzpcbiAgICAgICAgICByZXR1cm4gaXNTdHJpbmcodmFsdWUpICYmIHZhbHVlLmVuZHNXaXRoKFN0cmluZyh0ZXN0VmFsdWUpKTtcbiAgICAgICAgY2FzZSAnZ3JlYXRlclRoYW4nOlxuICAgICAgICAgIHJldHVybiBpc051bWJlcih2YWx1ZSkgJiYgaXNOdW1iZXIodGVzdFZhbHVlKSAmJiB2YWx1ZSA+IHRlc3RWYWx1ZTtcbiAgICAgICAgY2FzZSAnbGVzc1RoYW4nOlxuICAgICAgICAgIHJldHVybiBpc051bWJlcih2YWx1ZSkgJiYgaXNOdW1iZXIodGVzdFZhbHVlKSAmJiB2YWx1ZSA8IHRlc3RWYWx1ZTtcbiAgICAgICAgY2FzZSAnZ3JlYXRlclRoYW5PckVxdWFsVG8nOlxuICAgICAgICAgIHJldHVybiBpc051bWJlcih2YWx1ZSkgJiYgaXNOdW1iZXIodGVzdFZhbHVlKSAmJiB2YWx1ZSA+PSB0ZXN0VmFsdWU7XG4gICAgICAgIGNhc2UgJ2xlc3NUaGFuT3JFcXVhbFRvJzpcbiAgICAgICAgICByZXR1cm4gaXNOdW1iZXIodmFsdWUpICYmIGlzTnVtYmVyKHRlc3RWYWx1ZSkgJiYgdmFsdWUgPD0gdGVzdFZhbHVlO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9KSgpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgY29uc3QgaXRlbSA9IHtcbiAgICBxdWVyeSxcbiAgICBzdGFydERhdGUsXG4gICAgZW5kRGF0ZVxuICB9O1xuICBjb25zdCBub3cgPSB1c2VyQXR0cmlidXRlcy5kYXRlICYmIG5ldyBEYXRlKHVzZXJBdHRyaWJ1dGVzLmRhdGUpIHx8IG5ldyBEYXRlKCk7XG4gIGlmIChpdGVtLnN0YXJ0RGF0ZSAmJiBuZXcgRGF0ZShpdGVtLnN0YXJ0RGF0ZSkgPiBub3cpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0gZWxzZSBpZiAoaXRlbS5lbmREYXRlICYmIG5ldyBEYXRlKGl0ZW0uZW5kRGF0ZSkgPCBub3cpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKCFpdGVtLnF1ZXJ5IHx8ICFpdGVtLnF1ZXJ5Lmxlbmd0aCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBpdGVtLnF1ZXJ5LmV2ZXJ5KChmaWx0ZXI6IFF1ZXJ5KSA9PiB7XG4gICAgcmV0dXJuIG9iamVjdE1hdGNoZXNRdWVyeSh1c2VyQXR0cmlidXRlcywgZmlsdGVyKTtcbiAgfSk7XG59XG5leHBvcnQgY29uc3QgUEVSU09OQUxJWkFUSU9OX1NDUklQVCA9IFwiZnVuY3Rpb24gZ2V0UGVyc29uYWxpemVkVmFyaWFudCh2YXJpYW50cywgYmxvY2tJZCwgbG9jYWxlKSB7XFxuICBpZiAoIW5hdmlnYXRvci5jb29raWVFbmFibGVkKSB7XFxuICAgIHJldHVybjtcXG4gIH1cXG4gIGZ1bmN0aW9uIGdldENvb2tpZShuYW1lKSB7XFxuICAgIGNvbnN0IG5hbWVFUSA9IG5hbWUgKyAnPSc7XFxuICAgIGNvbnN0IGNhID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7XFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2EubGVuZ3RoOyBpKyspIHtcXG4gICAgICBsZXQgYyA9IGNhW2ldO1xcbiAgICAgIHdoaWxlIChjLmNoYXJBdCgwKSA9PSAnICcpIGMgPSBjLnN1YnN0cmluZygxLCBjLmxlbmd0aCk7XFxuICAgICAgaWYgKGMuaW5kZXhPZihuYW1lRVEpID09IDApIHJldHVybiBjLnN1YnN0cmluZyhuYW1lRVEubGVuZ3RoLCBjLmxlbmd0aCk7XFxuICAgIH1cXG4gICAgcmV0dXJuIG51bGw7XFxuICB9XFxuICBmdW5jdGlvbiByZW1vdmVWYXJpYW50cygpIHtcXG4gICAgdmFyaWFudHM/LmZvckVhY2goZnVuY3Rpb24gKF8sIGluZGV4KSB7XFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndGVtcGxhdGVbZGF0YS12YXJpYW50LWlkPVxcXCInICsgYmxvY2tJZCArICctJyArIGluZGV4ICsgJ1xcXCJdJyk/LnJlbW92ZSgpO1xcbiAgICB9KTtcXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc2NyaXB0W2RhdGEtaWQ9XFxcInZhcmlhbnRzLXNjcmlwdC0nICsgYmxvY2tJZCArICdcXFwiXScpPy5yZW1vdmUoKTtcXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc3R5bGVbZGF0YS1pZD1cXFwidmFyaWFudHMtc3R5bGVzLScgKyBibG9ja0lkICsgJ1xcXCJdJyk/LnJlbW92ZSgpO1xcbiAgfVxcbiAgY29uc3QgYXR0cmlidXRlcyA9IEpTT04ucGFyc2UoZ2V0Q29va2llKCdidWlsZGVyLnVzZXJBdHRyaWJ1dGVzJykgfHwgJ3t9Jyk7XFxuICBpZiAobG9jYWxlKSB7XFxuICAgIGF0dHJpYnV0ZXMubG9jYWxlID0gbG9jYWxlO1xcbiAgfVxcbiAgY29uc3Qgd2lubmluZ1ZhcmlhbnRJbmRleCA9IHZhcmlhbnRzPy5maW5kSW5kZXgoZnVuY3Rpb24gKHZhcmlhbnQpIHtcXG4gICAgcmV0dXJuIGZpbHRlcldpdGhDdXN0b21UYXJnZXRpbmcoYXR0cmlidXRlcywgdmFyaWFudC5xdWVyeSwgdmFyaWFudC5zdGFydERhdGUsIHZhcmlhbnQuZW5kRGF0ZSk7XFxuICB9KTtcXG4gIGNvbnN0IGlzRGVidWcgPSBsb2NhdGlvbi5ocmVmLmluY2x1ZGVzKCdidWlsZGVyLmRlYnVnPXRydWUnKTtcXG4gIGlmIChpc0RlYnVnKSB7XFxuICAgIGNvbnNvbGUuZGVidWcoJ1BlcnNvbmFsaXphdGlvbkNvbnRhaW5lcicsIHtcXG4gICAgICBhdHRyaWJ1dGVzLFxcbiAgICAgIHZhcmlhbnRzLFxcbiAgICAgIHdpbm5pbmdWYXJpYW50SW5kZXhcXG4gICAgfSk7XFxuICB9XFxuICBpZiAod2lubmluZ1ZhcmlhbnRJbmRleCAhPT0gLTEpIHtcXG4gICAgY29uc3Qgd2lubmluZ1ZhcmlhbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd0ZW1wbGF0ZVtkYXRhLXZhcmlhbnQtaWQ9XFxcIicgKyBibG9ja0lkICsgJy0nICsgd2lubmluZ1ZhcmlhbnRJbmRleCArICdcXFwiXScpO1xcbiAgICBpZiAod2lubmluZ1ZhcmlhbnQpIHtcXG4gICAgICBjb25zdCBwYXJlbnROb2RlID0gd2lubmluZ1ZhcmlhbnQucGFyZW50Tm9kZTtcXG4gICAgICBpZiAocGFyZW50Tm9kZSkge1xcbiAgICAgICAgY29uc3QgbmV3UGFyZW50ID0gcGFyZW50Tm9kZS5jbG9uZU5vZGUoZmFsc2UpO1xcbiAgICAgICAgbmV3UGFyZW50LmFwcGVuZENoaWxkKHdpbm5pbmdWYXJpYW50LmNvbnRlbnQuZmlyc3RDaGlsZCk7XFxuICAgICAgICBuZXdQYXJlbnQuYXBwZW5kQ2hpbGQod2lubmluZ1ZhcmlhbnQuY29udGVudC5sYXN0Q2hpbGQpO1xcbiAgICAgICAgcGFyZW50Tm9kZS5wYXJlbnROb2RlPy5yZXBsYWNlQ2hpbGQobmV3UGFyZW50LCBwYXJlbnROb2RlKTtcXG4gICAgICB9XFxuICAgICAgaWYgKGlzRGVidWcpIHtcXG4gICAgICAgIGNvbnNvbGUuZGVidWcoJ1BlcnNvbmFsaXphdGlvbkNvbnRhaW5lcicsICdXaW5uaW5nIHZhcmlhbnQgUmVwbGFjZWQ6Jywgd2lubmluZ1ZhcmlhbnQpO1xcbiAgICAgIH1cXG4gICAgfVxcbiAgfSBlbHNlIGlmICh2YXJpYW50cyAmJiB2YXJpYW50cy5sZW5ndGggPiAwKSB7XFxuICAgIHJlbW92ZVZhcmlhbnRzKCk7XFxuICB9XFxufVwiO1xuZXhwb3J0IGNvbnN0IEZJTFRFUl9XSVRIX0NVU1RPTV9UQVJHRVRJTkdfU0NSSVBUID0gXCJmdW5jdGlvbiBmaWx0ZXJXaXRoQ3VzdG9tVGFyZ2V0aW5nKHVzZXJBdHRyaWJ1dGVzLCBxdWVyeSwgc3RhcnREYXRlLCBlbmREYXRlKSB7XFxuICBmdW5jdGlvbiBpc1N0cmluZyh2YWwpIHtcXG4gICAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnO1xcbiAgfVxcbiAgZnVuY3Rpb24gaXNOdW1iZXIodmFsKSB7XFxuICAgIHJldHVybiB0eXBlb2YgdmFsID09PSAnbnVtYmVyJztcXG4gIH1cXG4gIGZ1bmN0aW9uIG9iamVjdE1hdGNoZXNRdWVyeSh1c2VyYXR0ciwgcXVlcnkpIHtcXG4gICAgY29uc3QgcmVzdWx0ID0gKCgpID0+IHtcXG4gICAgICBjb25zdCBwcm9wZXJ0eSA9IHF1ZXJ5LnByb3BlcnR5O1xcbiAgICAgIGNvbnN0IG9wZXJhdG9yID0gcXVlcnkub3BlcmF0b3I7XFxuICAgICAgbGV0IHRlc3RWYWx1ZSA9IHF1ZXJ5LnZhbHVlO1xcbiAgICAgIGlmIChxdWVyeSAmJiBxdWVyeS5wcm9wZXJ0eSA9PT0gJ3VybFBhdGgnICYmIHF1ZXJ5LnZhbHVlICYmIHR5cGVvZiBxdWVyeS52YWx1ZSA9PT0gJ3N0cmluZycgJiYgcXVlcnkudmFsdWUgIT09ICcvJyAmJiBxdWVyeS52YWx1ZS5lbmRzV2l0aCgnLycpKSB7XFxuICAgICAgICB0ZXN0VmFsdWUgPSBxdWVyeS52YWx1ZS5zbGljZSgwLCAtMSk7XFxuICAgICAgfVxcbiAgICAgIGlmICghKHByb3BlcnR5ICYmIG9wZXJhdG9yKSkge1xcbiAgICAgICAgcmV0dXJuIHRydWU7XFxuICAgICAgfVxcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHRlc3RWYWx1ZSkpIHtcXG4gICAgICAgIGlmIChvcGVyYXRvciA9PT0gJ2lzTm90Jykge1xcbiAgICAgICAgICByZXR1cm4gdGVzdFZhbHVlLmV2ZXJ5KHZhbCA9PiBvYmplY3RNYXRjaGVzUXVlcnkodXNlcmF0dHIsIHtcXG4gICAgICAgICAgICBwcm9wZXJ0eSxcXG4gICAgICAgICAgICBvcGVyYXRvcixcXG4gICAgICAgICAgICB2YWx1ZTogdmFsXFxuICAgICAgICAgIH0pKTtcXG4gICAgICAgIH1cXG4gICAgICAgIHJldHVybiAhIXRlc3RWYWx1ZS5maW5kKHZhbCA9PiBvYmplY3RNYXRjaGVzUXVlcnkodXNlcmF0dHIsIHtcXG4gICAgICAgICAgcHJvcGVydHksXFxuICAgICAgICAgIG9wZXJhdG9yLFxcbiAgICAgICAgICB2YWx1ZTogdmFsXFxuICAgICAgICB9KSk7XFxuICAgICAgfVxcbiAgICAgIGNvbnN0IHZhbHVlID0gdXNlcmF0dHJbcHJvcGVydHldO1xcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xcbiAgICAgICAgcmV0dXJuIHZhbHVlLmluY2x1ZGVzKHRlc3RWYWx1ZSk7XFxuICAgICAgfVxcbiAgICAgIHN3aXRjaCAob3BlcmF0b3IpIHtcXG4gICAgICAgIGNhc2UgJ2lzJzpcXG4gICAgICAgICAgcmV0dXJuIHZhbHVlID09PSB0ZXN0VmFsdWU7XFxuICAgICAgICBjYXNlICdpc05vdCc6XFxuICAgICAgICAgIHJldHVybiB2YWx1ZSAhPT0gdGVzdFZhbHVlO1xcbiAgICAgICAgY2FzZSAnY29udGFpbnMnOlxcbiAgICAgICAgICByZXR1cm4gKGlzU3RyaW5nKHZhbHVlKSB8fCBBcnJheS5pc0FycmF5KHZhbHVlKSkgJiYgdmFsdWUuaW5jbHVkZXMoU3RyaW5nKHRlc3RWYWx1ZSkpO1xcbiAgICAgICAgY2FzZSAnc3RhcnRzV2l0aCc6XFxuICAgICAgICAgIHJldHVybiBpc1N0cmluZyh2YWx1ZSkgJiYgdmFsdWUuc3RhcnRzV2l0aChTdHJpbmcodGVzdFZhbHVlKSk7XFxuICAgICAgICBjYXNlICdlbmRzV2l0aCc6XFxuICAgICAgICAgIHJldHVybiBpc1N0cmluZyh2YWx1ZSkgJiYgdmFsdWUuZW5kc1dpdGgoU3RyaW5nKHRlc3RWYWx1ZSkpO1xcbiAgICAgICAgY2FzZSAnZ3JlYXRlclRoYW4nOlxcbiAgICAgICAgICByZXR1cm4gaXNOdW1iZXIodmFsdWUpICYmIGlzTnVtYmVyKHRlc3RWYWx1ZSkgJiYgdmFsdWUgPiB0ZXN0VmFsdWU7XFxuICAgICAgICBjYXNlICdsZXNzVGhhbic6XFxuICAgICAgICAgIHJldHVybiBpc051bWJlcih2YWx1ZSkgJiYgaXNOdW1iZXIodGVzdFZhbHVlKSAmJiB2YWx1ZSA8IHRlc3RWYWx1ZTtcXG4gICAgICAgIGNhc2UgJ2dyZWF0ZXJUaGFuT3JFcXVhbFRvJzpcXG4gICAgICAgICAgcmV0dXJuIGlzTnVtYmVyKHZhbHVlKSAmJiBpc051bWJlcih0ZXN0VmFsdWUpICYmIHZhbHVlID49IHRlc3RWYWx1ZTtcXG4gICAgICAgIGNhc2UgJ2xlc3NUaGFuT3JFcXVhbFRvJzpcXG4gICAgICAgICAgcmV0dXJuIGlzTnVtYmVyKHZhbHVlKSAmJiBpc051bWJlcih0ZXN0VmFsdWUpICYmIHZhbHVlIDw9IHRlc3RWYWx1ZTtcXG4gICAgICAgIGRlZmF1bHQ6XFxuICAgICAgICAgIHJldHVybiBmYWxzZTtcXG4gICAgICB9XFxuICAgIH0pKCk7XFxuICAgIHJldHVybiByZXN1bHQ7XFxuICB9XFxuICBjb25zdCBpdGVtID0ge1xcbiAgICBxdWVyeSxcXG4gICAgc3RhcnREYXRlLFxcbiAgICBlbmREYXRlXFxuICB9O1xcbiAgY29uc3Qgbm93ID0gdXNlckF0dHJpYnV0ZXMuZGF0ZSAmJiBuZXcgRGF0ZSh1c2VyQXR0cmlidXRlcy5kYXRlKSB8fCBuZXcgRGF0ZSgpO1xcbiAgaWYgKGl0ZW0uc3RhcnREYXRlICYmIG5ldyBEYXRlKGl0ZW0uc3RhcnREYXRlKSA+IG5vdykge1xcbiAgICByZXR1cm4gZmFsc2U7XFxuICB9IGVsc2UgaWYgKGl0ZW0uZW5kRGF0ZSAmJiBuZXcgRGF0ZShpdGVtLmVuZERhdGUpIDwgbm93KSB7XFxuICAgIHJldHVybiBmYWxzZTtcXG4gIH1cXG4gIGlmICghaXRlbS5xdWVyeSB8fCAhaXRlbS5xdWVyeS5sZW5ndGgpIHtcXG4gICAgcmV0dXJuIHRydWU7XFxuICB9XFxuICByZXR1cm4gaXRlbS5xdWVyeS5ldmVyeShmaWx0ZXIgPT4ge1xcbiAgICByZXR1cm4gb2JqZWN0TWF0Y2hlc1F1ZXJ5KHVzZXJBdHRyaWJ1dGVzLCBmaWx0ZXIpO1xcbiAgfSk7XFxufVwiOyJdfQ==