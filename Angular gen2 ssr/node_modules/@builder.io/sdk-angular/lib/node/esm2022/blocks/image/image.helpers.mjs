// Taken from (and modified) the shopify theme script repo
// https://github.com/Shopify/theme-scripts/blob/bcfb471f2a57d439e2f964a1bb65b67708cc90c3/packages/theme-images/images.js#L59
function removeProtocol(path) {
    return path.replace(/http(s)?:/, '');
}
function updateQueryParam(uri = '', key, value) {
    const re = new RegExp('([?&])' + key + '=.*?(&|$)', 'i');
    const separator = uri.indexOf('?') !== -1 ? '&' : '?';
    if (uri.match(re)) {
        return uri.replace(re, '$1' + key + '=' + encodeURIComponent(value) + '$2');
    }
    return uri + separator + key + '=' + encodeURIComponent(value);
}
function getShopifyImageUrl(src, size) {
    if (!src || !src?.match(/cdn\.shopify\.com/) || !size) {
        return src;
    }
    if (size === 'master') {
        return removeProtocol(src);
    }
    const match = src.match(/(_\d+x(\d+)?)?(\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?)/i);
    if (match) {
        const prefix = src.split(match[0]);
        const suffix = match[3];
        const useSize = size.match('x') ? size : `${size}x`;
        return removeProtocol(`${prefix[0]}_${useSize}${suffix}`);
    }
    return null;
}
export function getSrcSet(url) {
    if (!url) {
        return url;
    }
    const sizes = [100, 200, 400, 800, 1200, 1600, 2000];
    if (url.match(/builder\.io/)) {
        let srcUrl = url;
        const widthInSrc = Number(url.split('?width=')[1]);
        if (!isNaN(widthInSrc)) {
            srcUrl = `${srcUrl} ${widthInSrc}w`;
        }
        return sizes.filter(size => size !== widthInSrc).map(size => `${updateQueryParam(url, 'width', size)} ${size}w`).concat([srcUrl]).join(', ');
    }
    if (url.match(/cdn\.shopify\.com/)) {
        return sizes.map(size => [getShopifyImageUrl(url, `${size}x${size}`), size]).filter(([sizeUrl]) => !!sizeUrl).map(([sizeUrl, size]) => `${sizeUrl} ${size}w`).concat([url]).join(', ');
    }
    return url;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2UuaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9ibG9ja3MvaW1hZ2UvaW1hZ2UuaGVscGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwwREFBMEQ7QUFDMUQsNkhBQTZIO0FBQzdILFNBQVMsY0FBYyxDQUFDLElBQVk7SUFDbEMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUN2QyxDQUFDO0FBQ0QsU0FBUyxnQkFBZ0IsQ0FBQyxHQUFHLEdBQUcsRUFBRSxFQUFFLEdBQVcsRUFBRSxLQUFnQztJQUMvRSxNQUFNLEVBQUUsR0FBRyxJQUFJLE1BQU0sQ0FBQyxRQUFRLEdBQUcsR0FBRyxHQUFHLFdBQVcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN6RCxNQUFNLFNBQVMsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztJQUN0RCxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEVBQUU7UUFDakIsT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxJQUFJLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztLQUM3RTtJQUNELE9BQU8sR0FBRyxHQUFHLFNBQVMsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ2pFLENBQUM7QUFDRCxTQUFTLGtCQUFrQixDQUFDLEdBQVcsRUFBRSxJQUFZO0lBQ25ELElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUU7UUFDckQsT0FBTyxHQUFHLENBQUM7S0FDWjtJQUNELElBQUksSUFBSSxLQUFLLFFBQVEsRUFBRTtRQUNyQixPQUFPLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUM1QjtJQUNELE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMscUVBQXFFLENBQUMsQ0FBQztJQUMvRixJQUFJLEtBQUssRUFBRTtRQUNULE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkMsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQztRQUNwRCxPQUFPLGNBQWMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxPQUFPLEdBQUcsTUFBTSxFQUFFLENBQUMsQ0FBQztLQUMzRDtJQUNELE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUNELE1BQU0sVUFBVSxTQUFTLENBQUMsR0FBVztJQUNuQyxJQUFJLENBQUMsR0FBRyxFQUFFO1FBQ1IsT0FBTyxHQUFHLENBQUM7S0FDWjtJQUNELE1BQU0sS0FBSyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDckQsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxFQUFFO1FBQzVCLElBQUksTUFBTSxHQUFHLEdBQUcsQ0FBQztRQUNqQixNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25ELElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLEVBQUU7WUFDdEIsTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFJLFVBQVUsR0FBRyxDQUFDO1NBQ3JDO1FBQ0QsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxLQUFLLFVBQVUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsZ0JBQWdCLENBQUMsR0FBRyxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQzlJO0lBQ0QsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLG1CQUFtQixDQUFDLEVBQUU7UUFDbEMsT0FBTyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsR0FBRyxJQUFJLElBQUksSUFBSSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxPQUFPLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUN4TDtJQUNELE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFRha2VuIGZyb20gKGFuZCBtb2RpZmllZCkgdGhlIHNob3BpZnkgdGhlbWUgc2NyaXB0IHJlcG9cbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9TaG9waWZ5L3RoZW1lLXNjcmlwdHMvYmxvYi9iY2ZiNDcxZjJhNTdkNDM5ZTJmOTY0YTFiYjY1YjY3NzA4Y2M5MGMzL3BhY2thZ2VzL3RoZW1lLWltYWdlcy9pbWFnZXMuanMjTDU5XG5mdW5jdGlvbiByZW1vdmVQcm90b2NvbChwYXRoOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHBhdGgucmVwbGFjZSgvaHR0cChzKT86LywgJycpO1xufVxuZnVuY3Rpb24gdXBkYXRlUXVlcnlQYXJhbSh1cmkgPSAnJywga2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuKTogc3RyaW5nIHtcbiAgY29uc3QgcmUgPSBuZXcgUmVnRXhwKCcoWz8mXSknICsga2V5ICsgJz0uKj8oJnwkKScsICdpJyk7XG4gIGNvbnN0IHNlcGFyYXRvciA9IHVyaS5pbmRleE9mKCc/JykgIT09IC0xID8gJyYnIDogJz8nO1xuICBpZiAodXJpLm1hdGNoKHJlKSkge1xuICAgIHJldHVybiB1cmkucmVwbGFjZShyZSwgJyQxJyArIGtleSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkgKyAnJDInKTtcbiAgfVxuICByZXR1cm4gdXJpICsgc2VwYXJhdG9yICsga2V5ICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKTtcbn1cbmZ1bmN0aW9uIGdldFNob3BpZnlJbWFnZVVybChzcmM6IHN0cmluZywgc2l6ZTogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCB7XG4gIGlmICghc3JjIHx8ICFzcmM/Lm1hdGNoKC9jZG5cXC5zaG9waWZ5XFwuY29tLykgfHwgIXNpemUpIHtcbiAgICByZXR1cm4gc3JjO1xuICB9XG4gIGlmIChzaXplID09PSAnbWFzdGVyJykge1xuICAgIHJldHVybiByZW1vdmVQcm90b2NvbChzcmMpO1xuICB9XG4gIGNvbnN0IG1hdGNoID0gc3JjLm1hdGNoKC8oX1xcZCt4KFxcZCspPyk/KFxcLihqcGd8anBlZ3xnaWZ8cG5nfGJtcHxiaXRtYXB8dGlmZnx0aWYpKFxcP3Y9XFxkKyk/KS9pKTtcbiAgaWYgKG1hdGNoKSB7XG4gICAgY29uc3QgcHJlZml4ID0gc3JjLnNwbGl0KG1hdGNoWzBdKTtcbiAgICBjb25zdCBzdWZmaXggPSBtYXRjaFszXTtcbiAgICBjb25zdCB1c2VTaXplID0gc2l6ZS5tYXRjaCgneCcpID8gc2l6ZSA6IGAke3NpemV9eGA7XG4gICAgcmV0dXJuIHJlbW92ZVByb3RvY29sKGAke3ByZWZpeFswXX1fJHt1c2VTaXplfSR7c3VmZml4fWApO1xuICB9XG4gIHJldHVybiBudWxsO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGdldFNyY1NldCh1cmw6IHN0cmluZyk6IHN0cmluZyB7XG4gIGlmICghdXJsKSB7XG4gICAgcmV0dXJuIHVybDtcbiAgfVxuICBjb25zdCBzaXplcyA9IFsxMDAsIDIwMCwgNDAwLCA4MDAsIDEyMDAsIDE2MDAsIDIwMDBdO1xuICBpZiAodXJsLm1hdGNoKC9idWlsZGVyXFwuaW8vKSkge1xuICAgIGxldCBzcmNVcmwgPSB1cmw7XG4gICAgY29uc3Qgd2lkdGhJblNyYyA9IE51bWJlcih1cmwuc3BsaXQoJz93aWR0aD0nKVsxXSk7XG4gICAgaWYgKCFpc05hTih3aWR0aEluU3JjKSkge1xuICAgICAgc3JjVXJsID0gYCR7c3JjVXJsfSAke3dpZHRoSW5TcmN9d2A7XG4gICAgfVxuICAgIHJldHVybiBzaXplcy5maWx0ZXIoc2l6ZSA9PiBzaXplICE9PSB3aWR0aEluU3JjKS5tYXAoc2l6ZSA9PiBgJHt1cGRhdGVRdWVyeVBhcmFtKHVybCwgJ3dpZHRoJywgc2l6ZSl9ICR7c2l6ZX13YCkuY29uY2F0KFtzcmNVcmxdKS5qb2luKCcsICcpO1xuICB9XG4gIGlmICh1cmwubWF0Y2goL2NkblxcLnNob3BpZnlcXC5jb20vKSkge1xuICAgIHJldHVybiBzaXplcy5tYXAoc2l6ZSA9PiBbZ2V0U2hvcGlmeUltYWdlVXJsKHVybCwgYCR7c2l6ZX14JHtzaXplfWApLCBzaXplXSkuZmlsdGVyKChbc2l6ZVVybF0pID0+ICEhc2l6ZVVybCkubWFwKChbc2l6ZVVybCwgc2l6ZV0pID0+IGAke3NpemVVcmx9ICR7c2l6ZX13YCkuY29uY2F0KFt1cmxdKS5qb2luKCcsICcpO1xuICB9XG4gIHJldHVybiB1cmw7XG59Il19