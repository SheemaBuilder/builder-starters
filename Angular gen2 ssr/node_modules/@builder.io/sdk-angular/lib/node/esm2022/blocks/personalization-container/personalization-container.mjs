import { Component, ViewChild, Input, } from "@angular/core";
import { CommonModule } from "@angular/common";
import Blocks from "../../components/blocks/blocks";
import InlinedScript from "../../components/inlined-script";
import InlinedStyles from "../../components/inlined-styles";
import { isEditing } from "../../functions/is-editing";
import { isPreviewing } from "../../functions/is-previewing";
import { getDefaultCanTrack } from "../../helpers/canTrack";
import { userAttributesService } from "../../helpers/user-attributes";
import { checkShouldRenderVariants, filterWithCustomTargeting, getBlocksToRender, getPersonalizationScript, } from "./helpers";
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export default class PersonalizationContainer {
    get filteredVariants() {
        return (this.variants || []).filter((variant) => {
            return filterWithCustomTargeting({
                ...(this.builderContext?.rootState?.locale
                    ? {
                        locale: this.builderContext?.rootState?.locale,
                    }
                    : {}),
                ...this.userAttributes,
            }, variant.query, variant.startDate, variant.endDate);
        });
    }
    get blocksToRender() {
        return getBlocksToRender({
            variants: this.variants,
            fallbackBlocks: this.builderBlock?.children,
            isHydrated: this.isHydrated,
            filteredVariants: this.filteredVariants,
            previewingIndex: this.previewingIndex,
        });
    }
    get hideVariantsStyleString() {
        return (this.variants || [])
            .map((_, index) => `[data-variant-id="${this.builderBlock?.id}-${index}"] { display: none; } `)
            .join("");
    }
    setAttributes(el, value, changes) {
        if (!el) {
            return;
        }
        const target = typeof changes === "undefined" ? value : changes;
        Object.keys(target).forEach((key) => {
            if (key.startsWith("on")) {
                if (this._listenerFns.has(key)) {
                    this._listenerFns.get(key)();
                }
                this._listenerFns.set(key, this.renderer.listen(el, key.replace("on", "").toLowerCase(), target[key]));
            }
            else {
                this.renderer.setAttribute(el, key.toLowerCase(), target[key] ?? "");
            }
        });
    }
    trackByVariant0(index, variant) {
        return index;
    }
    constructor(renderer) {
        this.renderer = renderer;
        this._listenerFns = new Map();
        this.userAttributes = userAttributesService.getUserAttributes();
        this.scriptStr = null;
        this.unsubscribers = [];
        this.shouldRenderVariants = null;
        this.isHydrated = false;
        this.node_0_div = null;
        this.node_1_template = (variant, index) => `${this.builderBlock?.id}-${index}`;
        this.node_2_Blocks = (variant, index) => `component.options.variants.${index}.blocks`;
        this.node_3_InlinedStyles = null;
        this.node_4_InlinedScript = null;
    }
    ngOnInit() {
        this.scriptStr = getPersonalizationScript(this.variants, this.builderBlock?.id || "none", this.builderContext?.rootState?.locale);
        this.shouldRenderVariants = checkShouldRenderVariants(this.variants, getDefaultCanTrack(this.builderContext?.canTrack));
        this.node_0_div = `builder-personalization-container ${this.attributes?.className || ""}`;
        this.node_3_InlinedStyles = `variants-styles-${this.builderBlock?.id}`;
        this.node_4_InlinedScript = `variants-script-${this.builderBlock?.id}`;
        if (typeof window !== "undefined") {
            this.isHydrated = true;
            const unsub = userAttributesService.subscribeOnUserAttributesChange((attrs) => {
                this.userAttributes = attrs;
            });
            if (!(isEditing() || isPreviewing())) {
                const variant = this.filteredVariants[0];
                if (this.rootRef.nativeElement) {
                    this.rootRef.nativeElement.dispatchEvent(new CustomEvent("builder.variantLoaded", {
                        detail: {
                            variant: variant || "default",
                            content: this.builderContext?.content,
                        },
                        bubbles: true,
                    }));
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach((entry) => {
                            if (entry.isIntersecting && this.rootRef.nativeElement) {
                                this.rootRef.nativeElement.dispatchEvent(new CustomEvent("builder.variantDisplayed", {
                                    detail: {
                                        variant: variant || "default",
                                        content: this.builderContext?.content,
                                    },
                                    bubbles: true,
                                }));
                            }
                        });
                    });
                    observer.observe(this.rootRef.nativeElement);
                }
            }
            this.unsubscribers.push(unsub);
        }
    }
    ngAfterViewInit() {
        this.setAttributes(this.elRef0?.nativeElement, this.attributes);
    }
    ngOnChanges(changes) {
        if (typeof window !== "undefined") {
            this.node_0_div = `builder-personalization-container ${this.attributes?.className || ""}`;
            this.node_3_InlinedStyles = `variants-styles-${this.builderBlock?.id}`;
            this.node_4_InlinedScript = `variants-script-${this.builderBlock?.id}`;
            this.setAttributes(this.elRef0?.nativeElement, this.attributes, changes["attributes"]?.currentValue);
        }
    }
    ngOnDestroy() {
        this.unsubscribers.forEach((unsub) => unsub());
        for (const fn of this._listenerFns.values()) {
            fn();
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: PersonalizationContainer, deps: [{ token: i0.Renderer2 }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: PersonalizationContainer, isStandalone: true, selector: "personalization-container", inputs: { builderContext: "builderContext", attributes: "attributes", builderBlock: "builderBlock", variants: "variants", previewingIndex: "previewingIndex" }, viewQueries: [{ propertyName: "rootRef", first: true, predicate: ["rootRef"], descendants: true }, { propertyName: "elRef0", first: true, predicate: ["elRef0"], descendants: true }], usesOnChanges: true, ngImport: i0, template: `
    <div #rootRef [class]="node_0_div" #elRef0>
      <ng-container *ngIf="shouldRenderVariants">
        <ng-container
          *ngFor="let variant of variants; index as index; trackBy: trackByVariant0"
        >
          <template [attr.data-variant-id]="node_1_template(variant, index)">
            <blocks
              [blocks]="variant.blocks"
              [parent]="builderBlock?.id"
              [path]="node_2_Blocks(variant, index)"
            ></blocks>
          </template>
        </ng-container>
        <inlined-styles
          [nonce]="builderContext?.nonce || ''"
          [styles]="hideVariantsStyleString"
          [id]="node_3_InlinedStyles"
        ></inlined-styles>
        <inlined-script
          [nonce]="builderContext?.nonce || ''"
          [scriptStr]="scriptStr"
          [id]="node_4_InlinedScript"
        ></inlined-script>
      </ng-container>
      <blocks
        [blocks]="blocksToRender.blocks"
        [parent]="builderBlock?.id"
        [path]="blocksToRender.path"
      ></blocks>
    </div>
  `, isInline: true, styles: [":host{display:contents}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: Blocks, selector: "blocks", inputs: ["blocks", "parent", "path", "styleProp", "className", "context", "linkComponent", "registeredComponents"] }, { kind: "component", type: InlinedStyles, selector: "inlined-styles, InlinedStyles", inputs: ["styles", "id", "nonce"] }, { kind: "component", type: InlinedScript, selector: "inlined-script, InlinedScript", inputs: ["scriptStr", "id", "nonce"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: PersonalizationContainer, decorators: [{
            type: Component,
            args: [{ selector: "personalization-container", template: `
    <div #rootRef [class]="node_0_div" #elRef0>
      <ng-container *ngIf="shouldRenderVariants">
        <ng-container
          *ngFor="let variant of variants; index as index; trackBy: trackByVariant0"
        >
          <template [attr.data-variant-id]="node_1_template(variant, index)">
            <blocks
              [blocks]="variant.blocks"
              [parent]="builderBlock?.id"
              [path]="node_2_Blocks(variant, index)"
            ></blocks>
          </template>
        </ng-container>
        <inlined-styles
          [nonce]="builderContext?.nonce || ''"
          [styles]="hideVariantsStyleString"
          [id]="node_3_InlinedStyles"
        ></inlined-styles>
        <inlined-script
          [nonce]="builderContext?.nonce || ''"
          [scriptStr]="scriptStr"
          [id]="node_4_InlinedScript"
        ></inlined-script>
      </ng-container>
      <blocks
        [blocks]="blocksToRender.blocks"
        [parent]="builderBlock?.id"
        [path]="blocksToRender.path"
      ></blocks>
    </div>
  `, standalone: true, imports: [CommonModule, Blocks, InlinedStyles, InlinedScript], styles: [":host{display:contents}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.Renderer2 }]; }, propDecorators: { builderContext: [{
                type: Input
            }], attributes: [{
                type: Input
            }], builderBlock: [{
                type: Input
            }], variants: [{
                type: Input
            }], previewingIndex: [{
                type: Input
            }], rootRef: [{
                type: ViewChild,
                args: ["rootRef"]
            }], elRef0: [{
                type: ViewChild,
                args: ["elRef0"]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGVyc29uYWxpemF0aW9uLWNvbnRhaW5lci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9ibG9ja3MvcGVyc29uYWxpemF0aW9uLWNvbnRhaW5lci9wZXJzb25hbGl6YXRpb24tY29udGFpbmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsU0FBUyxFQUdULEtBQUssR0FFTixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFL0MsT0FBTyxNQUFNLE1BQU0sZ0NBQWdDLENBQUM7QUFDcEQsT0FBTyxhQUFhLE1BQU0saUNBQWlDLENBQUM7QUFDNUQsT0FBTyxhQUFhLE1BQU0saUNBQWlDLENBQUM7QUFDNUQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUM3RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUN0RSxPQUFPLEVBQ0wseUJBQXlCLEVBQ3pCLHlCQUF5QixFQUN6QixpQkFBaUIsRUFDakIsd0JBQXdCLEdBQ3pCLE1BQU0sV0FBVyxDQUFDOzs7QUErQ25CLE1BQU0sQ0FBQyxPQUFPLE9BQU8sd0JBQXdCO0lBa0IzQyxJQUFJLGdCQUFnQjtRQUNsQixPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtZQUM5QyxPQUFPLHlCQUF5QixDQUM5QjtnQkFDRSxHQUFHLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxTQUFTLEVBQUUsTUFBTTtvQkFDeEMsQ0FBQyxDQUFDO3dCQUNFLE1BQU0sRUFBRSxJQUFJLENBQUMs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RUFBRSxhQUFhLEVBQUUsYUFBYSxDQUFDO2dHQUdwRCxjQUFjO3NCQUF0QixLQUFLO2dCQUNHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBQ0csWUFBWTtzQkFBcEIsS0FBSztnQkFDRyxRQUFRO3NCQUFoQixLQUFLO2dCQUNHLGVBQWU7c0JBQXZCLEtBQUs7Z0JBRWdCLE9BQU87c0JBQTVCLFNBQVM7dUJBQUMsU0FBUztnQkFFQyxNQUFNO3NCQUExQixTQUFTO3VCQUFDLFFBQVEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIFZpZXdDaGlsZCxcbiAgRWxlbWVudFJlZixcbiAgUmVuZGVyZXIyLFxuICBJbnB1dCxcbiAgU2ltcGxlQ2hhbmdlcyxcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gXCJAYW5ndWxhci9jb21tb25cIjtcblxuaW1wb3J0IEJsb2NrcyBmcm9tIFwiLi4vLi4vY29tcG9uZW50cy9ibG9ja3MvYmxvY2tzXCI7XG5pbXBvcnQgSW5saW5lZFNjcmlwdCBmcm9tIFwiLi4vLi4vY29tcG9uZW50cy9pbmxpbmVkLXNjcmlwdFwiO1xuaW1wb3J0IElubGluZWRTdHlsZXMgZnJvbSBcIi4uLy4uL2NvbXBvbmVudHMvaW5saW5lZC1zdHlsZXNcIjtcbmltcG9ydCB7IGlzRWRpdGluZyB9IGZyb20gXCIuLi8uLi9mdW5jdGlvbnMvaXMtZWRpdGluZ1wiO1xuaW1wb3J0IHsgaXNQcmV2aWV3aW5nIH0gZnJvbSBcIi4uLy4uL2Z1bmN0aW9ucy9pcy1wcmV2aWV3aW5nXCI7XG5pbXBvcnQgeyBnZXREZWZhdWx0Q2FuVHJhY2sgfSBmcm9tIFwiLi4vLi4vaGVscGVycy9jYW5UcmFja1wiO1xuaW1wb3J0IHsgdXNlckF0dHJpYnV0ZXNTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL2hlbHBlcnMvdXNlci1hdHRyaWJ1dGVzXCI7XG5pbXBvcnQge1xuICBjaGVja1Nob3VsZFJlbmRlclZhcmlhbnRzLFxuICBmaWx0ZXJXaXRoQ3VzdG9tVGFyZ2V0aW5nLFxuICBnZXRCbG9ja3NUb1JlbmRlcixcbiAgZ2V0UGVyc29uYWxpemF0aW9uU2NyaXB0LFxufSBmcm9tIFwiLi9oZWxwZXJzXCI7XG5pbXBvcnQgdHlwZSB7IFBlcnNvbmFsaXphdGlvbkNvbnRhaW5lclByb3BzIH0gZnJvbSBcIi4vcGVyc29uYWxpemF0aW9uLWNvbnRhaW5lci50eXBlc1wiO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6IFwicGVyc29uYWxpemF0aW9uLWNvbnRhaW5lclwiLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxkaXYgI3Jvb3RSZWYgW2NsYXNzXT1cIm5vZGVfMF9kaXZcIiAjZWxSZWYwPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInNob3VsZFJlbmRlclZhcmlhbnRzXCI+XG4gICAgICAgIDxuZy1jb250YWluZXJcbiAgICAgICAgICAqbmdGb3I9XCJsZXQgdmFyaWFudCBvZiB2YXJpYW50czsgaW5kZXggYXMgaW5kZXg7IHRyYWNrQnk6IHRyYWNrQnlWYXJpYW50MFwiXG4gICAgICAgID5cbiAgICAgICAgICA8dGVtcGxhdGUgW2F0dHIuZGF0YS12YXJpYW50LWlkXT1cIm5vZGVfMV90ZW1wbGF0ZSh2YXJpYW50LCBpbmRleClcIj5cbiAgICAgICAgICAgIDxibG9ja3NcbiAgICAgICAgICAgICAgW2Jsb2Nrc109XCJ2YXJpYW50LmJsb2Nrc1wiXG4gICAgICAgICAgICAgIFtwYXJlbnRdPVwiYnVpbGRlckJsb2NrPy5pZFwiXG4gICAgICAgICAgICAgIFtwYXRoXT1cIm5vZGVfMl9CbG9ja3ModmFyaWFudCwgaW5kZXgpXCJcbiAgICAgICAgICAgID48L2Jsb2Nrcz5cbiAgICAgICAgICA8L3RlbXBsYXRlPlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgPGlubGluZWQtc3R5bGVzXG4gICAgICAgICAgW25vbmNlXT1cImJ1aWxkZXJDb250ZXh0Py5ub25jZSB8fCAnJ1wiXG4gICAgICAgICAgW3N0eWxlc109XCJoaWRlVmFyaWFudHNTdHlsZVN0cmluZ1wiXG4gICAgICAgICAgW2lkXT1cIm5vZGVfM19JbmxpbmVkU3R5bGVzXCJcbiAgICAgICAgPjwvaW5saW5lZC1zdHlsZXM+XG4gICAgICAgIDxpbmxpbmVkLXNjcmlwdFxuICAgICAgICAgIFtub25jZV09XCJidWlsZGVyQ29udGV4dD8ubm9uY2UgfHwgJydcIlxuICAgICAgICAgIFtzY3JpcHRTdHJdPVwic2NyaXB0U3RyXCJcbiAgICAgICAgICBbaWRdPVwibm9kZV80X0lubGluZWRTY3JpcHRcIlxuICAgICAgICA+PC9pbmxpbmVkLXNjcmlwdD5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgPGJsb2Nrc1xuICAgICAgICBbYmxvY2tzXT1cImJsb2Nrc1RvUmVuZGVyLmJsb2Nrc1wiXG4gICAgICAgIFtwYXJlbnRdPVwiYnVpbGRlckJsb2NrPy5pZFwiXG4gICAgICAgIFtwYXRoXT1cImJsb2Nrc1RvUmVuZGVyLnBhdGhcIlxuICAgICAgPjwvYmxvY2tzPlxuICAgIDwvZGl2PlxuICBgLFxuICBzdHlsZXM6IFtcbiAgICBgXG4gICAgICA6aG9zdCB7XG4gICAgICAgIGRpc3BsYXk6IGNvbnRlbnRzO1xuICAgICAgfVxuICAgIGAsXG4gIF0sXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtDb21tb25Nb2R1bGUsIEJsb2NrcywgSW5saW5lZFN0eWxlcywgSW5saW5lZFNjcmlwdF0sXG59KVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGVyc29uYWxpemF0aW9uQ29udGFpbmVyIHtcbiAgQElucHV0KCkgYnVpbGRlckNvbnRleHQhOiBQZXJzb25hbGl6YXRpb25Db250YWluZXJQcm9wc1tcImJ1aWxkZXJDb250ZXh0XCJdO1xuICBASW5wdXQoKSBhdHRyaWJ1dGVzITogUGVyc29uYWxpemF0aW9uQ29udGFpbmVyUHJvcHNbXCJhdHRyaWJ1dGVzXCJdO1xuICBASW5wdXQoKSBidWlsZGVyQmxvY2shOiBQZXJzb25hbGl6YXRpb25Db250YWluZXJQcm9wc1tcImJ1aWxkZXJCbG9ja1wiXTtcbiAgQElucHV0KCkgdmFyaWFudHMhOiBQZXJzb25hbGl6YXRpb25Db250YWluZXJQcm9wc1tcInZhcmlhbnRzXCJdO1xuICBASW5wdXQoKSBwcmV2aWV3aW5nSW5kZXghOiBQZXJzb25hbGl6YXRpb25Db250YWluZXJQcm9wc1tcInByZXZpZXdpbmdJbmRleFwiXTtcblxuICBAVmlld0NoaWxkKFwicm9vdFJlZlwiKSByb290UmVmITogRWxlbWVudFJlZjtcblxuICBAVmlld0NoaWxkKFwiZWxSZWYwXCIpIGVsUmVmMCE6IEVsZW1lbnRSZWY7XG5cbiAgX2xpc3RlbmVyRm5zID0gbmV3IE1hcDxzdHJpbmcsICgpID0+IHZvaWQ+KCk7XG5cbiAgdXNlckF0dHJpYnV0ZXMgPSB1c2VyQXR0cmlidXRlc1NlcnZpY2UuZ2V0VXNlckF0dHJpYnV0ZXMoKTtcbiAgc2NyaXB0U3RyID0gbnVsbDtcbiAgdW5zdWJzY3JpYmVycyA9IFtdO1xuICBzaG91bGRSZW5kZXJWYXJpYW50cyA9IG51bGw7XG4gIGlzSHlkcmF0ZWQgPSBmYWxzZTtcbiAgZ2V0IGZpbHRlcmVkVmFyaWFudHMoKSB7XG4gICAgcmV0dXJuICh0aGlzLnZhcmlhbnRzIHx8IFtdKS5maWx0ZXIoKHZhcmlhbnQpID0+IHtcbiAgICAgIHJldHVybiBmaWx0ZXJXaXRoQ3VzdG9tVGFyZ2V0aW5nKFxuICAgICAgICB7XG4gICAgICAgICAgLi4uKHRoaXMuYnVpbGRlckNvbnRleHQ/LnJvb3RTdGF0ZT8ubG9jYWxlXG4gICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICBsb2NhbGU6IHRoaXMuYnVpbGRlckNvbnRleHQ/LnJvb3RTdGF0ZT8ubG9jYWxlLFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICA6IHt9KSxcbiAgICAgICAgICAuLi4odGhpcy51c2VyQXR0cmlidXRlcyBhcyBhbnkpLFxuICAgICAgICB9LFxuICAgICAgICB2YXJpYW50LnF1ZXJ5LFxuICAgICAgICB2YXJpYW50LnN0YXJ0RGF0ZSxcbiAgICAgICAgdmFyaWFudC5lbmREYXRlXG4gICAgICApO1xuICAgIH0pO1xuICB9XG4gIGdldCBibG9ja3NUb1JlbmRlcigpIHtcbiAgICByZXR1cm4gZ2V0QmxvY2tzVG9SZW5kZXIoe1xuICAgICAgdmFyaWFudHM6IHRoaXMudmFyaWFudHMsXG4gICAgICBmYWxsYmFja0Jsb2NrczogdGhpcy5idWlsZGVyQmxvY2s/LmNoaWxkcmVuLFxuICAgICAgaXNIeWRyYXRlZDogdGhpcy5pc0h5ZHJhdGVkLFxuICAgICAgZmlsdGVyZWRWYXJpYW50czogdGhpcy5maWx0ZXJlZFZhcmlhbnRzLFxuICAgICAgcHJldmlld2luZ0luZGV4OiB0aGlzLnByZXZpZXdpbmdJbmRleCxcbiAgICB9KTtcbiAgfVxuICBnZXQgaGlkZVZhcmlhbnRzU3R5bGVTdHJpbmcoKSB7XG4gICAgcmV0dXJuICh0aGlzLnZhcmlhbnRzIHx8IFtdKVxuICAgICAgLm1hcChcbiAgICAgICAgKF8sIGluZGV4KSA9PlxuICAgICAgICAgIGBbZGF0YS12YXJpYW50LWlkPVwiJHt0aGlzLmJ1aWxkZXJCbG9jaz8uaWR9LSR7aW5kZXh9XCJdIHsgZGlzcGxheTogbm9uZTsgfSBgXG4gICAgICApXG4gICAgICAuam9pbihcIlwiKTtcbiAgfVxuICBub2RlXzBfZGl2ID0gbnVsbDtcbiAgbm9kZV8xX3RlbXBsYXRlID0gKHZhcmlhbnQsIGluZGV4KSA9PiBgJHt0aGlzLmJ1aWxkZXJCbG9jaz8uaWR9LSR7aW5kZXh9YDtcbiAgbm9kZV8yX0Jsb2NrcyA9ICh2YXJpYW50LCBpbmRleCkgPT5cbiAgICBgY29tcG9uZW50Lm9wdGlvbnMudmFyaWFudHMuJHtpbmRleH0uYmxvY2tzYDtcbiAgbm9kZV8zX0lubGluZWRTdHlsZXMgPSBudWxsO1xuICBub2RlXzRfSW5saW5lZFNjcmlwdCA9IG51bGw7XG4gIHNldEF0dHJpYnV0ZXMoZWw6IEhUTUxFbGVtZW50LCB2YWx1ZTogYW55LCBjaGFuZ2VzPzogYW55KSB7XG4gICAgaWYgKCFlbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB0YXJnZXQgPSB0eXBlb2YgY2hhbmdlcyA9PT0gXCJ1bmRlZmluZWRcIiA/IHZhbHVlIDogY2hhbmdlcztcbiAgICBPYmplY3Qua2V5cyh0YXJnZXQpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgaWYgKGtleS5zdGFydHNXaXRoKFwib25cIikpIHtcbiAgICAgICAgaWYgKHRoaXMuX2xpc3RlbmVyRm5zLmhhcyhrZXkpKSB7XG4gICAgICAgICAgdGhpcy5fbGlzdGVuZXJGbnMuZ2V0KGtleSkhKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbGlzdGVuZXJGbnMuc2V0KFxuICAgICAgICAgIGtleSxcbiAgICAgICAgICB0aGlzLnJlbmRlcmVyLmxpc3RlbihcbiAgICAgICAgICAgIGVsLFxuICAgICAgICAgICAga2V5LnJlcGxhY2UoXCJvblwiLCBcIlwiKS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgdGFyZ2V0W2tleV1cbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShlbCwga2V5LnRvTG93ZXJDYXNlKCksIHRhcmdldFtrZXldID8/IFwiXCIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIHRyYWNrQnlWYXJpYW50MChpbmRleCwgdmFyaWFudCkge1xuICAgIHJldHVybiBpbmRleDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMikge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnNjcmlwdFN0ciA9IGdldFBlcnNvbmFsaXphdGlvblNjcmlwdChcbiAgICAgIHRoaXMudmFyaWFudHMsXG4gICAgICB0aGlzLmJ1aWxkZXJCbG9jaz8uaWQgfHwgXCJub25lXCIsXG4gICAgICB0aGlzLmJ1aWxkZXJDb250ZXh0Py5yb290U3RhdGU/LmxvY2FsZSBhcyBzdHJpbmcgfCB1bmRlZmluZWRcbiAgICApO1xuXG4gICAgdGhpcy5zaG91bGRSZW5kZXJWYXJpYW50cyA9IGNoZWNrU2hvdWxkUmVuZGVyVmFyaWFudHMoXG4gICAgICB0aGlzLnZhcmlhbnRzLFxuICAgICAgZ2V0RGVmYXVsdENhblRyYWNrKHRoaXMuYnVpbGRlckNvbnRleHQ/LmNhblRyYWNrKVxuICAgICk7XG4gICAgdGhpcy5ub2RlXzBfZGl2ID0gYGJ1aWxkZXItcGVyc29uYWxpemF0aW9uLWNvbnRhaW5lciAke1xuICAgICAgdGhpcy5hdHRyaWJ1dGVzPy5jbGFzc05hbWUgfHwgXCJcIlxuICAgIH1gO1xuICAgIHRoaXMubm9kZV8zX0lubGluZWRTdHlsZXMgPSBgdmFyaWFudHMtc3R5bGVzLSR7dGhpcy5idWlsZGVyQmxvY2s/LmlkfWA7XG4gICAgdGhpcy5ub2RlXzRfSW5saW5lZFNjcmlwdCA9IGB2YXJpYW50cy1zY3JpcHQtJHt0aGlzLmJ1aWxkZXJCbG9jaz8uaWR9YDtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICB0aGlzLmlzSHlkcmF0ZWQgPSB0cnVlO1xuICAgICAgY29uc3QgdW5zdWIgPSB1c2VyQXR0cmlidXRlc1NlcnZpY2Uuc3Vic2NyaWJlT25Vc2VyQXR0cmlidXRlc0NoYW5nZShcbiAgICAgICAgKGF0dHJzKSA9PiB7XG4gICAgICAgICAgdGhpcy51c2VyQXR0cmlidXRlcyA9IGF0dHJzO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgaWYgKCEoaXNFZGl0aW5nKCkgfHwgaXNQcmV2aWV3aW5nKCkpKSB7XG4gICAgICAgIGNvbnN0IHZhcmlhbnQgPSB0aGlzLmZpbHRlcmVkVmFyaWFudHNbMF07XG4gICAgICAgIGlmICh0aGlzLnJvb3RSZWYubmF0aXZlRWxlbWVudCkge1xuICAgICAgICAgIHRoaXMucm9vdFJlZi5uYXRpdmVFbGVtZW50LmRpc3BhdGNoRXZlbnQoXG4gICAgICAgICAgICBuZXcgQ3VzdG9tRXZlbnQoXCJidWlsZGVyLnZhcmlhbnRMb2FkZWRcIiwge1xuICAgICAgICAgICAgICBkZXRhaWw6IHtcbiAgICAgICAgICAgICAgICB2YXJpYW50OiB2YXJpYW50IHx8IFwiZGVmYXVsdFwiLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHRoaXMuYnVpbGRlckNvbnRleHQ/LmNvbnRlbnQsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGJ1YmJsZXM6IHRydWUsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKGVudHJpZXMpID0+IHtcbiAgICAgICAgICAgIGVudHJpZXMuZm9yRWFjaCgoZW50cnkpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGVudHJ5LmlzSW50ZXJzZWN0aW5nICYmIHRoaXMucm9vdFJlZi5uYXRpdmVFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yb290UmVmLm5hdGl2ZUVsZW1lbnQuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgICAgICAgICAgIG5ldyBDdXN0b21FdmVudChcImJ1aWxkZXIudmFyaWFudERpc3BsYXllZFwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGRldGFpbDoge1xuICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnQ6IHZhcmlhbnQgfHwgXCJkZWZhdWx0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgY29udGVudDogdGhpcy5idWlsZGVyQ29udGV4dD8uY29udGVudCxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYnViYmxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZSh0aGlzLnJvb3RSZWYubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMudW5zdWJzY3JpYmVycy5wdXNoKHVuc3ViKTtcbiAgICB9XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5zZXRBdHRyaWJ1dGVzKHRoaXMuZWxSZWYwPy5uYXRpdmVFbGVtZW50LCB0aGlzLmF0dHJpYnV0ZXMpO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICB0aGlzLm5vZGVfMF9kaXYgPSBgYnVpbGRlci1wZXJzb25hbGl6YXRpb24tY29udGFpbmVyICR7XG4gICAgICAgIHRoaXMuYXR0cmlidXRlcz8uY2xhc3NOYW1lIHx8IFwiXCJcbiAgICAgIH1gO1xuICAgICAgdGhpcy5ub2RlXzNfSW5saW5lZFN0eWxlcyA9IGB2YXJpYW50cy1zdHlsZXMtJHt0aGlzLmJ1aWxkZXJCbG9jaz8uaWR9YDtcbiAgICAgIHRoaXMubm9kZV80X0lubGluZWRTY3JpcHQgPSBgdmFyaWFudHMtc2NyaXB0LSR7dGhpcy5idWlsZGVyQmxvY2s/LmlkfWA7XG4gICAgICB0aGlzLnNldEF0dHJpYnV0ZXMoXG4gICAgICAgIHRoaXMuZWxSZWYwPy5uYXRpdmVFbGVtZW50LFxuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMsXG4gICAgICAgIGNoYW5nZXNbXCJhdHRyaWJ1dGVzXCJdPy5jdXJyZW50VmFsdWVcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy51bnN1YnNjcmliZXJzLmZvckVhY2goKHVuc3ViKSA9PiB1bnN1YigpKTtcbiAgICBmb3IgKGNvbnN0IGZuIG9mIHRoaXMuX2xpc3RlbmVyRm5zLnZhbHVlcygpKSB7XG4gICAgICBmbigpO1xuICAgIH1cbiAgfVxufVxuIl19