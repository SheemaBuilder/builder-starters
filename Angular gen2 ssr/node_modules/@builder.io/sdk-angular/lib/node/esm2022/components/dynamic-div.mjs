import { CommonModule } from '@angular/common';
// fails because type imports cannot be injected
// eslint-disable-next-line @typescript-eslint/consistent-type-imports
import { Component, ElementRef, Input, ViewChild, } from '@angular/core';
import * as i0 from "@angular/core";
export default class DynamicDiv {
    constructor(renderer) {
        this.renderer = renderer;
        this._listenerFns = new Map();
    }
    ngAfterViewInit() {
        const el = this.v?.nativeElement;
        if (!el) {
            return;
        }
        this.setAttributes(el, this.attributes);
        this.setAttributes(el, this.actionAttributes);
        this.setAttributes(el, this.showContentProps);
        this.setAttribute(el, 'class', [this.classProp ?? '', this.className ?? ''].join(' ').trim());
        this.handleStyleProp(el, this.style);
        this.setAttribute(el, 'builder-parent-id', this.builderParentId);
        this.setAttribute(el, 'builder-path', this.builderPath);
        this.setAttribute(el, 'builder-model', this.builderModel);
        this.setAttribute(el, 'builder-content-id', this.builderContentId);
        this.setAttribute(el, 'hidden', this.hidden);
        this.setAttribute(el, 'aria-hidden', this.ariaHidden);
    }
    ngOnChanges(changes) {
        const el = this.v?.nativeElement;
        if (!el) {
            return;
        }
        if (Object.keys(changes).length === 0) {
            return;
        }
        if (changes.attributes) {
            this.setAttributes(el, this.attributes, changes.attributes.currentValue);
        }
        if (changes.actionAttributes) {
            this.setAttributes(el, this.actionAttributes, changes.actionAttributes.currentValue);
        }
        if (changes.showContentProps) {
            this.setAttributes(el, this.showContentProps, changes.showContentProps.currentValue);
        }
        if (changes.classProp || changes.className) {
            this.setAttribute(el, 'class', [this.classProp ?? '', this.className ?? ''].join(' ').trim());
        }
        if (changes.style)
            this.handleStyleProp(el, this.style);
        if (changes.builderParentId)
            this.setAttribute(el, 'builder-parent-id', this.builderParentId);
        if (changes.builderPath)
            this.setAttribute(el, 'builder-path', this.builderPath);
        if (changes.builderModel)
            this.setAttribute(el, 'builder-model', this.builderModel);
        if (changes.builderContentId)
            this.setAttribute(el, 'builder-content-id', this.builderContentId);
        if (changes.hidden)
            this.setAttribute(el, 'hidden', this.hidden);
        if (changes.ariaHidden)
            this.setAttribute(el, 'aria-hidden', this.ariaHidden);
    }
    setAttributes(el, value, changes) {
        if (!el)
            return;
        const target = changes ? changes : value;
        if (!target)
            return;
        Object.keys(target).forEach((key) => {
            if (key.startsWith('on')) {
                if (this._listenerFns.has(key)) {
                    this._listenerFns.get(key)();
                }
                this._listenerFns.set(key, this.renderer.listen(el, key.replace('on', '').toLowerCase(), target[key]));
            }
            else {
                this.renderer.setAttribute(el, key, target[key] ?? '');
            }
        });
    }
    setAttribute(el, key, value) {
        if (value) {
            this.renderer.setAttribute(el, key, value);
        }
    }
    handleStyleProp(el, style) {
        if (typeof style === 'object') {
            Object.entries(style).forEach(([key, value]) => {
                this.renderer.setStyle(el, key, value);
            });
        }
        else {
            this.renderer.setAttribute(el, 'style', style);
        }
    }
    ngOnDestroy() {
        this._listenerFns.forEach((fn) => fn());
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: DynamicDiv, deps: [{ token: i0.Renderer2 }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: DynamicDiv, isStandalone: true, selector: "dynamic-div, DynamicDiv", inputs: { attributes: "attributes", actionAttributes: "actionAttributes", BlockWrapperProps: "BlockWrapperProps", builderPath: ["builder-path", "builderPath"], builderParentId: ["builder-parent-id", "builderParentId"], BlocksWrapperProps: "BlocksWrapperProps", contentWrapperProps: "contentWrapperProps", builderModel: ["builder-model", "builderModel"], builderContentId: ["builder-content-id", "builderContentId"], ref: "ref", classProp: ["class", "classProp"], style: "style", showContentProps: "showContentProps", onClick: "onClick", onMouseEnter: "onMouseEnter", onKeyPress: "onKeyPress", hidden: "hidden", ariaHidden: ["aria-hidden", "ariaHidden"], className: "className" }, viewQueries: [{ propertyName: "v", first: true, predicate: ["v"], descendants: true, read: ElementRef }], usesOnChanges: true, ngImport: i0, template: `
    <div
      #v
      (click)="onClick && onClick($event)"
      (mouseenter)="onMouseEnter && onMouseEnter($event)"
    >
      <ng-content></ng-content>
    </div>
  `, isInline: true, styles: [":host{display:contents}\n", ".props-blocks-wrapper{display:flex;flex-direction:column;align-items:stretch}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: DynamicDiv, decorators: [{
            type: Component,
            args: [{ selector: 'dynamic-div, DynamicDiv', template: `
    <div
      #v
      (click)="onClick && onClick($event)"
      (mouseenter)="onMouseEnter && onMouseEnter($event)"
    >
      <ng-content></ng-content>
    </div>
  `, standalone: true, imports: [CommonModule], styles: [":host{display:contents}\n", ".props-blocks-wrapper{display:flex;flex-direction:column;align-items:stretch}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.Renderer2 }]; }, propDecorators: { attributes: [{
                type: Input
            }], actionAttributes: [{
                type: Input
            }], BlockWrapperProps: [{
                type: Input
            }], builderPath: [{
                type: Input,
                args: ['builder-path']
            }], builderParentId: [{
                type: Input,
                args: ['builder-parent-id']
            }], BlocksWrapperProps: [{
                type: Input
            }], contentWrapperProps: [{
                type: Input
            }], builderModel: [{
                type: Input,
                args: ['builder-model']
            }], builderContentId: [{
                type: Input,
                args: ['builder-content-id']
            }], ref: [{
                type: Input
            }], classProp: [{
                type: Input,
                args: ['class']
            }], style: [{
                type: Input
            }], showContentProps: [{
                type: Input
            }], onClick: [{
                type: Input
            }], onMouseEnter: [{
                type: Input
            }], onKeyPress: [{
                type: Input
            }], hidden: [{
                type: Input
            }], ariaHidden: [{
                type: Input,
                args: ['aria-hidden']
            }], className: [{
                type: Input
            }], v: [{
                type: ViewChild,
                args: ['v', { read: ElementRef }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1kaXYuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9keW5hbWljLWRpdi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsZ0RBQWdEO0FBQ2hELHNFQUFzRTtBQUN0RSxPQUFPLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFDVixLQUFLLEVBRUwsU0FBUyxHQUNWLE1BQU0sZUFBZSxDQUFDOztBQW9CdkIsTUFBTSxDQUFDLE9BQU8sT0FBTyxVQUFVO0lBMEI3QixZQUFvQixRQUFtQjtRQUFuQixhQUFRLEdBQVIsUUFBUSxDQUFXO1FBRi9CLGlCQUFZLEdBQUcsSUFBSSxHQUFHLEVBQXNCLENBQUM7SUFFWCxDQUFDO0lBRTNDLGVBQWU7UUFDYixNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxFQUFFLGFBQWEsQ0FBQztRQUNqQyxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ1AsT0FBTztTQUNSO1FBQ0QsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzlDLElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzlDLElBQUksQ0FBQyxZQUFZLENBQ2YsRUFBRSxFQUNGLE9BQU8sRUFDUCxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksRUFBRSxFQUFFLElBQUksQ0FBQyxTQUFTLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUM5RCxDQUFDO1FBQ0YsSUFBSSxDQUFDLGVBQWUsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FB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QUNHLG1CQUFtQjtzQkFBM0IsS0FBSztnQkFDa0IsWUFBWTtzQkFBbkMsS0FBSzt1QkFBQyxlQUFlO2dCQUNPLGdCQUFnQjtzQkFBNUMsS0FBSzt1QkFBQyxvQkFBb0I7Z0JBQ2xCLEdBQUc7c0JBQVgsS0FBSztnQkFDVSxTQUFTO3NCQUF4QixLQUFLO3VCQUFDLE9BQU87Z0JBQ0wsS0FBSztzQkFBYixLQUFLO2dCQUNHLGdCQUFnQjtzQkFBeEIsS0FBSztnQkFDRyxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csWUFBWTtzQkFBcEIsS0FBSztnQkFDRyxVQUFVO3NCQUFsQixLQUFLO2dCQUNHLE1BQU07c0JBQWQsS0FBSztnQkFDZ0IsVUFBVTtzQkFBL0IsS0FBSzt1QkFBQyxhQUFhO2dCQUNYLFNBQVM7c0JBQWpCLEtBQUs7Z0JBR04sQ0FBQztzQkFEQSxTQUFTO3VCQUFDLEdBQUcsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21tb25Nb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuLy8gZmFpbHMgYmVjYXVzZSB0eXBlIGltcG9ydHMgY2Fubm90IGJlIGluamVjdGVkXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2NvbnNpc3RlbnQtdHlwZS1pbXBvcnRzXG5pbXBvcnQge1xuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIElucHV0LFxuICBSZW5kZXJlcjIsXG4gIFZpZXdDaGlsZCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2R5bmFtaWMtZGl2LCBEeW5hbWljRGl2JyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8ZGl2XG4gICAgICAjdlxuICAgICAgKGNsaWNrKT1cIm9uQ2xpY2sgJiYgb25DbGljaygkZXZlbnQpXCJcbiAgICAgIChtb3VzZWVudGVyKT1cIm9uTW91c2VFbnRlciAmJiBvbk1vdXNlRW50ZXIoJGV2ZW50KVwiXG4gICAgPlxuICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgIDwvZGl2PlxuICBgLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbQ29tbW9uTW9kdWxlXSxcbiAgc3R5bGVzOiBbXG4gICAgJzpob3N0IHsgZGlzcGxheTogY29udGVudHM7IH0nLFxuICAgICcucHJvcHMtYmxvY2tzLXdyYXBwZXIgeyBkaXNwbGF5OiBmbGV4OyBmbGV4LWRpcmVjdGlvbjogY29sdW1uOyBhbGlnbi1pdGVtczogc3RyZXRjaDsgfScsXG4gIF0sXG59KVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRHluYW1pY0RpdiB7XG4gIEBJbnB1dCgpIGF0dHJpYnV0ZXM6IGFueTtcbiAgQElucHV0KCkgYWN0aW9uQXR0cmlidXRlczogYW55O1xuICBASW5wdXQoKSBCbG9ja1dyYXBwZXJQcm9wczogYW55O1xuICBASW5wdXQoJ2J1aWxkZXItcGF0aCcpIGJ1aWxkZXJQYXRoOiBhbnk7XG4gIEBJbnB1dCgnYnVpbGRlci1wYXJlbnQtaWQnKSBidWlsZGVyUGFyZW50SWQ6IGFueTtcbiAgQElucHV0KCkgQmxvY2tzV3JhcHBlclByb3BzOiBhbnk7XG4gIEBJbnB1dCgpIGNvbnRlbnRXcmFwcGVyUHJvcHM6IGFueTtcbiAgQElucHV0KCdidWlsZGVyLW1vZGVsJykgYnVpbGRlck1vZGVsOiBhbnk7XG4gIEBJbnB1dCgnYnVpbGRlci1jb250ZW50LWlkJykgYnVpbGRlckNvbnRlbnRJZDogYW55O1xuICBASW5wdXQoKSByZWY6IGFueTtcbiAgQElucHV0KCdjbGFzcycpIGNsYXNzUHJvcDogYW55O1xuICBASW5wdXQoKSBzdHlsZTogYW55O1xuICBASW5wdXQoKSBzaG93Q29udGVudFByb3BzOiBhbnk7XG4gIEBJbnB1dCgpIG9uQ2xpY2s6IGFueTtcbiAgQElucHV0KCkgb25Nb3VzZUVudGVyOiBhbnk7XG4gIEBJbnB1dCgpIG9uS2V5UHJlc3M6IGFueTtcbiAgQElucHV0KCkgaGlkZGVuOiBhbnk7XG4gIEBJbnB1dCgnYXJpYS1oaWRkZW4nKSBhcmlhSGlkZGVuOiBhbnk7XG4gIEBJbnB1dCgpIGNsYXNzTmFtZTogYW55O1xuXG4gIEBWaWV3Q2hpbGQoJ3YnLCB7IHJlYWQ6IEVsZW1lbnRSZWYgfSlcbiAgdiE6IEVsZW1lbnRSZWY7XG5cbiAgcHJpdmF0ZSBfbGlzdGVuZXJGbnMgPSBuZXcgTWFwPHN0cmluZywgKCkgPT4gdm9pZD4oKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHt9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIGNvbnN0IGVsID0gdGhpcy52Py5uYXRpdmVFbGVtZW50O1xuICAgIGlmICghZWwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zZXRBdHRyaWJ1dGVzKGVsLCB0aGlzLmF0dHJpYnV0ZXMpO1xuICAgIHRoaXMuc2V0QXR0cmlidXRlcyhlbCwgdGhpcy5hY3Rpb25BdHRyaWJ1dGVzKTtcbiAgICB0aGlzLnNldEF0dHJpYnV0ZXMoZWwsIHRoaXMuc2hvd0NvbnRlbnRQcm9wcyk7XG4gICAgdGhpcy5zZXRBdHRyaWJ1dGUoXG4gICAgICBlbCxcbiAgICAgICdjbGFzcycsXG4gICAgICBbdGhpcy5jbGFzc1Byb3AgPz8gJycsIHRoaXMuY2xhc3NOYW1lID8/ICcnXS5qb2luKCcgJykudHJpbSgpXG4gICAgKTtcbiAgICB0aGlzLmhhbmRsZVN0eWxlUHJvcChlbCwgdGhpcy5zdHlsZSk7XG4gICAgdGhpcy5zZXRBdHRyaWJ1dGUoZWwsICdidWlsZGVyLXBhcmVudC1pZCcsIHRoaXMuYnVpbGRlclBhcmVudElkKTtcbiAgICB0aGlzLnNldEF0dHJpYnV0ZShlbCwgJ2J1aWxkZXItcGF0aCcsIHRoaXMuYnVpbGRlclBhdGgpO1xuICAgIHRoaXMuc2V0QXR0cmlidXRlKGVsLCAnYnVpbGRlci1tb2RlbCcsIHRoaXMuYnVpbGRlck1vZGVsKTtcbiAgICB0aGlzLnNldEF0dHJpYnV0ZShlbCwgJ2J1aWxkZXItY29udGVudC1pZCcsIHRoaXMuYnVpbGRlckNvbnRlbnRJZCk7XG4gICAgdGhpcy5zZXRBdHRyaWJ1dGUoZWwsICdoaWRkZW4nLCB0aGlzLmhpZGRlbik7XG4gICAgdGhpcy5zZXRBdHRyaWJ1dGUoZWwsICdhcmlhLWhpZGRlbicsIHRoaXMuYXJpYUhpZGRlbik7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzKSB7XG4gICAgY29uc3QgZWwgPSB0aGlzLnY/Lm5hdGl2ZUVsZW1lbnQ7XG4gICAgaWYgKCFlbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChPYmplY3Qua2V5cyhjaGFuZ2VzKS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoY2hhbmdlcy5hdHRyaWJ1dGVzKSB7XG4gICAgICB0aGlzLnNldEF0dHJpYnV0ZXMoZWwsIHRoaXMuYXR0cmlidXRlcywgY2hhbmdlcy5hdHRyaWJ1dGVzLmN1cnJlbnRWYWx1ZSk7XG4gICAgfVxuICAgIGlmIChjaGFuZ2VzLmFjdGlvbkF0dHJpYnV0ZXMpIHtcbiAgICAgIHRoaXMuc2V0QXR0cmlidXRlcyhcbiAgICAgICAgZWwsXG4gICAgICAgIHRoaXMuYWN0aW9uQXR0cmlidXRlcyxcbiAgICAgICAgY2hhbmdlcy5hY3Rpb25BdHRyaWJ1dGVzLmN1cnJlbnRWYWx1ZVxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKGNoYW5nZXMuc2hvd0NvbnRlbnRQcm9wcykge1xuICAgICAgdGhpcy5zZXRBdHRyaWJ1dGVzKFxuICAgICAgICBlbCxcbiAgICAgICAgdGhpcy5zaG93Q29udGVudFByb3BzLFxuICAgICAgICBjaGFuZ2VzLnNob3dDb250ZW50UHJvcHMuY3VycmVudFZhbHVlXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoY2hhbmdlcy5jbGFzc1Byb3AgfHwgY2hhbmdlcy5jbGFzc05hbWUpIHtcbiAgICAgIHRoaXMuc2V0QXR0cmlidXRlKFxuICAgICAgICBlbCxcbiAgICAgICAgJ2NsYXNzJyxcbiAgICAgICAgW3RoaXMuY2xhc3NQcm9wID8/ICcnLCB0aGlzLmNsYXNzTmFtZSA/PyAnJ10uam9pbignICcpLnRyaW0oKVxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKGNoYW5nZXMuc3R5bGUpIHRoaXMuaGFuZGxlU3R5bGVQcm9wKGVsLCB0aGlzLnN0eWxlKTtcbiAgICBpZiAoY2hhbmdlcy5idWlsZGVyUGFyZW50SWQpXG4gICAgICB0aGlzLnNldEF0dHJpYnV0ZShlbCwgJ2J1aWxkZXItcGFyZW50LWlkJywgdGhpcy5idWlsZGVyUGFyZW50SWQpO1xuICAgIGlmIChjaGFuZ2VzLmJ1aWxkZXJQYXRoKVxuICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoZWwsICdidWlsZGVyLXBhdGgnLCB0aGlzLmJ1aWxkZXJQYXRoKTtcbiAgICBpZiAoY2hhbmdlcy5idWlsZGVyTW9kZWwpXG4gICAgICB0aGlzLnNldEF0dHJpYnV0ZShlbCwgJ2J1aWxkZXItbW9kZWwnLCB0aGlzLmJ1aWxkZXJNb2RlbCk7XG4gICAgaWYgKGNoYW5nZXMuYnVpbGRlckNvbnRlbnRJZClcbiAgICAgIHRoaXMuc2V0QXR0cmlidXRlKGVsLCAnYnVpbGRlci1jb250ZW50LWlkJywgdGhpcy5idWlsZGVyQ29udGVudElkKTtcbiAgICBpZiAoY2hhbmdlcy5oaWRkZW4pIHRoaXMuc2V0QXR0cmlidXRlKGVsLCAnaGlkZGVuJywgdGhpcy5oaWRkZW4pO1xuICAgIGlmIChjaGFuZ2VzLmFyaWFIaWRkZW4pXG4gICAgICB0aGlzLnNldEF0dHJpYnV0ZShlbCwgJ2FyaWEtaGlkZGVuJywgdGhpcy5hcmlhSGlkZGVuKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0QXR0cmlidXRlcyhlbDogYW55LCB2YWx1ZTogYW55LCBjaGFuZ2VzPzogYW55KSB7XG4gICAgaWYgKCFlbCkgcmV0dXJuO1xuXG4gICAgY29uc3QgdGFyZ2V0ID0gY2hhbmdlcyA/IGNoYW5nZXMgOiB2YWx1ZTtcblxuICAgIGlmICghdGFyZ2V0KSByZXR1cm47XG5cbiAgICBPYmplY3Qua2V5cyh0YXJnZXQpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgaWYgKGtleS5zdGFydHNXaXRoKCdvbicpKSB7XG4gICAgICAgIGlmICh0aGlzLl9saXN0ZW5lckZucy5oYXMoa2V5KSkge1xuICAgICAgICAgIHRoaXMuX2xpc3RlbmVyRm5zLmdldChrZXkpISgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2xpc3RlbmVyRm5zLnNldChcbiAgICAgICAgICBrZXksXG4gICAgICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4oXG4gICAgICAgICAgICBlbCxcbiAgICAgICAgICAgIGtleS5yZXBsYWNlKCdvbicsICcnKS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgdGFyZ2V0W2tleV1cbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShlbCwga2V5LCB0YXJnZXRba2V5XSA/PyAnJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHNldEF0dHJpYnV0ZShlbDogSFRNTEVsZW1lbnQsIGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShlbCwga2V5LCB2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVTdHlsZVByb3AoZWw6IEhUTUxFbGVtZW50LCBzdHlsZTogYW55KSB7XG4gICAgaWYgKHR5cGVvZiBzdHlsZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIE9iamVjdC5lbnRyaWVzKHN0eWxlKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShlbCwga2V5LCB2YWx1ZSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoZWwsICdzdHlsZScsIHN0eWxlKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLl9saXN0ZW5lckZucy5mb3JFYWNoKChmbikgPT4gZm4oKSk7XG4gIH1cbn1cbiJdfQ==