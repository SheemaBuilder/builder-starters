import { logger } from '../../helpers/logger';
import { isNodeRuntime } from '../is-node-runtime';
export const shouldForceBrowserRuntimeInNode = ({ shouldLogWarning }) => {
    if (!isNodeRuntime())
        return false;
    const isArm64 = process.arch === 'arm64';
    const isNode20 = process.version.startsWith('v20');
    const hasNoNodeSnapshotNodeOption = process.env.NODE_OPTIONS?.includes('--no-node-snapshot');
    if (isArm64 && isNode20 && !hasNoNodeSnapshotNodeOption) {
        if (shouldLogWarning) {
            logger.log(`Skipping usage of \`isolated-vm\` to avoid crashes in Node v20 on an arm64 machine.
    If you would like to use the \`isolated-vm\` package on this machine, please provide the \`NODE_OPTIONS=--no-node-snapshot\` config to your Node process.
    See https://github.com/BuilderIO/builder/blob/main/packages/sdks/README.md#node-v20--m1-macs-apple-silicon-support for more information.
    `);
        }
        return true;
    }
    return false;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hvdWxkLWZvcmNlLWJyb3dzZXItcnVudGltZS1pbi1ub2RlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2Z1bmN0aW9ucy9ldmFsdWF0ZS9zaG91bGQtZm9yY2UtYnJvd3Nlci1ydW50aW1lLWluLW5vZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNuRCxNQUFNLENBQUMsTUFBTSwrQkFBK0IsR0FBRyxDQUFDLEVBQzlDLGdCQUFnQixFQUdqQixFQUFFLEVBQUU7SUFDSCxJQUFJLENBQUMsYUFBYSxFQUFFO1FBQUUsT0FBTyxLQUFLLENBQUM7SUFDbkMsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksS0FBSyxPQUFPLENBQUM7SUFDekMsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDbkQsTUFBTSwyQkFBMkIsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsb0JBQW9CLENBQUMsQ0FBQztJQUM3RixJQUFJLE9BQU8sSUFBSSxRQUFRLElBQUksQ0FBQywyQkFBMkIsRUFBRTtRQUN2RCxJQUFJLGdCQUFnQixFQUFFO1lBQ3BCLE1BQU0sQ0FBQyxHQUFHLENBQUM7OztLQUdaLENBQUMsQ0FBQztTQUNGO1FBQ0QsT0FBTyxJQUFJLENBQUM7S0FDYjtJQUNELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vLi4vaGVscGVycy9sb2dnZXInO1xuaW1wb3J0IHsgaXNOb2RlUnVudGltZSB9IGZyb20gJy4uL2lzLW5vZGUtcnVudGltZSc7XG5leHBvcnQgY29uc3Qgc2hvdWxkRm9yY2VCcm93c2VyUnVudGltZUluTm9kZSA9ICh7XG4gIHNob3VsZExvZ1dhcm5pbmdcbn06IHtcbiAgc2hvdWxkTG9nV2FybmluZzogYm9vbGVhbjtcbn0pID0+IHtcbiAgaWYgKCFpc05vZGVSdW50aW1lKCkpIHJldHVybiBmYWxzZTtcbiAgY29uc3QgaXNBcm02NCA9IHByb2Nlc3MuYXJjaCA9PT0gJ2FybTY0JztcbiAgY29uc3QgaXNOb2RlMjAgPSBwcm9jZXNzLnZlcnNpb24uc3RhcnRzV2l0aCgndjIwJyk7XG4gIGNvbnN0IGhhc05vTm9kZVNuYXBzaG90Tm9kZU9wdGlvbiA9IHByb2Nlc3MuZW52Lk5PREVfT1BUSU9OUz8uaW5jbHVkZXMoJy0tbm8tbm9kZS1zbmFwc2hvdCcpO1xuICBpZiAoaXNBcm02NCAmJiBpc05vZGUyMCAmJiAhaGFzTm9Ob2RlU25hcHNob3ROb2RlT3B0aW9uKSB7XG4gICAgaWYgKHNob3VsZExvZ1dhcm5pbmcpIHtcbiAgICAgIGxvZ2dlci5sb2coYFNraXBwaW5nIHVzYWdlIG9mIFxcYGlzb2xhdGVkLXZtXFxgIHRvIGF2b2lkIGNyYXNoZXMgaW4gTm9kZSB2MjAgb24gYW4gYXJtNjQgbWFjaGluZS5cbiAgICBJZiB5b3Ugd291bGQgbGlrZSB0byB1c2UgdGhlIFxcYGlzb2xhdGVkLXZtXFxgIHBhY2thZ2Ugb24gdGhpcyBtYWNoaW5lLCBwbGVhc2UgcHJvdmlkZSB0aGUgXFxgTk9ERV9PUFRJT05TPS0tbm8tbm9kZS1zbmFwc2hvdFxcYCBjb25maWcgdG8geW91ciBOb2RlIHByb2Nlc3MuXG4gICAgU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9CdWlsZGVySU8vYnVpbGRlci9ibG9iL21haW4vcGFja2FnZXMvc2Rrcy9SRUFETUUubWQjbm9kZS12MjAtLW0xLW1hY3MtYXBwbGUtc2lsaWNvbi1zdXBwb3J0IGZvciBtb3JlIGluZm9ybWF0aW9uLlxuICAgIGApO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59Il19